/*hammerhead|script|start*/"use strict";if (typeof window !== 'undefined' && window){window['hammerhead|process-dom-method'] && window['hammerhead|process-dom-method']();if (window.__get$ && typeof __get$ === 'undefined')var __get$Loc = window.__get$Loc,__set$Loc = window.__set$Loc,__set$ = window.__set$,__get$ = window.__get$,__call$ = window.__call$,__get$Eval = window.__get$Eval,__proc$Script = window.__proc$Script,__proc$Html = window.__proc$Html,__get$PostMessage = window.__get$PostMessage,__get$ProxyUrl = window.__get$ProxyUrl,__rest$Array = window.__rest$Array,__rest$Object = window.__rest$Object,__arrayFrom$ = window.__arrayFrom$;} else {if (typeof __get$ === 'undefined')var __get$Loc = function(l){return l},__set$Loc = function(l,v){return l = v},__set$ = function(o,p,v){return o[p] = v},__get$ = function(o,p){return o[p]},__call$ = function(o,p,a){return o[p].apply(o,a)},__get$Eval = function(e){return e},__proc$Script = function(s){return s},__proc$Html = function(h){return h},__get$PostMessage = function(w,p){return arguments.length===1?w.postMessage:p},__get$ProxyUrl = function(u,d){return u},__rest$Array = function(a,i){return Array.prototype.slice.call(a, i)},__rest$Object = function(o,p){var k=Object.keys(o),n={};for(var i=0;i<k.length;++i)if(p.indexOf(k[i])<0)n[k[i]]=o[k[i]];return n},__arrayFrom$ = function(r){if(!r)return r;return!Array.isArray(r)&&"function"==typeof r[Symbol.iterator]?Array.from(r):r};if (typeof importScripts !== "undefined" && /\[native code]/g.test(importScripts.toString())) {var __getWorkerSettings$ = function () {return null};importScripts((location.origin || (location.protocol + "//" + location.host)) + "/worker-hammerhead.js");}}/*hammerhead|script|processing-header-end*/
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[38678],{83595:function(e,t,a){a.d(t,{EI:function(){return function e(t,a){if(t===a)return!0;if(null==t||null==a)return!1;if("object"!=typeof t&&"object"!=typeof a)return t===a;if(t.constructor!==a.constructor)return!1;if(t instanceof Date&&a instanceof Date)return t.getTime()===a.getTime();if(Array.isArray(t)){if(t.length!==a.length)return!1;for(let r=0;r<t.length;r++)if(!e( __get$(t,r) , __get$(a,r) ))return!1;return!0}let r=Object.keys(t),o=Object.keys(a);if(r.length!==o.length)return!1;for(let s of r)if(!o.includes(s)||!e( __get$(t,s) , __get$(a,s) ))return!1;return!0}},Pu:function(){return L},gP:function(){return C}});var r,o=a(52103),s=a(34010),i=a(17178),l=Object.defineProperty;Symbol.for("vercel.ai.error.AI_NoOutputSpecifiedError"),s.AX,Symbol.for("vercel.ai.error.AI_InvalidArgumentError"),s.AX,Symbol.for("vercel.ai.error.AI_InvalidStreamPartError"),s.AX,Symbol.for("vercel.ai.error.AI_InvalidToolInputError"),s.AX,Symbol.for("vercel.ai.error.AI_NoImageGeneratedError"),s.AX;var n="AI_NoObjectGeneratedError",p=`vercel.ai.error.${n}`,d=Symbol.for(p),u=class extends s.AX{constructor( _hh$temp0 ){ var _hh$temp0$message=_hh$temp0.message,e=_hh$temp0$message===void 0?"No object generated.":_hh$temp0$message,t=_hh$temp0.cause,a=_hh$temp0.text,o=_hh$temp0.response,s=_hh$temp0.usage,i=_hh$temp0.finishReason; super({name:n,message:e,cause:t}), __set$(this,r,!0) ,this.text=a,this.response=o,this.usage=s,this.finishReason=i}static isInstance(e){return s.AX.hasMarker(e,p)}};r=d,Symbol.for("vercel.ai.error.AI_NoOutputGeneratedError"),s.AX,s.AX,Symbol.for("vercel.ai.error.AI_NoSuchToolError"),s.AX,Symbol.for("vercel.ai.error.AI_ToolCallRepairError"),s.AX,s.AX,Symbol.for("vercel.ai.error.AI_InvalidDataContentError"),s.AX,Symbol.for("vercel.ai.error.AI_InvalidMessageRoleError"),s.AX,Symbol.for("vercel.ai.error.AI_MessageConversionError"),s.AX,Symbol.for("vercel.ai.error.AI_DownloadError"),s.AX,Symbol.for("vercel.ai.error.AI_RetryError"),s.AX;var c="5.0.112",h=i.G0([i.Z_(),i.Pp(Uint8Array),i.Pp(ArrayBuffer),i.PG(e=>{var t,a;return null!=(a=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&a},{message:"Must be a Buffer"})]),m=i.Vo(()=>i.G0([i.lB(),i.Z_(),i.Rx(),i.O7(),i.IM(i.Z_(),m),i.IX(m)])),v=i.IM(i.Z_(),i.IM(i.Z_(),m)),y=i.Ry({type:i.i0("text"),text:i.Z_(),providerOptions:v.optional()}),_=i.Ry({type:i.i0("image"),image:i.G0([h,i.Pp(URL)]),mediaType:i.Z_().optional(),providerOptions:v.optional()}),g=i.Ry({type:i.i0("file"),data:i.G0([h,i.Pp(URL)]),filename:i.Z_().optional(),mediaType:i.Z_(),providerOptions:v.optional()}),I=i.Ry({type:i.i0("reasoning"),text:i.Z_(),providerOptions:v.optional()}),E=i.Ry({type:i.i0("tool-call"),toolCallId:i.Z_(),toolName:i.Z_(),input:i._4(),providerOptions:v.optional(),providerExecuted:i.O7().optional()}),f=i.VK("type",[i.Ry({type:i.i0("text"),value:i.Z_()}),i.Ry({type:i.i0("json"),value:m}),i.Ry({type:i.i0("error-text"),value:i.Z_()}),i.Ry({type:i.i0("error-json"),value:m}),i.Ry({type:i.i0("content"),value:i.IX(i.G0([i.Ry({type:i.i0("text"),text:i.Z_()}),i.Ry({type:i.i0("media"),data:i.Z_(),mediaType:i.Z_()})]))})]),R=i.Ry({type:i.i0("tool-result"),toolCallId:i.Z_(),toolName:i.Z_(),output:f,providerOptions:v.optional()}),b=i.Ry({role:i.i0("system"),content:i.Z_(),providerOptions:v.optional()}),T=i.Ry({role:i.i0("user"),content:i.G0([i.Z_(),i.IX(i.G0([y,_,g]))]),providerOptions:v.optional()}),x=i.Ry({role:i.i0("assistant"),content:i.G0([i.Z_(),i.IX(i.G0([y,g,I,E,R]))]),providerOptions:v.optional()}),A=i.Ry({role:i.i0("tool"),content:i.IX(R),providerOptions:v.optional()});i.G0([b,T,x,A]),(0,o.bF)({prefix:"aitxt",size:24}),TransformStream;var M=(0,o.cX)(()=>(0,o.r0)(i.G0([i.cf({type:i.i0("text-start"),id:i.Z_(),providerMetadata:v.optional()}),i.cf({type:i.i0("text-delta"),id:i.Z_(),delta:i.Z_(),providerMetadata:v.optional()}),i.cf({type:i.i0("text-end"),id:i.Z_(),providerMetadata:v.optional()}),i.cf({type:i.i0("error"),errorText:i.Z_()}),i.cf({type:i.i0("tool-input-start"),toolCallId:i.Z_(),toolName:i.Z_(),providerExecuted:i.O7().optional(),dynamic:i.O7().optional()}),i.cf({type:i.i0("tool-input-delta"),toolCallId:i.Z_(),inputTextDelta:i.Z_()}),i.cf({type:i.i0("tool-input-available"),toolCallId:i.Z_(),toolName:i.Z_(),input:i._4(),providerExecuted:i.O7().optional(),providerMetadata:v.optional(),dynamic:i.O7().optional()}),i.cf({type:i.i0("tool-input-error"),toolCallId:i.Z_(),toolName:i.Z_(),input:i._4(),providerExecuted:i.O7().optional(),providerMetadata:v.optional(),dynamic:i.O7().optional(),errorText:i.Z_()}),i.cf({type:i.i0("tool-output-available"),toolCallId:i.Z_(),output:i._4(),providerExecuted:i.O7().optional(),dynamic:i.O7().optional(),preliminary:i.O7().optional()}),i.cf({type:i.i0("tool-output-error"),toolCallId:i.Z_(),errorText:i.Z_(),providerExecuted:i.O7().optional(),dynamic:i.O7().optional()}),i.cf({type:i.i0("reasoning-start"),id:i.Z_(),providerMetadata:v.optional()}),i.cf({type:i.i0("reasoning-delta"),id:i.Z_(),delta:i.Z_(),providerMetadata:v.optional()}),i.cf({type:i.i0("reasoning-end"),id:i.Z_(),providerMetadata:v.optional()}),i.cf({type:i.i0("source-url"),sourceId:i.Z_(),url:i.Z_(),title:i.Z_().optional(),providerMetadata:v.optional()}),i.cf({type:i.i0("source-document"),sourceId:i.Z_(),mediaType:i.Z_(),title:i.Z_(),filename:i.Z_().optional(),providerMetadata:v.optional()}),i.cf({type:i.i0("file"),url:i.Z_(),mediaType:i.Z_(),providerMetadata:v.optional()}),i.cf({type:i.PG(e=>"string"==typeof e&&e.startsWith("data-"),{message:'Type must start with "data-"'}),id:i.Z_().optional(),data:i._4(),transient:i.O7().optional()}),i.cf({type:i.i0("start-step")}),i.cf({type:i.i0("finish-step")}),i.cf({type:i.i0("start"),messageId:i.Z_().optional(),messageMetadata:i._4().optional()}),i.cf({type:i.i0("finish"),finishReason:i.Km(["stop","length","content-filter","tool-calls","error","other","unknown"]).optional(),messageMetadata:i._4().optional()}),i.cf({type:i.i0("abort")}),i.cf({type:i.i0("message-metadata"),messageMetadata:i._4()})])));async function C(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=await (0,o.NX)({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await (0,o.NX)({text:function(e){let t=["ROOT"],a=-1,r=null;function o(e,o,s){switch(e){case'"':a=o,t.pop(),t.push(s),t.push("INSIDE_STRING");break;case"f":case"t":case"n":a=o,r=o,t.pop(),t.push(s),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(s),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=o,t.pop(),t.push(s),t.push("INSIDE_NUMBER");break;case"{":a=o,t.pop(),t.push(s),t.push("INSIDE_OBJECT_START");break;case"[":a=o,t.pop(),t.push(s),t.push("INSIDE_ARRAY_START")}}function s(e,r){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=r,t.pop()}}function i(e,r){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=r,t.pop()}}for(let l=0;l<e.length;l++){let n= __get$(e,l) ;switch( __get$(t,t.length-1) ){case"ROOT":o(n,l,"FINISH");break;case"INSIDE_OBJECT_START":switch(n){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":a=l,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===n&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===n&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===n&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":o(n,l,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":s(n,l);break;case"INSIDE_STRING":switch(n){case'"':t.pop(),a=l;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:a=l}break;case"INSIDE_ARRAY_START":"]"===n?(a=l,t.pop()):(a=l,o(n,l,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(n){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=l,t.pop();break;default:a=l}break;case"INSIDE_ARRAY_AFTER_COMMA":o(n,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),a=l;break;case"INSIDE_NUMBER":switch(n){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=l;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"=== __get$(t,t.length-1) &&i(n,l),"INSIDE_OBJECT_AFTER_VALUE"=== __get$(t,t.length-1) &&s(n,l);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"=== __get$(t,t.length-1) &&s(n,l);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"=== __get$(t,t.length-1) &&i(n,l);break;default:t.pop()}break;case"INSIDE_LITERAL":{let o=e.substring(r,l+1);"false".startsWith(o)||"true".startsWith(o)||"null".startsWith(o)?a=l:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"=== __get$(t,t.length-1) ?s(n,l):"INSIDE_ARRAY_AFTER_VALUE"=== __get$(t,t.length-1) &&i(n,l))}}}let l=e.slice(0,a+1);for(let a=t.length-1;a>=0;a--)switch( __get$(t,a) ){case"INSIDE_STRING":l+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":l+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":l+="]";break;case"INSIDE_LITERAL":{let t=e.substring(r,e.length);"true".startsWith(t)?l+="true".slice(t.length):"false".startsWith(t)?l+="false".slice(t.length):"null".startsWith(t)&&(l+="null".slice(t.length))}}return l}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}function S(e){return e.type.startsWith("tool-")}function N(e){return S(e)||"dynamic-tool"===e.type}function Z(e){return e.type.split("-").slice(1).join("-")}async function w( _hh$temp1 ){ var e=_hh$temp1.stream,t=_hh$temp1.onError; let a=e.getReader();try{for(;;){ let _hh$temp2=await a.read(),e=_hh$temp2.done; if(e)break}}catch(e){null==t||t(e)}finally{a.releaseLock()}}(0,o.bF)({prefix:"aitxt",size:24}),(0,o.bF)({prefix:"aiobj",size:24});var O=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(e){return new Promise((t,a)=>{this.queue.push(async()=>{try{await e(),t()}catch(e){a(e)}}),this.processQueue()})}};(0,o.bF)({prefix:"aiobj",size:24}),((e,t)=>{for(var a in t)l(e,a,{get: __get$(t,a) ,enumerable:!0})})({},{object:()=>D,text:()=>k});var k=()=>({type:"text",responseFormat:{type:"text"},parsePartial: async _hh$temp3=>{var e=_hh$temp3.text;return{partial:e};} ,parseOutput: async _hh$temp4=>{var e=_hh$temp4.text;return e;} }),D=( _hh$temp5 )=>{ var e=_hh$temp5.schema; let t=(0,o.C3)(e);return{type:"object",responseFormat:{type:"json",schema:t.jsonSchema},async parsePartial( _hh$temp6 ){ var e=_hh$temp6.text; let t=await C(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{let e=t.state;throw Error(`Unsupported parse state: ${e}`)}}},async parseOutput( _hh$temp7 ,a){ var e=_hh$temp7.text; let r=await (0,o.NX)({text:e});if(!r.success)throw new u({message:"No object generated: could not parse the response.",cause:r.error,text:e,response:a.response,usage:a.usage,finishReason:a.finishReason});let s=await (0,o.pW)({value:r.value,schema:t});if(!s.success)throw new u({message:"No object generated: response did not match schema.",cause:s.error,text:e,response:a.response,usage:a.usage,finishReason:a.finishReason});return s.value}}};async function F(e){if(null==e)return[];if(!globalThis.FileList||!(e instanceof globalThis.FileList))throw Error("FileList is not supported in the current environment");return Promise.all(Array.from(e).map(async e=>{ let _hh$temp8=e,t=_hh$temp8.name,a=_hh$temp8.type; return{type:"file",mediaType:a,filename:t,url:await new Promise((t,a)=>{let r=new FileReader;r.onload=e=>{var a;t(null==(a=e.target)?void 0:a.result)},r.onerror=e=>a(e),r.readAsDataURL(e)})}}))}Symbol.for("vercel.ai.error.AI_NoSuchProviderError"),s.JJ,s.AX;var P=class{constructor( _hh$temp9 ){ var _hh$temp9$api=_hh$temp9.api,e=_hh$temp9$api===void 0?"/api/chat":_hh$temp9$api,t=_hh$temp9.credentials,a=_hh$temp9.headers,r=_hh$temp9.body,o=_hh$temp9.fetch,s=_hh$temp9.prepareSendMessagesRequest,i=_hh$temp9.prepareReconnectToStreamRequest; this.api=e,this.credentials=t,this.headers=a,this.body=r,this.fetch=o,this.prepareSendMessagesRequest=s,this.prepareReconnectToStreamRequest=i}async sendMessages( _hh$temp10 ){ var e=_hh$temp10.abortSignal,t=__rest$Object(_hh$temp10,["abortSignal"]); var a,r,s,i,l;let n=await (0,o.DB)(this.body),p=await (0,o.DB)(this.headers),d=await (0,o.DB)(this.credentials),u={...(0,o.kh)(p),...(0,o.kh)(t.headers)},h=await (null==(a=this.prepareSendMessagesRequest)?void 0:a.call(this,{api:this.api,id:t.chatId,messages:t.messages,body:{...n,...t.body},headers:u,credentials:d,requestMetadata:t.metadata,trigger:t.trigger,messageId:t.messageId})),m=null!=(r=null==h?void 0:h.api)?r:this.api,v=(null==h?void 0:h.headers)!==void 0?(0,o.kh)(h.headers):u,y=(null==h?void 0:h.body)!==void 0?h.body:{...n,...t.body,id:t.chatId,messages:t.messages,trigger:t.trigger,messageId:t.messageId},_=null!=(s=null==h?void 0:h.credentials)?s:d,g=null!=(i=this.fetch)?i:globalThis.fetch,I=await g(m,{method:"POST",headers:(0,o.CR)({"Content-Type":"application/json",...v},`ai-sdk/${c}`,(0,o.gJ)()),body:JSON.stringify(y),credentials:_,signal:e});if(!I.ok)throw Error(null!=(l=await I.text())?l:"Failed to fetch the chat response.");if(!I.body)throw Error("The response body is empty.");return this.processResponseStream(I.body)}async reconnectToStream(e){var t,a,r,s,i;let l=await (0,o.DB)(this.body),n=await (0,o.DB)(this.headers),p=await (0,o.DB)(this.credentials),d={...(0,o.kh)(n),...(0,o.kh)(e.headers)},u=await (null==(t=this.prepareReconnectToStreamRequest)?void 0:t.call(this,{api:this.api,id:e.chatId,body:{...l,...e.body},headers:d,credentials:p,requestMetadata:e.metadata})),h=null!=(a=null==u?void 0:u.api)?a:`${this.api}/${e.chatId}/stream`,m=(null==u?void 0:u.headers)!==void 0?(0,o.kh)(u.headers):d,v=null!=(r=null==u?void 0:u.credentials)?r:p,y=null!=(s=this.fetch)?s:globalThis.fetch,_=await y(h,{method:"GET",headers:(0,o.CR)(m,`ai-sdk/${c}`,(0,o.gJ)()),credentials:v});if(204===_.status)return null;if(!_.ok)throw Error(null!=(i=await _.text())?i:"Failed to fetch the chat response.");if(!_.body)throw Error("The response body is empty.");return this.processResponseStream(_.body)}},B=class extends P{constructor(e={}){super(e)}processResponseStream(e){return(0,o.RF)({stream:e,schema:M}).pipeThrough(new TransformStream({async transform(e,t){if(!e.success)throw e.error;t.enqueue(e.value)}}))}},L=class{constructor( _hh$temp11 ){ var _hh$temp11$generateId=_hh$temp11.generateId,e=_hh$temp11$generateId===void 0?o.Ox:_hh$temp11$generateId,_hh$temp11$id=_hh$temp11.id,t=_hh$temp11$id===void 0?e():_hh$temp11$id,_hh$temp11$transport=_hh$temp11.transport,a=_hh$temp11$transport===void 0?new B():_hh$temp11$transport,r=_hh$temp11.messageMetadataSchema,s=_hh$temp11.dataPartSchemas,i=_hh$temp11.state,l=_hh$temp11.onError,n=_hh$temp11.onToolCall,p=_hh$temp11.onFinish,d=_hh$temp11.onData,u=_hh$temp11.sendAutomaticallyWhen; this.activeResponse=void 0,this.jobExecutor=new O,this.sendMessage=async(e,t)=>{var a,r,o,s;let i;if(null==e){await this.makeRequest({trigger:"submit-message",messageId:null==(a=this.lastMessage)?void 0:a.id,...t});return}if(i="text"in e||"files"in e?{parts:[...Array.isArray(e.files)?e.files:await F(e.files),..."text"in e&&null!=e.text?[{type:"text",text:e.text}]:[]]}:e,null!=e.messageId){let t=this.state.messages.findIndex(t=>t.id===e.messageId);if(-1===t)throw Error(`message with id ${e.messageId} not found`);if("user"!== __get$(this.state.messages,t) .role)throw Error(`message with id ${e.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,t+1),this.state.replaceMessage(t,{...i,id:e.messageId,role:null!=(r=i.role)?r:"user",metadata:e.metadata})}else this.state.pushMessage({...i,id:null!=(o=i.id)?o:this.generateId(),role:null!=(s=i.role)?s:"user",metadata:e.metadata});await this.makeRequest({trigger:"submit-message",messageId:e.messageId,...t})},this.regenerate=async( _hh$temp12 ={})=>{ var e=_hh$temp12.messageId,t=__rest$Object(_hh$temp12,["messageId"]); let a=null==e?this.state.messages.length-1:this.state.messages.findIndex(t=>t.id===e);if(-1===a)throw Error(`message ${e} not found`);this.state.messages=this.state.messages.slice(0,"assistant"=== __get$(this.messages,a) .role?a:a+1),await this.makeRequest({trigger:"regenerate-message",messageId:e,...t})},this.resumeStream=async(e={})=>{await this.makeRequest({trigger:"resume-stream",...e})},this.clearError=()=>{"error"===this.status&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolOutput= async _hh$temp13=>{var _hh$temp13$state=_hh$temp13.state,e=_hh$temp13$state===void 0?"output-available":_hh$temp13$state,t=_hh$temp13.tool,a=_hh$temp13.toolCallId,r=_hh$temp13.output,o=_hh$temp13.errorText;return this.jobExecutor.run(async ()=>{var t,s;let i=this.state.messages,l=__get$(i,i.length-1);this.state.replaceMessage(i.length-1,{...l,parts:l.parts.map(t=>N(t)&&t.toolCallId===a?{...t,state:e,output:r,errorText:o}:t)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(t=>N(t)&&t.toolCallId===a?{...t,state:e,output:r,errorText:o}:t)),(("streaming"!==this.status&&"submitted"!==this.status)&&(null==(t=this.sendAutomaticallyWhen)?void 0:t.call(this,{messages:this.state.messages})))&&this.makeRequest({trigger:"submit-message",messageId:null==(s=this.lastMessage)?void 0:s.id});});} ,this.addToolResult=this.addToolOutput,this.stop=async()=>{var e;("streaming"===this.status||"submitted"===this.status)&&(null==(e=this.activeResponse)?void 0:e.abortController)&&this.activeResponse.abortController.abort()},this.id=t,this.transport=a,this.generateId=e,this.messageMetadataSchema=r,this.dataPartSchemas=s,this.state=i,this.onError=l,this.onToolCall=n,this.onFinish=p,this.onData=d,this.sendAutomaticallyWhen=u}get status(){return this.state.status}setStatus( _hh$temp14 ){ var e=_hh$temp14.status,t=_hh$temp14.error; this.status!==e&&(this.state.status=e,this.state.error=t)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return  __get$(this.state.messages,this.state.messages.length-1) }set messages(e){this.state.messages=e}async makeRequest( _hh$temp15 ){ var e=_hh$temp15.trigger,t=_hh$temp15.metadata,a=_hh$temp15.headers,r=_hh$temp15.body,s=_hh$temp15.messageId; var i,l,n,p;this.setStatus({status:"submitted",error:void 0});let d=this.lastMessage,u=!1,c=!1,h=!1;try{let i;let l={state:function( _hh$temp16 ){ var e=_hh$temp16.lastMessage,t=_hh$temp16.messageId; return{message:(null==e?void 0:e.role)==="assistant"?e:{id:t,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}({lastMessage:this.state.snapshot(d),messageId:this.generateId()}),abortController:new AbortController};if(l.abortController.signal.addEventListener("abort",()=>{u=!0}),this.activeResponse=l,"resume-stream"===e){let e=await this.transport.reconnectToStream({chatId:this.id,metadata:t,headers:a,body:r});if(null==e){this.setStatus({status:"ready"});return}i=e}else i=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:l.abortController.signal,metadata:t,headers:a,body:r,trigger:e,messageId:s});await w({stream:function( _hh$temp17 ){ var e=_hh$temp17.stream,t=_hh$temp17.messageMetadataSchema,a=_hh$temp17.dataPartSchemas,r=_hh$temp17.runUpdateMessageJob,s=_hh$temp17.onError,i=_hh$temp17.onToolCall,l=_hh$temp17.onData; return e.pipeThrough( new TransformStream({async transform(e,n){await r(async _hh$temp18=>{var r=_hh$temp18.state,p=_hh$temp18.write;var d,u,c,h;function m(e){let t=r.message.parts.filter(S).find(t=>t.toolCallId===e);if(null==t)throw Error("tool-output-error must be preceded by a tool-input-available");return t;}function v(e){let t=r.message.parts.filter(e=>"dynamic-tool"===e.type).find(t=>t.toolCallId===e);if(null==t)throw Error("tool-output-error must be preceded by a tool-input-available");return t;}function y(e){var t;let a=r.message.parts.find(t=>S(t)&&t.toolCallId===e.toolCallId);null!=a?(a.state=e.state,a.input=e.input,a.output=e.output,a.errorText=e.errorText,a.rawInput=e.rawInput,a.preliminary=e.preliminary,a.providerExecuted=null!=(t=e.providerExecuted)?t:a.providerExecuted,(null!=e.providerMetadata&&"input-available"===a.state)&&(a.callProviderMetadata=e.providerMetadata)):r.message.parts.push({type:`tool-${e.toolName}`,toolCallId:e.toolCallId,state:e.state,input:e.input,output:e.output,rawInput:e.rawInput,errorText:e.errorText,providerExecuted:e.providerExecuted,preliminary:e.preliminary,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}});}function _(e){var t,a;let o=r.message.parts.find(t=>"dynamic-tool"===t.type&&t.toolCallId===e.toolCallId);null!=o?(o.state=e.state,o.toolName=e.toolName,o.input=e.input,o.output=e.output,o.errorText=e.errorText,o.rawInput=null!=(t=e.rawInput)?t:o.rawInput,o.preliminary=e.preliminary,o.providerExecuted=null!=(a=e.providerExecuted)?a:o.providerExecuted,(null!=e.providerMetadata&&"input-available"===o.state)&&(o.callProviderMetadata=e.providerMetadata)):r.message.parts.push({type:"dynamic-tool",toolName:e.toolName,toolCallId:e.toolCallId,state:e.state,input:e.input,output:e.output,errorText:e.errorText,preliminary:e.preliminary,providerExecuted:e.providerExecuted,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}});}async function g(e){if(null!=e){let a=null!=r.message.metadata?function e(t,a){if(void 0===t&&void 0===a)return;if(void 0===t)return a;if(void 0===a)return t;let r={...t};for(let o in a)if(Object.prototype.hasOwnProperty.call(a,o)){let s=__get$(a,o);if(void 0===s)continue;let i=o in t?__get$(t,o):void 0,l=(((null!==s&&"object"==typeof s)&&!Array.isArray(s))&&!(s instanceof Date))&&!(s instanceof RegExp),n=(((null!=i&&"object"==typeof i)&&!Array.isArray(i))&&!(i instanceof Date))&&!(i instanceof RegExp);l&&n?__set$(r,o,e(i,s)):__set$(r,o,s);}return r;}(r.message.metadata,e):e;null!=t&&await (0,o.rJ)({value:a,schema:t}),r.message.metadata=a;}}switch(e.type){case"text-start":{let t={type:"text",text:"",providerMetadata:e.providerMetadata,state:"streaming"};__set$(r.activeTextParts,e.id,t),r.message.parts.push(t),p();break;}case"text-delta":{let t=__get$(r.activeTextParts,e.id);t.text+=e.delta,t.providerMetadata=null!=(d=e.providerMetadata)?d:t.providerMetadata,p();break;}case"text-end":{let t=__get$(r.activeTextParts,e.id);t.state="done",t.providerMetadata=null!=(u=e.providerMetadata)?u:t.providerMetadata,delete r.activeTextParts[e.id],p();break;}case"reasoning-start":{let t={type:"reasoning",text:"",providerMetadata:e.providerMetadata,state:"streaming"};__set$(r.activeReasoningParts,e.id,t),r.message.parts.push(t),p();break;}case"reasoning-delta":{let t=__get$(r.activeReasoningParts,e.id);t.text+=e.delta,t.providerMetadata=null!=(c=e.providerMetadata)?c:t.providerMetadata,p();break;}case"reasoning-end":{let t=__get$(r.activeReasoningParts,e.id);t.providerMetadata=null!=(h=e.providerMetadata)?h:t.providerMetadata,t.state="done",delete r.activeReasoningParts[e.id],p();break;}case"file":r.message.parts.push({type:"file",mediaType:e.mediaType,url:e.url}),p();break;case"source-url":r.message.parts.push({type:"source-url",sourceId:e.sourceId,url:e.url,title:e.title,providerMetadata:e.providerMetadata}),p();break;case"source-document":r.message.parts.push({type:"source-document",sourceId:e.sourceId,mediaType:e.mediaType,title:e.title,filename:e.filename,providerMetadata:e.providerMetadata}),p();break;case"tool-input-start":{let t=r.message.parts.filter(S);__set$(r.partialToolCalls,e.toolCallId,{text:"",toolName:e.toolName,index:t.length,dynamic:e.dynamic}),e.dynamic?_({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0,providerExecuted:e.providerExecuted}):y({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0,providerExecuted:e.providerExecuted}),p();break;}case"tool-input-delta":{let t=__get$(r.partialToolCalls,e.toolCallId);t.text+=e.inputTextDelta;let _hh$temp19=await C(t.text),a=_hh$temp19.value;t.dynamic?_({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:a}):y({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:a}),p();break;}case"tool-input-available":e.dynamic?_({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}):y({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),p(),(i&&!e.providerExecuted)&&await i({toolCall:e});break;case"tool-input-error":e.dynamic?_({toolCallId:e.toolCallId,toolName:e.toolName,state:"output-error",input:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}):y({toolCallId:e.toolCallId,toolName:e.toolName,state:"output-error",input:void 0,rawInput:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),p();break;case"tool-output-available":if(e.dynamic){let t=v(e.toolCallId);_({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-available",input:t.input,output:e.output,preliminary:e.preliminary});}else{let t=m(e.toolCallId);y({toolCallId:e.toolCallId,toolName:Z(t),state:"output-available",input:t.input,output:e.output,providerExecuted:e.providerExecuted,preliminary:e.preliminary});}p();break;case"tool-output-error":if(e.dynamic){let t=v(e.toolCallId);_({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-error",input:t.input,errorText:e.errorText,providerExecuted:e.providerExecuted});}else{let t=m(e.toolCallId);y({toolCallId:e.toolCallId,toolName:Z(t),state:"output-error",input:t.input,rawInput:t.rawInput,errorText:e.errorText,providerExecuted:e.providerExecuted});}p();break;case"start-step":r.message.parts.push({type:"step-start"});break;case"finish-step":r.activeTextParts={},r.activeReasoningParts={};break;case"start":null!=e.messageId&&(r.message.id=e.messageId),await g(e.messageMetadata),(null!=e.messageId||null!=e.messageMetadata)&&p();break;case"finish":null!=e.finishReason&&(r.finishReason=e.finishReason),await g(e.messageMetadata),null!=e.messageMetadata&&p();break;case"message-metadata":await g(e.messageMetadata),null!=e.messageMetadata&&p();break;case"error":null==s||s(Error(e.errorText));break;default:if(e.type.startsWith("data-")){if((null==a?void 0:__get$(a,e.type))!=null&&await (0,o.rJ)({value:e.data,schema:__get$(a,e.type)}),e.transient){null==l||l(e);break;}let t=null!=e.id?r.message.parts.find(t=>e.type===t.type&&e.id===t.id):void 0;null!=t?t.data=e.data:r.message.parts.push(e),null==l||l(e),p();}}n.enqueue(e);});}}) )}({stream:i,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:e=>this.jobExecutor.run(()=>e({state:l.state,write:()=>{var e;this.setStatus({status:"streaming"}),l.state.message.id===(null==(e=this.lastMessage)?void 0:e.id)?this.state.replaceMessage(this.state.messages.length-1,l.state.message):this.state.pushMessage(l.state.message)}})),onError:e=>{throw e}}),onError:e=>{throw e}}),this.setStatus({status:"ready"})}catch(e){if(u||"AbortError"===e.name)return u=!0,this.setStatus({status:"ready"}),null;h=!0,e instanceof TypeError&&(e.message.toLowerCase().includes("fetch")||e.message.toLowerCase().includes("network"))&&(c=!0),this.onError&&e instanceof Error&&this.onError(e),this.setStatus({status:"error",error:e})}finally{try{null==(l=this.onFinish)||l.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:u,isDisconnect:c,isError:h,finishReason:null==(i=this.activeResponse)?void 0:i.state.finishReason})}catch(e){console.error(e)}this.activeResponse=void 0}(null==(n=this.sendAutomaticallyWhen)?void 0:n.call(this,{messages:this.state.messages}))&&!h&&await this.makeRequest({trigger:"submit-message",messageId:null==(p=this.lastMessage)?void 0:p.id,metadata:t,headers:a,body:r})}};(0,o.cX)(()=>(0,o.r0)(i.IX(i.Ry({id:i.Z_(),role:i.Km(["system","user","assistant"]),metadata:i._4().optional(),parts:i.IX(i.G0([i.Ry({type:i.i0("text"),text:i.Z_(),state:i.Km(["streaming","done"]).optional(),providerMetadata:v.optional()}),i.Ry({type:i.i0("reasoning"),text:i.Z_(),state:i.Km(["streaming","done"]).optional(),providerMetadata:v.optional()}),i.Ry({type:i.i0("source-url"),sourceId:i.Z_(),url:i.Z_(),title:i.Z_().optional(),providerMetadata:v.optional()}),i.Ry({type:i.i0("source-document"),sourceId:i.Z_(),mediaType:i.Z_(),title:i.Z_(),filename:i.Z_().optional(),providerMetadata:v.optional()}),i.Ry({type:i.i0("file"),mediaType:i.Z_(),filename:i.Z_().optional(),url:i.Z_(),providerMetadata:v.optional()}),i.Ry({type:i.i0("step-start")}),i.Ry({type:i.Z_().startsWith("data-"),id:i.Z_().optional(),data:i._4()}),i.Ry({type:i.i0("dynamic-tool"),toolName:i.Z_(),toolCallId:i.Z_(),state:i.i0("input-streaming"),input:i._4().optional(),providerExecuted:i.O7().optional(),output:i.Fi().optional(),errorText:i.Fi().optional()}),i.Ry({type:i.i0("dynamic-tool"),toolName:i.Z_(),toolCallId:i.Z_(),state:i.i0("input-available"),input:i._4(),providerExecuted:i.O7().optional(),output:i.Fi().optional(),errorText:i.Fi().optional(),callProviderMetadata:v.optional()}),i.Ry({type:i.i0("dynamic-tool"),toolName:i.Z_(),toolCallId:i.Z_(),state:i.i0("output-available"),input:i._4(),providerExecuted:i.O7().optional(),output:i._4(),errorText:i.Fi().optional(),callProviderMetadata:v.optional(),preliminary:i.O7().optional()}),i.Ry({type:i.i0("dynamic-tool"),toolName:i.Z_(),toolCallId:i.Z_(),state:i.i0("output-error"),input:i._4(),providerExecuted:i.O7().optional(),output:i.Fi().optional(),errorText:i.Z_(),callProviderMetadata:v.optional()}),i.Ry({type:i.Z_().startsWith("tool-"),toolCallId:i.Z_(),state:i.i0("input-streaming"),providerExecuted:i.O7().optional(),input:i._4().optional(),output:i.Fi().optional(),errorText:i.Fi().optional(),approval:i.Fi().optional()}),i.Ry({type:i.Z_().startsWith("tool-"),toolCallId:i.Z_(),state:i.i0("input-available"),providerExecuted:i.O7().optional(),input:i._4(),output:i.Fi().optional(),errorText:i.Fi().optional(),callProviderMetadata:v.optional(),approval:i.Fi().optional()}),i.Ry({type:i.Z_().startsWith("tool-"),toolCallId:i.Z_(),state:i.i0("approval-requested"),input:i._4(),providerExecuted:i.O7().optional(),output:i.Fi().optional(),errorText:i.Fi().optional(),callProviderMetadata:v.optional(),approval:i.Ry({id:i.Z_(),approved:i.Fi().optional(),reason:i.Fi().optional()})}),i.Ry({type:i.Z_().startsWith("tool-"),toolCallId:i.Z_(),state:i.i0("approval-responded"),input:i._4(),providerExecuted:i.O7().optional(),output:i.Fi().optional(),errorText:i.Fi().optional(),callProviderMetadata:v.optional(),approval:i.Ry({id:i.Z_(),approved:i.O7(),reason:i.Z_().optional()})}),i.Ry({type:i.Z_().startsWith("tool-"),toolCallId:i.Z_(),state:i.i0("output-available"),providerExecuted:i.O7().optional(),input:i._4(),output:i._4(),errorText:i.Fi().optional(),callProviderMetadata:v.optional(),preliminary:i.O7().optional(),approval:i.Ry({id:i.Z_(),approved:i.i0(!0),reason:i.Z_().optional()}).optional()}),i.Ry({type:i.Z_().startsWith("tool-"),toolCallId:i.Z_(),state:i.i0("output-error"),providerExecuted:i.O7().optional(),input:i._4(),output:i.Fi().optional(),errorText:i.Z_(),callProviderMetadata:v.optional(),approval:i.Ry({id:i.Z_(),approved:i.i0(!0),reason:i.Z_().optional()}).optional()}),i.Ry({type:i.Z_().startsWith("tool-"),toolCallId:i.Z_(),state:i.i0("output-denied"),providerExecuted:i.O7().optional(),input:i._4(),output:i.Fi().optional(),errorText:i.Fi().optional(),callProviderMetadata:v.optional(),approval:i.Ry({id:i.Z_(),approved:i.i0(!1),reason:i.Z_().optional()})})])).nonempty("Message must contain at least one part")})).nonempty("Messages array must not be empty")))}}]);
/*hammerhead|script|end*/
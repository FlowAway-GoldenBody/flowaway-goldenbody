/*hammerhead|script|start*/if (typeof window !== 'undefined' && window){window['hammerhead|process-dom-method'] && window['hammerhead|process-dom-method']();if (window.__get$ && typeof __get$ === 'undefined')var __get$Loc = window.__get$Loc,__set$Loc = window.__set$Loc,__set$ = window.__set$,__get$ = window.__get$,__call$ = window.__call$,__get$Eval = window.__get$Eval,__proc$Script = window.__proc$Script,__proc$Html = window.__proc$Html,__get$PostMessage = window.__get$PostMessage,__get$ProxyUrl = window.__get$ProxyUrl,__rest$Array = window.__rest$Array,__rest$Object = window.__rest$Object,__arrayFrom$ = window.__arrayFrom$;} else {if (typeof __get$ === 'undefined')var __get$Loc = function(l){return l},__set$Loc = function(l,v){return l = v},__set$ = function(o,p,v){return o[p] = v},__get$ = function(o,p){return o[p]},__call$ = function(o,p,a){return o[p].apply(o,a)},__get$Eval = function(e){return e},__proc$Script = function(s){return s},__proc$Html = function(h){return h},__get$PostMessage = function(w,p){return arguments.length===1?w.postMessage:p},__get$ProxyUrl = function(u,d){return u},__rest$Array = function(a,i){return Array.prototype.slice.call(a, i)},__rest$Object = function(o,p){var k=Object.keys(o),n={};for(var i=0;i<k.length;++i)if(p.indexOf(k[i])<0)n[k[i]]=o[k[i]];return n},__arrayFrom$ = function(r){if(!r)return r;return!Array.isArray(r)&&"function"==typeof r[Symbol.iterator]?Array.from(r):r};if (typeof importScripts !== "undefined" && /\[native code]/g.test(importScripts.toString())) {var __getWorkerSettings$ = function () {return null};importScripts((location.origin || (location.protocol + "//" + location.host)) + "/worker-hammerhead.js");}}/*hammerhead|script|processing-header-end*/
var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t= __get$(arguments,i) ;for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&( __set$(n,r,__get$(t,r)) )}return n},__assign.apply(this,arguments)},CopilotSearch;(function(n){var t;(function(t){function a(t){h||(h=new v(t),n.MediaCanvas.OverlayManager=h)}var e,f,o,i,r,s;(function(n){n.CloseOverlay="mm.closeIFrame";n.InitOverlayManager="mm.overlay";n.MediaCanvasReady="mc.ready";n.OpenOverlay="CopilotSearchOpenImageOverlay";n.OverlayNavigationData="cs.navdata"})(e=t.EventStrings||(t.EventStrings={})),function(n){n.FullView="fv";n.OverlayHidden="off";n.OverlayVisible="on"}(f||(f={})),function(n){n.CloseButton="mc_close";n.Iframe="mc_ifr";n.IframeContainer="mc_cont";n.Overlay="mc_ovr"}(o||(o={})),function(n){n.AriaHidden="aria-hidden";n.Click="click";n.Enter="Enter";n.Escape="Escape";n.False="false";n.Hidden="hidden";n.Iframe="iframe";n.Keydown="keydown";n.Message="message";n.Resize="resize";n.Tab="Tab";n.True="true";n.Undefined="undefined"}(i||(i={})),function(n){n.Click="ci.click";n.ClickOutside="click_out";n.Close="Close";n.CloseButton="close_btn";n.Escape="esc";n.InvalidMessage="invalid";n.LogId="cs_media_canvas";n.MalformedMessage="malformed";n.Message="msg";n.Open="Open"}(r||(r={})),function(n){n.LogKey="ContentType";n.MediaCanvas="MediaCanvas"}(s||(s={}));var h=null,u=typeof Log!==i.Undefined?Log.Log:null,l=typeof t.TestUtils!==i.Undefined?t.TestUtils:null,c=typeof CopilotSearchMessager!==i.Undefined?CopilotSearchMessager:null,v=function(){function n(n){var t=this;(this._prevFocusElement=null,this.bindMessageListener=function(){c&&c.bindMessageEvent(t.processCopilotMessage);sj_be(_w,i.Message,function(n){t.isMessageValid(n)&&(t.processCanvasMessage(n.data),c||t.processCopilotMessage(n.data))})},this.processCopilotMessage=function(n){var i;n.type===e.OpenOverlay&&t.handleInitMessageReceived((i=n.data)===null||i===void 0?void 0:i.image)},this.processCanvasMessage=function(n){var r;if(t._canvasContent&&(n===null||n===void 0?void 0:n.command))switch(n.command){case e.CloseOverlay:t.closeOverlay(i.Message);break;case e.MediaCanvasReady:if(!((r=t._imageData)===null||r===void 0?void 0:r.nav)||!(t._canvasContent instanceof HTMLIFrameElement)||typeof MMMessenger===i.Undefined)return;typeof MMMessenger!==i.Undefined&&MMMessenger.Post(t._canvasContent.contentWindow,e.OverlayNavigationData,{current:t._imageData.mcUrl,linkList:t._imageData.nav})}},this.handleInitMessageReceived=function(n){if(t._imageData&&t._imageData.id===n.id||!t.isTrustedUrl(n===null||n===void 0?void 0:n.mcUrl)){u===null||u===void 0?void 0:u(r.MalformedMessage,r.LogId,r.Message);return}t._imageData=__assign(__assign({},n),{height:n.height&&Number(n.height),width:n.width&&Number(n.width)});t._mcUrl=t._imageData.mcUrl;l&&(t._mcUrl=l.getMediaCanvasTestUrl(t._mcUrl));t.openOverlay(r.Message)},this.handleKeydown=function(n){if(n.key===i.Escape){t.closeOverlay(r.Escape);return}if(n.key===i.Enter&&t._closeButton&&n.target===t._closeButton){t.closeOverlay(r.CloseButton);return}t._canvasContent&&!t._canvasContainer.contains(n.target)&&(sj_pd(n),sj_sp(n),t.focusIframe())},this.handleClickOutside=function(n){var i,f=n.target;!f||f===t._canvasContent||((i=t._canvasContent)===null||i===void 0?void 0:i.contains(f))||(u===null||u===void 0?void 0:u(r.Click,r.LogId,r.ClickOutside),t.closeOverlay(r.ClickOutside))},this.handleCloseButtonClick=function(){u===null||u===void 0?void 0:u(r.Click,r.LogId,r.CloseButton);t.closeOverlay(r.CloseButton)},this.focusIframe=function(){if(t._canvasContent)try{t._canvasContent.contentWindow.focus()}catch(n){return}},n)&&(this._config=__assign({},n),this.assignHtmlElements(),this.bindMessageListener(),Lib.CssClass.add(this._overlayElement,f.FullView))}return n.prototype.createCanvasContent=function(){var n=sj_ce(i.Iframe,o.Iframe);return n.src=this._mcUrl,n},n.prototype.openOverlay=function(n){this._canvasContainer&&this._overlayElement&&!this._canvasContent&&this._mcUrl&&(this._canvasContent=this.createCanvasContent(),this._canvasContainer.appendChild(this._canvasContent),this._overlayElement.setAttribute(i.AriaHidden,i.False),_d.documentElement.style.overflow=i.Hidden,Lib.CssClass.remove(this._overlayElement,f.OverlayHidden),Lib.CssClass.add(this._overlayElement,f.OverlayVisible),sj_be(this._overlayElement,i.Click,this.handleClickOutside),sj_be(_w.top,i.Keydown,this.handleKeydown),this._closeButton&&sj_be(this._closeButton,i.Click,this.handleCloseButtonClick),this._prevFocusElement=_d.activeElement,this.focusIframe(),n&&(u===null||u===void 0?void 0:u(n,r.LogId,r.Open,!1,s.LogKey,s.MediaCanvas)))},n.prototype.closeOverlay=function(n){this._overlayElement&&this._canvasContainer&&this._canvasContent&&(this._overlayElement.setAttribute(i.AriaHidden,i.True),_d.documentElement.style.overflow="",Lib.CssClass.add(this._overlayElement,f.OverlayHidden),Lib.CssClass.remove(this._overlayElement,f.OverlayVisible),this._canvasContent.src="",this._canvasContainer.removeChild(this._canvasContent),this._canvasContent=null,this._imageData=null,this._mcUrl=null,sj_ue(this._overlayElement,i.Click,this.handleClickOutside),sj_ue(_w,i.Keydown,this.handleKeydown),this._closeButton&&sj_ue(this._closeButton,i.Click,this.handleCloseButtonClick),this._prevFocusElement&&(this._prevFocusElement.focus(),this._prevFocusElement=null),n&&(u===null||u===void 0?void 0:u(n,r.LogId,r.Close)))},n.prototype.assignHtmlElements=function(){this._overlayElement=_ge(o.Overlay);this._canvasContainer=_ge(o.IframeContainer);this._closeButton=_ge(o.CloseButton)},n.prototype.isMessageValid=function(n){var t=window.origin===n.origin||n.origin.startsWith(window.origin),i=!!n.data;return t&&i},n.prototype.isTrustedUrl=function(n){var t,i;if(!n)return!1;try{if((t= new URL(n,__get$(window,"location").origin) .hostname,t=== __get$(window,"location") .hostname)||(i=["bing.com","staging-bing-int.com","microsoft.com"],i.some(function(n){return t===n||t.endsWith("."+n)})))return!0}catch(f){u===null||u===void 0?void 0:u("ci.info",r.LogId,r.InvalidMessage,!1,n)}return!1},n}();t.init=a;sj_evt.bind(e.InitOverlayManager,function(n){a(n[1])},!0)})(t=n.MediaCanvas||(n.MediaCanvas={}))})(CopilotSearch||(CopilotSearch={}))
/*hammerhead|script|end*/
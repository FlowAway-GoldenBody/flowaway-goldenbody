/*hammerhead|script|start*/if (typeof window !== 'undefined' && window){window['hammerhead|process-dom-method'] && window['hammerhead|process-dom-method']();if (window.__get$ && typeof __get$ === 'undefined')var __get$Loc = window.__get$Loc,__set$Loc = window.__set$Loc,__set$ = window.__set$,__get$ = window.__get$,__call$ = window.__call$,__get$Eval = window.__get$Eval,__proc$Script = window.__proc$Script,__proc$Html = window.__proc$Html,__get$PostMessage = window.__get$PostMessage,__get$ProxyUrl = window.__get$ProxyUrl,__rest$Array = window.__rest$Array,__rest$Object = window.__rest$Object,__arrayFrom$ = window.__arrayFrom$;} else {if (typeof __get$ === 'undefined')var __get$Loc = function(l){return l},__set$Loc = function(l,v){return l = v},__set$ = function(o,p,v){return o[p] = v},__get$ = function(o,p){return o[p]},__call$ = function(o,p,a){return o[p].apply(o,a)},__get$Eval = function(e){return e},__proc$Script = function(s){return s},__proc$Html = function(h){return h},__get$PostMessage = function(w,p){return arguments.length===1?w.postMessage:p},__get$ProxyUrl = function(u,d){return u},__rest$Array = function(a,i){return Array.prototype.slice.call(a, i)},__rest$Object = function(o,p){var k=Object.keys(o),n={};for(var i=0;i<k.length;++i)if(p.indexOf(k[i])<0)n[k[i]]=o[k[i]];return n},__arrayFrom$ = function(r){if(!r)return r;return!Array.isArray(r)&&"function"==typeof r[Symbol.iterator]?Array.from(r):r};if (typeof importScripts !== "undefined" && /\[native code]/g.test(importScripts.toString())) {var __getWorkerSettings$ = function () {return null};importScripts((location.origin || (location.protocol + "//" + location.host)) + "/worker-hammerhead.js");}}/*hammerhead|script|processing-header-end*/
var __assign,__spreadArray,__awaiter,__generator,CopilotSearchMessagerIframe,CopilotSearchMessager,CopilotSearch;__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t= __get$(arguments,i) ;for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&( __set$(n,r,__get$(t,r)) )}return n},__assign.apply(this,arguments)},function(n){var t;(function(t){function b(n){switch(n){case r.TurnStart:g();return;case r.ConversationStart:nt();return;default:return}}function k(){a=!0}function d(){e++}function o(){return e==1&&!a?r.NavigationStart:r.TurnStart+"-"+e}function f(n){return n+"-"+e}function g(){c&&d();var n=o();n!=r.NavigationStart&&performance.mark(n);c=!0;l()}function nt(){performance.mark(r.ConversationStart);l()}function tt(n,t,e,s){var h=f(r.VisuallyReady);performance.mark(h,{startTime:s});u(i.TTVR,o(),h);u(i.TTVR_FirstTurnNoNav,r.ConversationStart,h);u(i.TTVR_RefreshDuration,f(r.LastTokenRender),h);st(n,t,e);w(n,t,e)}function it(n,t,e,s){var h=f(r.FirstTokenRender);performance.mark(h,{startTime:s-performance.timeOrigin});u(i.TTVR_FirstTokenRender,o(),h);w(n,t,e)}function rt(n){var t=f(r.FirstThinkingToken);performance.mark(t,{startTime:n-performance.timeOrigin});u(i.TTVR_FirstThinkingToken,o(),t)}function ut(n){if(s(f(r.FirstTokenRender))){var t=f(r.LastTokenRender);performance.mark(t,{startTime:n-performance.timeOrigin});u(i.TTVR_FirstToLast,f(r.FirstTokenRender),t);u(i.TTVR_LastTokenRender,o(),t)}}function ft(n){var t=f(r.StreamAjaxSend);s(t)||(performance.mark(t,{startTime:n-performance.timeOrigin}),u(i.TTVR_StreamAjaxSend,o(),t))}function et(t,f,o){var h,c=e-1,l,a,s,y;performance.mark(r.SuggestionChipsReady+"-"+c);l=r.VisuallyReady+"-"+c;a=r.SuggestionChipsReady+"-"+c;u(i.TTVR_SuggestionChips,l,a);s=v(i.TTVR_SuggestionChips);n.Helper.writeLog(n.Helper.ClientInst.Perf,i.TTVR_SuggestionChips,"OvrIG",t,"latency",s+"");n.Conversation.emitcopilotSearchSCLatency_TTVR(s);y=n.Helper.getResponseId();n.Helper.logCustomData("CI.SystemEvent",n.Helper.LogNames.PerformanceData,"CSearch",(h={ConversationId:f,TurnIndex:o+"",ResponseId:y}, __set$(h,i.TTVR_SuggestionChips,s+"") ,h),t)}function ot(){var t=[i.TTVR,i.TTVR_FirstTokenRender,i.TTVR_FirstTurnNoNav,i.TTVR_FirstThinkingToken,i.TTVR_FirstToLast,i.TTVR_LastTokenRender,i.TTVR_StreamAjaxSend,i.TTVR_RefreshDuration],n={};return t.forEach(function(t){ __set$(n,t,v(t)+"") }),n}function st(t,i,r){var u=ot();n.Helper.logCustomData("CI.SystemEvent",n.Helper.LogNames.PerformanceData,"CSearch",__assign({ConversationId:i,TurnIndex:r+"",ResponseId:r+"-"+i},u),t);e++;c=!1}function u(n,t,i){s(t)&&s(i)&&performance.measure(n,t,i)}function v(n){var t=performance.getEntriesByName(n)[0];return t&&"duration"in t?Math.round(t.duration):-1}function s(n){if(n==r.NavigationStart)return!0;var t=performance.getEntriesByName(n,"mark");return t.length>0}function w(t,i,r){var f=n.Helper.getResponseId(),u;p!=f&&(p=f,l(),n.Helper.logCustomData("CI.SystemEvent",n.Helper.LogNames.DwellTimeFiveSec,"CSearch",{ConversationId:i,TurnIndex:r+"",ResponseId:r+"-"+i,Duration:"0"},t),u=1,h=setInterval(function(){var f=u*y;n.Helper.logCustomData("CI.SystemEvent",n.Helper.LogNames.DwellTimeFiveSec,"CSearch",{ConversationId:i,TurnIndex:r+"",ResponseId:r+"-"+i,Duration:f+""},t);u==ht&&clearInterval(h);u++},y*1e3))}function l(){h&&clearInterval(h)}var e=1,c=!1,a=!1,r,i;(function(n){n.ConversationStart="conversationStart";n.FirstTokenRender="FirstTokenRender";n.FirstThinkingToken="TTVR.FirstThinkingToken";n.LastTokenRender="LastTokenRender";n.NavigationStart="navigationStart";n.StreamAjaxSend="StreamAjaxSend";n.SuggestionChipsReady="SuggChipsReady";n.TurnStart="TurnStart";n.VisuallyReady="VisuallyReady"})(r=t.PerformanceMarkers||(t.PerformanceMarkers={})),function(n){n.TTVR="TTVR";n.TTVR_FirstThinkingToken="TTVR.FirstThinkingToken";n.TTVR_FirstTokenRender="TTVR.FirstToken";n.TTVR_FirstToLast="TTVR.FirstToLast";n.TTVR_FirstTurnNoNav="TTVR.FirstTurnNoNav";n.TTVR_LastTokenRender="TTVR.LastToken";n.TTVR_StreamAjaxSend="TTVR.StreamAjaxSend";n.TTVR_SuggestionChips="TTVR.SuggestionChips";n.TTVR_RefreshDuration="TTVR.RefreshDuration"}(i||(i={}));t.markEvent=b;t.setIsInlineChat=k;t.markTurnVisuallyReady=tt;t.markFirstTokenRender=it;t.markFirstThinkingToken=rt;t.markLastTokenRender=ut;t.markStreamAjaxSend=ft;t.markTurnSuggestionsChipReady=et;var y=5,ht=12,h=0,p=""})(t=n.PerformanceHelper||(n.PerformanceHelper={}))}(CopilotSearch||(CopilotSearch={}));__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)), __set$(u,r,__get$(t,r)) );return n.concat(u||Array.prototype.slice.call(t))},function(n){var t;(function(n){function y(t){n.locStrings=t.locStrings;n.maxSuggestCount=t.maxSug;n.originalUrl= __get$(__get$(window,"location"),"href") }function p(){var n=_d.getElementsByClassName("b_dark"),t=_d.getElementsByClassName("b_drk");return n!=null&&n.length!=0||t!=null&&t.length!=0}function w(t,i){i===void 0&&(i=n.originalUrl);var f=new RegExp("[?&]{1}".concat(t,"=([^&]+)"),"i"),r=i.match(f),u=r?r[1]:null;return u?decodeURIComponent( __call$(u,"replace",[/\+/g," "]) ):""}function b(t,i){i===void 0&&(i=n.originalUrl);var u= __call$(decodeURIComponent(i),"replace",[/&amp;/gi,"&"]) ,f=new RegExp("[?&]{1}".concat(t,"=([^&]+)"),"i"),r=u.match(f);return r? __call$(r[1],"replace",[/\+/g," "]) :""}function u(n,t){for(var r=[],i=2;i<arguments.length;i++) __set$(r,i-2,__get$(arguments,i)) ;typeof Log!="undefined"&&Log.Log&&Log.Log.apply(Log,__spreadArray([n,"CopilotSearch",t,!0],r,!1))}function k(n){typeof Log!="undefined"&&Log.LogFilterFlare&&Log.LogFilterFlare([n])}function d(n,t,i,r,u){typeof Log!="undefined"&&Log.LogCustomData&&Log.LogCustomData(n,"CopilotSearch",t,i,r,u)}function g(n,t,i){for(var f=[],r=3;r<arguments.length;r++) __set$(f,r-3,__get$(arguments,r)) ;u.apply(void 0,__spreadArray([n,t,"OvrIG",i],f,!1))}function nt(n){var t,i;return n&&((i=(t=n.impressionID)!==null&&t!==void 0?t:n.shLoadingIg)!==null&&i!==void 0?i:n.ig)}function tt(n,t,i){var r= new URL(__get$(n,"href").toLowerCase()) ;r.searchParams.has(t.toLowerCase())||n.searchParams.set(t,i)}function f(){var n=_d.querySelector(".ca_turn:last-of-type");return n?n.getAttribute("turnid"):null}function e(){var n=_d.querySelector("#convId");return n?n.getAttribute("value"):null}function it(){var n=e(),t=f();return!n||!t?"":t+"-"+n}function rt(){function n(){var n=new Uint32Array(1);return window.crypto.getRandomValues(n),n[0]/4294967296}return __call$("xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx","replace",[/[xy]/g,function(t){var i=n()*16|0,r=t==="x"?i:i&3|8;return r.toString(16);}]) }function ft(n,t){var i,r=n.contentDocument||((i=n.contentWindow)===null||i===void 0?void 0:i.document);return r?r.querySelector(t):null}var r,o,s,h,c,l,a,v,t,i,ut;(function(n){ __set$(n,n.Error=0,"Error") ; __set$(n,n.FloatingZeroPage=1,"FloatingZeroPage") ; __set$(n,n.FloatCompose=2,"FloatCompose") ; __set$(n,n.Retry=3,"Retry") ; __set$(n,n.BlankInput=4,"BlankInput") })(o=n.CopilotSearchState||(n.CopilotSearchState={})),function(n){ __set$(n,n.Success=1,"Success") ; __set$(n,n.Failure=2,"Failure") ; __set$(n,n.InProgress=3,"InProgress") ; __set$(n,n.Default=16,"Default") }(s=n.ChipsGenerationStatus||(n.ChipsGenerationStatus={})),function(n){ __set$(n,n.IsRAIQueryBlocklist=1,"IsRAIQueryBlocklist") ; __set$(n,n.InitiatedGeneration=2,"InitiatedGeneration") ; __set$(n,n.IsComplete=3,"IsComplete") ; __set$(n,n.PapyrusRequestCreation=4,"PapyrusRequestCreation") ; __set$(n,n.PapyrusResponseProcess=5,"PapyrusResponseProcess") ; __set$(n,n.IsRAISuggestionsBlocklist=6,"IsRAISuggestionsBlocklist") ; __set$(n,n.IsQueryBlocklist=7,"IsQueryBlocklist") ; __set$(n,n.NoEntryInOS=8,"NoEntryInOS") ; __set$(n,n.NoProperStatus=9,"NoProperStatus") ; __set$(n,n.CorruptStatus=10,"CorruptStatus") ; __set$(n,n.Default=16,"Default") }(h=n.GenerationStatusReason||(n.GenerationStatusReason={})),function(n){n.Click="Click";n.CopilotSystem="CopilotSystem";n.CopilotInteraction="CopilotInteraction";n.Perf="Perf";n.SystemEvent="SystemEvent";n.AjaxAds="AjaxAds"}(c=n.ClientInst||(n.ClientInst={})),function(n){n.AttachmentUploadSuccess="AttachmentUploadSuccess";n.AttachmentUploadFailure="AttachmentUploadFailure";n.BackToSerp="BackToSerp";n.ConversationStarted="ConversationStarted";n.ConversationCreateFailure="ConversationCreateFailure";n.DislikeClicked="DislikeClicked";n.DwellTimeFiveSec="DwellTimeFiveSec";n.LikeClicked="LikeClicked";n.MenuToggle="MenuToggle";n.NewThreadButtonClicked="NewThreadButtonClicked";n.NewThreadFromError="NewThreadFromError";n.ModelSwitchingMenuToggle="ModelSwitchingMenuToggle";n.ModelSwitchingOptionClicked="ModelSwitchingOptionClicked";n.OpenAllResults="OpenAllResults";n.PerformanceData="PerformanceData";n.QueryIssued="QueryIssued";n.ResponseRendered="ResponseRendered";n.ResponseFailed="ResponseFailed";n.ResponseTimeout="ResponseTimeout";n.ResultsEmpty="ResultsEmpty";n.ContainerNoAnswer="ContainerNoAnswer";n.ThinkStateError="ThinkStateError";n.RetryButtonClicked="RetryButtonClicked";n.BackButtonClicked="BackButtonClicked";n.SuggestionChipsApiSent="SuggestionChipsApiSent";n.TotalSuggestionChipsApiReq="TotalSuggestionChipsApiReq";n.FeedbackClick="FeedbackClick";n.SuggestionChipsApiSuccess="SuggestionChipsApiSuccess";n.SuggestionChipsApiEmptyResponse="SuggestionChipsApiEmptyResponse";n.SuggestionChipsApiError="SuggestionChipsApiError";n.SuggestionChipsApiFailure="SuggestionChipsApiFailure";n.SuggestionChipsApiReachMaxRetry="SuggestionChipsApiReachMaxRetry";n.SuggestionChipRender="SuggestionChipRender";n.SuggestionChipEvent="SuggestionChipEvent";n.SuggestionChipClick="SuggestionChipClick";n.SuggestionChipsRetryNum="SuggestionChipsRetryNum";n.ScopeClick="ScopeClick";n.NoChipMsg="NoChipMsg";n.Error="Error";n.CopilotAnswerLoadTime="CopilotAnswerLoadTime";n.CitationPopup="CitationPopup";n.CitationClick="CitationClick";n.CitationDimiss="CitationDimiss";n.ComposerSubmitButtonClicked="ComposerSubmitButtonClicked";n.ClipboardPasteTransfer="ClipboardPasteTransfer";n.ZeroInputCardClicked="ZeroInputCardClicked";n.DiscoverCardClicked="DiscoverCardClicked";n.NewSearchClicked="NewSearchClicked";n.CacheOnlyRequestIssued="CacheOnlyRequestIssued";n.TriggerFailureFallback="IssuedFrameFailureFallback";n.ZeroInputPageLoaded="ZeroInputPageLoaded";n.ZipAjaxRequestSent="ZipAjaxRequestSent";n.ZipAjaxRequestSuccess="ZipAjaxRequestSuccess";n.ZipAjaxRequestFailure="ZipAjaxRequestFailure";n.ZipHtmlResponseAppended="ZipHtmlResponseAppended";n.ZipHtmlResponseAppendFail="ZipHtmlResponseAppendFail";n.MagazineFollowupIssued="MagFollowIssued";n.TraceIdDebug="TraceIdDebug";n.TraceIdData="TraceIdData";n.OverlayCitationClick="OverlayCitationClick";n.OverlayLinkClick="OverlayLinkClick";n.OverlayCheckSourceClick="OverlayCheckSourceClick";n.OverlayPopup="OverlayPopup";n.OverlayDimiss="OverlayDimiss";n.StopStreamingClick="StopStreamingButtonClick";n.PostMessageToTurn="PostMessageToTurn";n.CopyButtonRendered="CopyButtonRendered";n.CopyButtonClick="CopyButtonClick";n.AttachmentAdded="AttachmentAdded";n.AttachmentUpdated="AttachmentUpdated";n.AttachmentCleared="AttachmentCleared";n.ScrollToBottomIssueQuery="ScrollToBottomIssueQuery";n.AjaxAdsLoadTime="AjaxAdsLoadTime";n.AjaxAdsLoadedAfterIframe="AjaxAdsLoadedAfterIframe";n.AjaxAdsErrorStateDroppedAds="AjaxAdsErrorStateDroppedAds";n.AjaxAdsDuplicatedCopyCallCaughtByMap="AjaxAdsDuplicatedCopyCallCaughtByMap";n.AjaxAdsDuplicatedCopyCallCaughtByElement="AjaxAdsDuplicatedCopyCallCaughtByElement";n.FrameReplacementSuccess="FrameReplacementSuccess";n.FrameReplacementError="FrameReplacementError";n.FrameReplacementExecuted="FrameReplacementExecuted"}(l=n.LogNames||(n.LogNames={})),function(n){n.AutoSuggest="AutoSuggest";n.History="History";n.MagFollow="MagFollow";n.ScrollToBottom="ScrollToBottom";n.SuggestionChip="SuggestionChip";n.Text="Text";n.Voice="Voice";n.Url="Url";n.Zero="Zero";n.ThreadHistory="ThreadHistory";n.Scope="Scope"}(a=n.InputTypes||(n.InputTypes={})),function(n){n.Turn="Turn";n.Zero="Zero";n.Rest="Rest";n.Float="Float";n.FloatZero="FloatZero"}(v=n.CopilotMode||(n.CopilotMode={}));n.svgNS="http://www.w3.org/2000/svg";n.hiddenClassName="hidden";n.loadingClassName="loading";n.collapseClassName="coll";n.maxSuggestCount=-1;n.isDarkMode=p();n.GlobalInstTracker=_w.GlobalInstTracker;n.instTracker=typeof n.GlobalInstTracker!="undefined"?(r=n.GlobalInstTracker.createInstTracker("CopilotSearch"))!==null&&r!==void 0?r:n.GlobalInstTracker.getInstTracker("CopilotSearch"):null;n.originalUrl= __get$(__get$(window,"location"),"href") ;n.initConfig=y;n.getValueFromUrl=w;n.getValueFromUrlNormalized=b;n.writeLog=u;n.writeFilterFlareLog=k;n.logCustomData=d;n.writeOverrideLog=g;n.getImpressionId=nt;n.setParamIfNotExist=tt;n.getLastTurnId=f;n.getConversationId=e;n.getResponseId=it;n.generateIGUID=rt;t="__METRIC_NAME__";i="/shux/monitor?metric=".concat(t);n.suggestionchipSendMonitorEndpoint= __call$(i,"replace",[t,"copilotSearchSC"]) ;n.copilotSearchSCFetchRetryMonitorEndpoint= __call$(i,"replace",[t,"copilotSearchSCFetchRetry"]) ;n.copilotSearchSC_TTVR_MonitorEndpoint= __call$(i,"replace",[t,"copilotSearchSC_TTVR"]) ;n.copilotSearchSCFetchStatusMonitorEndpoint= __call$(i,"replace",[t,"copilotSearchSCFetchStatusFromApi"]) ,function(n){ __set$(n,n.TotalAjaxSend=0,"TotalAjaxSend") ; __set$(n,n.TotalAjaxValidResponse=1,"TotalAjaxValidResponse") ; __set$(n,n.TotalHitCache=2,"TotalHitCache") ; __set$(n,n.TotalPostReceived=3,"TotalPostReceived") ; __set$(n,n.TotalTimeout=4,"TotalTimeout") ; __set$(n,n.TotalSCRendered=5,"TotalSCRendered") ; __set$(n,n.TotalPostReceivedHasChips=6,"TotalPostReceivedHasChips") ; __set$(n,n.TotalPostReceivedOnlyKey=7,"TotalPostReceivedOnlyKey") ; __set$(n,n.TotalAjaxReachMaxRetry=8,"TotalAjaxReachMaxRetry") ; __set$(n,n.TotalAjaxSentImpression=9,"TotalAjaxSentImpression") }(ut=n.SuggestionchipMdmFetchType||(n.SuggestionchipMdmFetchType={}));n.suggestionChipsFetchApi="/wpt/fetchcopsearchsc";n.getIframeInternalElement=ft})(t=n.Helper||(n.Helper={}))}(CopilotSearch||(CopilotSearch={})),function(n){var t;(function(t){function e(t){var o=r(),s,e;i=u(o);s=_w.innerWidth;_d.body.style.height="".concat(_w.innerHeight,"px");e=_qs(".b_copilot_search");e&&(e.style.minHeight="".concat(_w.innerHeight,"px"));sj_be(_w,"resize",function(){var a=!1,h,c,l;if(_w.innerWidth!=s){if(s=_w.innerWidth,o=r(),i=u(o),t.enableCwMsg&&(h=_d.querySelectorAll(".frame_cont "+n.turnContainerElementName),h&&h.length&&!t.enableAjaxRequestFlow))for(c=0;c<h.length;++c)l= __get$(h,c) ,f(l,l.parentElement.id);a=!0}sj_evt.fire("ShellResize",a);_d.body.style.height="".concat(_w.innerHeight,"px");e&&(e.style.minHeight="".concat(_w.innerHeight,"px"))})}function r(){var n=0,t=_qs("header");return t&&(n=t.clientHeight),n}function u(n){var t=n,i=_qs(".b_cs_disclaimer");return i&&(t+=i.clientHeight),t}function f(n,t){var i=n.contentWindow.RenderSelectedAnswer;if(i&&i.onCsMsg)i.onCsMsg({type:"AnswerCardDimensionUpdate",data:{cw:_w.innerWidth,iframeId:t}})}function o(){return i}function s(){var r=n.Helper.svgNS,t=_d.createElementNS(r,"svg"),i;return t.setAttribute("width","24"),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),i=_d.createElementNS(r,"path"),i.setAttribute("d","M4.39705 4.55379L4.46967 4.46967C4.73594 4.2034 5.1526 4.1792 5.44621 4.39705L5.53033 4.46967L12 10.939L18.4697 4.46967C18.7626 4.17678 19.2374 4.17678 19.5303 4.46967C19.8232 4.76256 19.8232 5.23744 19.5303 5.53033L13.061 12L19.5303 18.4697C19.7966 18.7359 19.8208 19.1526 19.6029 19.4462L19.5303 19.5303C19.2641 19.7966 18.8474 19.8208 18.5538 19.6029L18.4697 19.5303L12 13.061L5.53033 19.5303C5.23744 19.8232 4.76256 19.8232 4.46967 19.5303C4.17678 19.2374 4.17678 18.7626 4.46967 18.4697L10.939 12L4.46967 5.53033C4.2034 5.26406 4.1792 4.8474 4.39705 4.55379L4.46967 4.46967L4.39705 4.55379Z"),i.setAttribute("fill-opacity","0.6"),t.appendChild(i),t}var i=0;t.init=e;t.resize=f;t.bh=o;t.closvg=s})(t=n.Base||(n.Base={}))}(CopilotSearch||(CopilotSearch={})),function(n){var t;(function(t){function s(t){var f,u,e;if(t.length>1){u=t[1];n.Bridge&&n.Bridge.query(u);var s= new URL(__get$(__get$Loc(location),"href")) ,c=encodeURI(u),l=new URL("".concat(s.origin,"/search?q=").concat(c,"&FORM=HDRSC1"));if(document.title=u,i){n.Helper.getLastTurnId()==null&&(e=!0,o&&t.length>2&&t[2]===n.Helper.InputTypes.Scope&&(e=!1),history.replaceState({inlineTurn:0},"", __get$(__get$Loc(location),"href") ),h(u,e));return}r||((f=_qs(".b_scopebar #b-scopeListItem-web a"))===null||f===void 0?void 0:f.setAttribute("href", __get$(l,"href") ))}}function h(n,t){var i= new URL(__get$(__get$Loc(location),"href")) ,o=i.searchParams.get("q")||i.searchParams.get("Q"),r,s,h,u,c;o&&n&&(r=void 0,e?(s=i.searchParams.get("Q")?"Q":"q",i.searchParams.set(s,n),t&&i.searchParams.set("pq",o),i.searchParams.set("mturn","1"),r=i):(h=encodeURI(n),u="".concat(i.origin,"/copilotsearch?q=").concat(h),t&&(c=encodeURI(o),u+="&pq=".concat(c)),u+="&FORM=ANWSB6",r=new URL(u)),history.pushState({inlineTurn:1},"",r),f=!0)}function c(t){var r,u,e;t.state&&t.state.zeropage?(n.changeMode(n.Helper.CopilotMode.Zero),n.ZeroPage.show()):t.state&&t.state.query?(e=n.getMode()===n.Helper.CopilotMode.Zero,n.PerformanceHelper.markEvent(n.PerformanceHelper.PerformanceMarkers.TurnStart),e&&(n.changeMode(n.Helper.CopilotMode.Turn),n.ZeroPage.hide()),n.Conversation.generateCopilotResponse(t.state.query,n.Helper.InputTypes.History)):i&&(f&&((r=t.state)===null||r===void 0?void 0:r.inlineTurn)==0||((u=t.state)===null||u===void 0?void 0:u.inlineTurn)==1)&&( __set$(__get$(_d,"location"),"href",__get$(__get$(_d,"location"),"href")) )}function l(n){r=n.enableScopeLinkUpdate;u=n.enableZeroPageHistory;i=n.enableSERPChat;e=n.enableMultiTurnParam;o=n.disablePartialQueryForScopeTurns;sj_evt.bind("cpltsrch_qry",s,!0);(u||i)&&sj_be(_w,"popstate",c)}var r=!1,u=!1,i=!1,f=!1,e=!1,o=!1;t.init=l})(t=n.History||(n.History={}))}(CopilotSearch||(CopilotSearch={}));__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})};__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(o){if(e)throw new TypeError("Generator is already executing.");while(f&&(f=0,o[0]&&(r=0)),r)try{if(e=1,u&&(i=o[0]&2?u["return"]:o[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,o[1])).done)return i;(u=0,i)&&(o=[o[0]&2,i.value]);switch(o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++;u=o[1];o=[0];continue;case 7:o=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&& __get$(i,i.length-1) )&&(o[0]===6||o[0]===2)){r=0;continue}if(o[0]===3&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(o[0]===6&&r.label<i[1]){r.label=i[1];i=o;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(o);break}i[2]&&r.ops.pop();r.trys.pop();continue}o=t.call(n,r)}catch(s){o=[6,s];u=0}finally{e=i=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},e,u,i,f;return f={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&( __set$(f,Symbol.iterator,function(){return this;}) ),f},function(n){var t;(function(t){function h(){var r="http://www.w3.org/2000/svg",n=_d.createElementNS(r,"svg"),t,i;return n.setAttribute("width","16"),n.setAttribute("height","16"),n.setAttribute("viewBox","0 0 16 16"),n.setAttribute("aria-hidden","true"),n.setAttribute("fill","currentColor"),t=_d.createElementNS(r,"path"),t.setAttribute("class","default_path"),t.setAttribute("d","M6 0C4.89543 0 4 0.895431 4 2V12C4 13.1046 4.89543 14 6 14H12C13.1046 14 14 13.1046 14 12V2C14 0.89543 13.1046 0 12 0H6ZM5 2C5 1.44772 5.44772 1 6 1H12C12.5523 1 13 1.44772 13 2V12C13 12.5523 12.5523 13 12 13H6C5.44772 13 5 12.5523 5 12V2ZM2 4.00001C2 3.25973 2.4022 2.61339 3 2.26758V12.5C3 13.8807 4.11929 15 5.5 15H11.7324C11.3866 15.5978 10.7403 16 10 16H5.5C3.567 16 2 14.433 2 12.5V4.00001Z"),n.appendChild(t),i=_d.createElementNS(r,"path"),i.setAttribute("class","copied_path"),i.setAttribute("d","M8 0C12.4183 0 16 3.58172 16 8C16 12.4183 12.4183 16 8 16C3.58172 16 0 12.4183 0 8C0 3.58172 3.58172 0 8 0ZM11.3584 5.64645C11.1849 5.47288 10.9154 5.4536 10.7206 5.58859L10.6513 5.64645L7 9.298L5.35355 7.65131L5.28431 7.59346C5.08944 7.45846 4.82001 7.47775 4.64645 7.65131C4.47288 7.82488 4.4536 8.09431 4.58859 8.28917L4.64645 8.35842L6.64645 10.3584L6.71569 10.4163C6.8862 10.5344 7.1138 10.5344 7.28431 10.4163L7.35355 10.3584L11.3584 6.35355L11.4163 6.28431C11.5513 6.08944 11.532 5.82001 11.3584 5.64645Z"),n.appendChild(i),n}function o(){var r="http://www.w3.org/2000/svg",n=_d.createElementNS(r,"svg"),t,i;return n.setAttribute("width","16"),n.setAttribute("height","18"),n.setAttribute("viewBox","0 0 16 18"),n.setAttribute("aria-hidden","true"),n.setAttribute("fill","currentColor"),t=_d.createElementNS(r,"path"),t.setAttribute("class","outline_path"),t.setAttribute("d","M8.05198 1.29429C8.39129 0.316993 9.68406 -0.133279 10.4829 0.703848C10.6455 0.874273 10.8081 1.05843 10.9176 1.22265C11.2379 1.70316 11.3725 2.33595 11.4218 2.95232C11.4721 3.58045 11.438 4.25457 11.3738 4.86484C11.3093 5.47746 11.2129 6.03959 11.1328 6.44777C11.1294 6.46547 11.1259 6.48288 11.1225 6.5H12.006C13.8777 6.5 15.2924 8.19514 14.9576 10.0367L14.2737 13.7984C13.8017 16.3943 11.2078 18.0291 8.66224 17.3348L3.06251 15.8076C2.14894 15.5585 1.45455 14.8145 1.26885 13.886L0.915812 12.1208C0.638089 10.7322 1.69991 9.56244 2.82905 9.11612C3.15163 8.98861 3.44337 8.82679 3.66974 8.62597C5.37583 7.11245 5.99442 5.90287 7.05406 3.77695C7.4084 3.06605 7.77205 2.10054 8.05198 1.29429ZM10.0165 6.87862L10.0169 6.87707L10.0187 6.86973L10.0262 6.83863C10.0328 6.81079 10.0426 6.76903 10.0549 6.71494C10.0793 6.60669 10.1135 6.4493 10.1515 6.25536C10.2277 5.86666 10.3188 5.33504 10.3793 4.76016C10.4401 4.18293 10.4685 3.5758 10.425 3.03206C10.3806 2.47655 10.2652 2.04684 10.0855 1.77735C10.0264 1.6887 9.91385 1.55604 9.75942 1.39421C9.56051 1.18576 9.13137 1.23428 8.99666 1.62228C8.71411 2.43609 8.33339 3.45194 7.94904 4.22305C6.88216 6.36349 6.19326 7.72408 4.33336 9.37403C3.99304 9.67594 3.58878 9.8911 3.19665 10.0461C2.31631 10.3941 1.75035 11.1945 1.89639 11.9247L2.24943 13.6899C2.36085 14.247 2.77748 14.6934 3.32562 14.8428L8.92536 16.3701C10.9052 16.91 12.9227 15.6385 13.2898 13.6195L13.9738 9.85777C14.197 8.63009 13.2538 7.5 12.006 7.5H10.5015C10.3476 7.5 10.2022 7.42906 10.1074 7.30771C10.0127 7.18638 9.97921 7.02796 10.0165 6.87862C10.0165 6.87858 10.0165 6.87866 10.0165 6.87862Z"),n.appendChild(t),i=_d.createElementNS(r,"path"),i.setAttribute("class","filled_path"),i.setAttribute("d","M8.05198 1.29429C8.39129 0.316993 9.68406 -0.133279 10.4829 0.703848C10.6455 0.874273 10.8081 1.05843 10.9176 1.22265C11.2379 1.70316 11.3725 2.33595 11.4218 2.95232C11.4721 3.58045 11.438 4.25457 11.3738 4.86484C11.3093 5.47746 11.2129 6.03959 11.1328 6.44777C11.1294 6.46547 11.1259 6.48288 11.1225 6.5H12.006C13.8777 6.5 15.2924 8.19514 14.9576 10.0367L14.2737 13.7984C13.8017 16.3943 11.2078 18.0291 8.66224 17.3348L3.06251 15.8076C2.14894 15.5585 1.45455 14.8145 1.26885 13.886L0.915812 12.1208C0.638089 10.7322 1.69991 9.56244 2.82905 9.11612C3.15163 8.98861 3.44337 8.82679 3.66974 8.62597C5.37583 7.11245 5.99442 5.90287 7.05406 3.77695C7.4084 3.06605 7.77205 2.10054 8.05198 1.29429Z"),n.appendChild(i),n}function c(n){return __awaiter(this,void 0,void 0,function(){var i,t,r,u;return __generator(this,function(f){switch(f.label){case 0:return(f.trys.push([0,5,,6]),i=n.html,t=n.text,r=typeof ClipboardItem!="undefined"&&!!navigator.clipboard.write,!r)?[3,2]:[4,navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([i],{type:"text/html"}),"text/plain":new Blob([t],{type:"text/plain"})}),])];case 1:return f.sent(),[3,4];case 2:return[4,navigator.clipboard.writeText(t)];case 3:f.sent();f.label=4;case 4:return[2,!0];case 5:return u=f.sent(),console.error("Clipboard write failed",u),[2,!1];case 6:return[2]}})})}function l(t){return new Promise(function(r,u){if(i){u(new Error("Another copy request is still pending"));return}i=r;var f={type:"CS_COPY_REQUEST",data:{turnId:t}},e=n.Helper.getResponseId();CopilotSearchMessager.postMessageToTurn(t,e,f);setTimeout(function(){i&&(i=null,u(new Error("Timeout waiting for copy data from iframe")))},5e3)})}function a(t){var o=this,i=sj_ce("button",undefined,"ca_action_btn ca_copy"),r,f,e;return i.setAttribute("aria-label",u),i.appendChild(h()),n.Helper.GlobalInstTracker&&n.Helper.instTracker&&t&&(r=[],f=n.Helper.instTracker.itemFactory.createInstrumentedItem({Name:"CopilotAnswerCopy"}),r.push(f),i.dataset.cspi=n.Helper.GlobalInstTracker.composeHValue(f),i.dataset.ig=t,i.dataset.clicks="true",n.Helper.instTracker.dataSourceSerializer.serializeItemsToJson(r),n.Helper.instTracker.writeLayoutFromElement(i),n.Helper.instTracker.flushInstrumentation(t)),e=n.Helper.getLastTurnId(),sj_be(i,"click",function(i){return __awaiter(o,void 0,void 0,function(){var r,u,f;return __generator(this,function(o){switch(o.label){case 0:return r=i.currentTarget,n.Helper.logCustomData("CI.InteractionEvent",n.Helper.LogNames.CopyButtonClick,"CSearch",{},t),[4,l(e)];case 1:return u=o.sent(),[4,c(u)];case 2:return f=o.sent(),f&&(Lib.CssClass.add(r,"copied"),setTimeout(function(){Lib.CssClass.remove(r,"copied")},3e3)),[2]}})})}),i}function s(t){var s=sj_ce("div",undefined,"ca_feedback_btns"),u=sj_ce("button",undefined,"ca_action_btn ca_like"),i,h,c,l;return u.setAttribute("tabindex","0"),u.setAttribute("aria-label",f),u.setAttribute("aria-pressed","false"),u.appendChild(o()),i=sj_ce("button",undefined,"ca_action_btn ca_dislike"),i.setAttribute("tabindex","0"),i.setAttribute("aria-label",e),i.setAttribute("aria-pressed","false"),i.appendChild(o()),s.appendChild(u),s.appendChild(i),n.Helper.GlobalInstTracker&&n.Helper.instTracker&&t&&(h=[],c=n.Helper.instTracker.itemFactory.createInstrumentedItem({Name:"CopilotAnswerLike"}),h.push(c),u.dataset.cspi=n.Helper.GlobalInstTracker.composeHValue(c),u.dataset.ig=t,u.dataset.clicks="true",l=n.Helper.instTracker.itemFactory.createInstrumentedItem({Name:"CopilotAnswerDislike"}),h.push(l),i.dataset.cspi=n.Helper.GlobalInstTracker.composeHValue(l),i.dataset.ig=t,i.dataset.clicks="true",n.Helper.instTracker.dataSourceSerializer.serializeItemsToJson(h),n.Helper.instTracker.writeLayoutFromElement(s),n.Helper.instTracker.flushInstrumentation(t)),sj_be(u,"click",function(){n.Helper.logCustomData("CI.InteractionEvent",n.Helper.LogNames.FeedbackClick,"CSearch",{Type:"positive"},t);s.classList.add("like_voted");s.classList.remove("dislike_voted");u.setAttribute("aria-pressed","true");i.setAttribute("aria-pressed","false")}),sj_be(i,"click",function(){if(n.Helper.logCustomData("CI.InteractionEvent",n.Helper.LogNames.FeedbackClick,"CSearch",{Type:"negative"},t),r)sj_evt.fire("csLaunchFeedback");typeof _w.Log!="undefined"&&typeof Log.LogFilterFlare!="undefined"&&Log.LogFilterFlare(["csdislikebtnclick"]);s.classList.add("dislike_voted");s.classList.remove("like_voted");u.setAttribute("aria-pressed","false");i.setAttribute("aria-pressed","true")}),s}function v(t,i){var r=sj_ce("div",undefined,"ca_action_menu"),u,f;return(i=="QnATuringGen"||i=="GenSERPOptDoc")&&(u=a(t),r.appendChild(u),n.Helper.logCustomData("CI.InteractionEvent",n.Helper.LogNames.CopyButtonRendered,"CSearch",{},t)),f=s(t),r.appendChild(f),r}function y(n){var t=sj_ce("div",undefined,"ca_feedback"),i=s(n);return t.appendChild(i),t}function p(t){r=t.enableThumbdownFeedback;u=t.locStrings.copyButtonText;f=t.locStrings.likeButtonText;e=t.locStrings.dislikeButtonText;sj_evt.bind("ShellStopStreaming",function(){var i=_qs(".ca_turn[turnid='"+n.Helper.getLastTurnId()+"']"),t=_qs(".ca_copy",i);t&&Lib.CssClass.add(t,"b_hide")});sj_evt.bind("ShellCopyData",function(n){n&&n.length>1&&i&&(i(n[1]),i=null)})}var r=!1,u,f,e,i=null;t.generateActionMenuElement=v;t.geterateFeedbackElement=y;t.init=p})(t=n.TopMenu||(n.TopMenu={}))}(CopilotSearch||(CopilotSearch={})),function(n){var t;(function(n){function t(n){sj_evt.bind("feedbackInitialized",function(){i(n)},1)}function i(n){var t;typeof Feedback!="undefined"&&typeof Feedback.Hooks!="undefined"&&((t=Feedback.Hooks.submit)===null||t===void 0?void 0:t.use("copilotSearch",function(t){if(t){var i=t.structured_data=t.structured_data||{};n.convId&&(i.cpltsrchConversationId=n.convId)}return t}))}function r(n){var i,t;typeof Feedback!="undefined"&&typeof Feedback.Hooks!="undefined"&&n.iframeid&&(t=n.iframeid,(i=Feedback.Hooks.submit)===null||i===void 0?void 0:i.use("SHDebug_"+t,function(i){if(i){i.structured_data=i.structured_data||{};var r=i.structured_data.shDebugData=i.structured_data.shDebugData||{}; __set$(r,t,__get$(r,t)||{}) ;n.shConversationId&&( __get$(r,t) .shConversationId=n.shConversationId);n.shQueryId&&( __get$(r,t) .shQuery=n.shQueryId);n.shLoadingIg&&( __get$(r,t) .shLoadingIG=n.shLoadingIg);n.shLoadingEventId&&( __get$(r,t) .shLoadingEventId=n.shLoadingEventId);n.shResultsIg&&( __get$(r,t) .shResultsIG=n.shResultsIg);n.shResultsEventId&&( __get$(r,t) .shResultsEventId=n.shResultsEventId);n.shTlwEventId&&( __get$(r,t) .shTLWEventId=n.shTlwEventId);n.csConversationId&&( __get$(r,t) .cpltsrchConverationId=n.csConversationId);n.answerSourceOptDoc&&( __get$(r,t) .answerSourceOptDoc=n.answerSourceOptDoc);n.answerSources&&( __get$(r,t) .answerSources=n.answerSources);n.ansType&&( __get$(r,t) .ansType=n.ansType)}return i}))}n.init=t;n.enrichTurnSHFeedbackData=r})(t=n.FeedbackData||(n.FeedbackData={}))}(CopilotSearch||(CopilotSearch={})),function(n){var t;(function(n){function t(n,t){t&&(t===null||t===void 0?void 0:t.iframeId)?(n.shTlwEventId&&(t.shTlwEventId=n.shTlwEventId),n.iframeid!=t.iframeId&&(n.shLoadingEventId&&(t.shLoadingEventId2=n.shLoadingEventId),n.shLoadingIg&&(t.shLoadingIg2=n.shLoadingIg),t.iframeId=n.iframeid)):(n.shLoadingEventId&&(t.shLoadingEventId1=n.shLoadingEventId),n.shLoadingIg&&(t.shLoadingIg1=n.shLoadingIg),t.iframeId=n.iframeid)}n.populateCsTurnDataObject=t})(t=n.TurnDataHelper||(n.TurnDataHelper={}))}(CopilotSearch||(CopilotSearch={})),function(n){var t;(function(t){function l(n){var t;u=n.mobCompH;r=n.enableNewTurnScrollToTop;c=n.enableNewLayout;f=n.locStrings.querySentByYouText;e=n.enableCopilotCnBranding;o=(t=n.enableMobileFirstTurnScroll)!==null&&t!==void 0?t:!1;i=_w.innerHeight;r&&sj_evt.bind("ShellResize",a)}function a(){var n,t;if(i=_w.innerHeight,n=_d.querySelectorAll(".ca_turn"),n&&n.length>1){if(t= __get$(n,n.length-1) ,t.style.minHeight=="initial")return;t.style.minHeight=i-u+"px"}}function v(n,t){if(r){var f=n.children.length-1;(f>=0||o)&&(f>=0&&( __get$(n.children,f) .style.minHeight="initial"),t.style.minHeight=i-u+"px")}}function y(t,i,r){var u=_d.querySelector("#".concat(r)),f;if(u&&u.parentElement)if(f=u&&u.parentElement&&u.parentElement.querySelector(".".concat(n.Helper.magFollowupClass)),f)t=f;else return u.parentElement.appendChild(i),!1;return!0}function p(t,i){function r(u){var f,e,o;if(u[1]==i.id){if(t.parentElement){if(f=t.parentElement.querySelectorAll("[replacing]"),f.length>1)for(e=0;e<f.length;e++) __get$(f,e) .parentElement&& __get$(f,e) .parentElement.removeChild( __get$(f,e) );else t.parentElement.removeChild(t);n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.FrameReplacementSuccess,"count",f.length.toString())}else n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.FrameReplacementError,"reason","parentElementNull","containerId",i.id);Lib.CssClass.remove(i,"b_hidden");n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.FrameReplacementExecuted,"containerId",i.id);console.debug("Frame replacement complete");o=i!==null&&i!==void 0?i:_qs(".ca_turn[turnid='".concat(n.Helper.getLastTurnId(),"']"));o&&sb_st(function(){o.focus({preventScroll:!0})},0);sj_evt.unbind("frameReadyToReplace",r)}}Lib.CssClass.add(i,"b_hidden");t.parentElement.appendChild(i);t.parentElement.setAttribute("aria-live","polite");sj_evt.bind("frameReadyToReplace",r,!0)}function w(n,t,i,r,u,f,e){f===void 0&&(f=null);e===void 0&&(e="");s(n,t,i,function(){},r,u,f,e,!0)}function s(t,i,r,u,f,e,o,s,c){(o===void 0&&(o=null),s===void 0&&(s=""),c===void 0&&(c=!1),!s||y(o,r,s))&&(o?c?(n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.FrameReplacementExecuted,"containerId",r.id,"isComp","true"),o.parentElement?(o.parentElement.replaceChild(r,o),n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.FrameReplacementSuccess,"containerId",r.id,"isComp","true")):n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.FrameReplacementError,"reason","parentElementNull","containerId",r.id,"isComp","true")):p(o,r):h(f,e,t,i,r,u))}function h(t,i,r,u,f,o){var y,s,h,k,p,c,w,l,a,b;return f===void 0&&(f=null),o===void 0&&(o=null),s=sj_ce("li",undefined,"ca_turn"),s.setAttribute("turnid",t.toString()),h=s,s.setAttribute("responseId","".concat(t,"-").concat(i)),r.childElementCount>0&&(k=sj_ce("div",undefined,"ca_div"),h.appendChild(k)),e&&(p=_qs(".b_copilot_model_switching .model_switching_menu"),c="",p&&p.querySelectorAll(".model_switching_option").forEach(function(n){var t;n.getAttribute("aria-selected")==="true"&&(c=(t=n.querySelector("span:nth-child(2)"))===null||t===void 0?void 0:t.textContent)}),w=_qs("#b_copilot_search .b_cs_disclaimer"),w&&(l=w.cloneNode(!0),l.classList.remove("hidden"),c&&(a=l.querySelector("span:nth-child(1)"),a&&(a.innerHTML= __call$(a.textContent,"replace",[" AI",' <span class="model-name">'.concat(c,"<\/span> AI")]) )),s.appendChild(l))),b=(y=n.AttachmentConversationView)===null||y===void 0?void 0:y.genAttachmentQueryEle(),b&&h.appendChild(b),u&&h.appendChild(u),f&&h.appendChild(f),v(r,s),r.appendChild(s),o&&o(s),h}function b(n){return _qs(".ca_userquery",n)}function k(n){var i=sj_ce("div",undefined,"ca_userquery"),t=sj_ce("div",undefined,"ca_userquery_text");return t.setAttribute("aria-label",f+" "+n),t.innerText=n,i.appendChild(t),i}function d(n){var t=_qs(".ca_userquery_text",n),i;t&&t.innerText&&(i=rt(t.innerText),t.insertAdjacentElement("afterend",i))}function g(t,i){var u=t!==null&&t!==void 0?t:_qs(".ca_turn[turnid='"+n.Helper.getLastTurnId()+"']"),e=_qs(".ca_feedback",u);if(!e){var r=Lib.CssClass.contains(u,"frame_cont")?u:_qs(".frame_cont",u),f=i||(r===null||r===void 0?void 0:r.getAttribute("ig")),o=n.TopMenu.geterateFeedbackElement(f!==null&&f!==void 0?f:"");r&&r.appendChild(o)}}function nt(t,i,r){var f=t!==null&&t!==void 0?t:_qs(".ca_turn[turnid='"+n.Helper.getLastTurnId()+"']"),o=_qs(".ca_action_menu",t);if(!o){var u=Lib.CssClass.contains(f,"frame_cont")?f:_qs(".frame_cont",f),e=i||(u===null||u===void 0?void 0:u.getAttribute("ig")),s=n.TopMenu.generateActionMenuElement(e!==null&&e!==void 0?e:"",r);u&&u.appendChild(s)}}function tt(t,i){var r=t.querySelector("a.ca_back_serp"),u,f;r&&Lib.CssClass.remove(r,n.Helper.hiddenClassName);n.Helper.GlobalInstTracker&&n.Helper.instTracker&&r&& __get$(r,"href") &&(u=[],f=n.Helper.instTracker.itemFactory.createLink( __get$(r,"href") ),u.push(f),r.dataset.cspi=n.Helper.GlobalInstTracker.composeHValue(f),n.Helper.instTracker.dataSourceSerializer.serializeItemsToJson(u),n.Helper.instTracker.writeLayoutFromElement(t),n.Helper.instTracker.flushInstrumentation(i))}function it(){n.Helper.writeLog(n.Helper.ClientInst.Click,n.Helper.LogNames.BackToSerp)}function rt(t){var i=sj_ce("a",undefined,"ca_back_serp");return i.innerText=n.Helper.locStrings.showAllResults, __set$(i,"href","https://www.bing.com/search?q="+encodeURIComponent(t)) ,i.target="_blank",sj_be(i,"click",it),Lib.CssClass.add(i,n.Helper.hiddenClassName),i}var r=!1,c=!1,f,e=!1,o=!1,i=0,u=0;t.init=l;t.compWrap=w;t.wrap=s;t.genTurnContainer=h;t.queryEle=b;t.genQueryEle=k;t.showAll=d;t.addFeedbackToTurn=g;t.addActionMenu=nt;t.inst=tt})(t=n.TWrap||(n.TWrap={}))}(CopilotSearch||(CopilotSearch={}));__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})};__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(o){if(e)throw new TypeError("Generator is already executing.");while(f&&(f=0,o[0]&&(r=0)),r)try{if(e=1,u&&(i=o[0]&2?u["return"]:o[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,o[1])).done)return i;(u=0,i)&&(o=[o[0]&2,i.value]);switch(o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++;u=o[1];o=[0];continue;case 7:o=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&& __get$(i,i.length-1) )&&(o[0]===6||o[0]===2)){r=0;continue}if(o[0]===3&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(o[0]===6&&r.label<i[1]){r.label=i[1];i=o;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(o);break}i[2]&&r.ops.pop();r.trys.pop();continue}o=t.call(n,r)}catch(s){o=[6,s];u=0}finally{e=i=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},e,u,i,f;return f={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&( __set$(f,Symbol.iterator,function(){return this;}) ),f},function(n){var t;(function(t){function ue(){return su}function fe(i){var f,e,o,s,h,c,l,y,b,k,d,r,g;(gt=i.iframeLoadTimeoutMs,di=i.removeFailureIframe,v=_qs(".ca_container"),v)&&(Lib.CssClass.remove(v,n.Helper.hiddenClassName),vu(!1),u=i.mobileUI,p=i.tabletAndDesktopUI,t.conversationId=i.convId,w=i.convSig,nr=i.suggestionChipsTimeoutMs,ct=i.enableCopilotSearchC8UXFeature,ni=i.answerPosition,tr=i.enableXapDebug,ir=i.disableAutoHorizontalScrollAnswer,ne=i.enableComposerForContinuation,ti=i.locStrings,tt=i.enableAjaxRequestFlow,rr=i.enableAppendClientipToFrame,ur=i.enableForceAppendClientipToFrame,fr=i.enableDirectlyRenderChips,or=i.enableForceNoCache,sr=i.enableForceRandomShmgid,hr=i.enableRequeryClickAsNewTurn,cr=i.enableCwMsg,ii=i.enableSandboxAttribute,it=i.disableSuggestionChipsErrorTips,lr=i.enableScrollBehaviorOptimization,ar=i.enableFallbackToMagazine,er=i.enableSCGenStatus,ri=i.enableNewTurnScrollToTop,vr=i.enableMgzOnlyFollowup,ui=i.enableMgzOnlyFollowupSH,yr=i.enableCachedGenserpForZeroInput,pr=i.enableZeroPageHistory,wr=i.applyScrollToFunc,fi=i.enableFeedbackFix,ei=i.enableTurnIndexFix,br=i.enableModelSwitching,rt=i.enableErrorMessageShow,at=i.enableStopStreamButton,kr=i.enableAppendPartialQuery,dr=i.disablePartialQueryForScopeTurns,gr=i.enableDebugMode,te=i.enableMockedThreadData,oi=i.enableCopyButtonShow,ut=i.enableFeedbackShowAfterStreaming,nu=i.disableFirstTurnScroll,uu=i.requestUrl,tu=i.enableASOnTurn1,iu=i.enableFallbackSearchTimeout,ru=i.enableNewConvoThreadSaving,fu=i.enableThreadsRefreshReload,yt=i.enableQuoteToFollow,ie=i.enableSideAlignedComposer,pt=(f=i.fromSerpComposer)!==null&&f!==void 0?f:!1,a=(e=i.enableSERPChat)!==null&&e!==void 0?e:!1,eu=(o=i.disableAjaxSerpOnMultiTurn)!==null&&o!==void 0?o:!1,ou=(s=i.enableTurnEvent)!==null&&s!==void 0?s:!1,ci=(h=i.ajaxAdsRequestEnabled)!==null&&h!==void 0?h:!1,hu=(c=i.adCallOnMultiTurnEnabled)!==null&&c!==void 0?c:!1,li=(l=i.turnScrollOffset)!==null&&l!==void 0?l:-1,cu=(y=i.enableScrollToLastSerpAnswer)!==null&&y!==void 0?y:!1,wt=(b=i.enableScrollToLastSerpAnswerLog)!==null&&b!==void 0?b:!1,lu=(k=i.openScrollToLastSerpAnswerFeature)!==null&&k!==void 0?k:!1,au=(d=i.enableDarkModeParam)!==null&&d!==void 0?d:!1,hi=!0,r=n.ThreadsShared&&n.ThreadsShared.getConvUrl(),i.enableThreadsRefreshReload&&n.Threads&&r!=null?(vt=!0,n.Threads.fetchThread({ConversationId:r.convId,ConversationSignature:r.convSig,Title:"",LastUpdateTimestamp:0})):pt||(g=n.Helper.getValueFromUrl("q",uu||undefined),g.trim()?kt(g,n.Helper.InputTypes.Url):n.changeMode(n.Helper.CopilotMode.Zero)),typeof CopilotSearchMessager!="undefined"&&CopilotSearchMessager.bindMessageEvent?CopilotSearchMessager.bindMessageEvent(pi):(sj_be(_w,"message",ae),tt&&sj_evt.bind("CSMessage",ve)),tu&&(sj_evt.bind("AS.Canvas.Show",n.AutoSuggest.hideSuggestionChips),sj_evt.bind("autosuggestHide",n.AutoSuggest.showSuggestionChips)),i.ajaxAdsRequestEnabled===!0&&sj_evt.bind("AdsCopy",ee),pt||(n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.ConversationStarted,"convId",t.conversationId),n.PerformanceHelper.markEvent(n.PerformanceHelper.PerformanceMarkers.ConversationStart)))}function ee(t){var r,e;if(!(t.length<3)){var u=_qs("#".concat(t[1]," iframe")),i=_qs("#ca_ads_magazine_".concat(t[2])),f="".concat(t[1],":").concat(t[2]),s=o.get(f);if(i&&i.getAttribute("data-loaded")!==null){if(u&&u.contentWindow&&i&&(r=u.contentWindow.document.getElementById("b_wpt_adst"),r)){if(s==="adcallready"||s==="adcallcompleted"){console.debug("AdCopyStatusMap indicates Ad is already copied");n.Helper.writeLog(n.Helper.ClientInst.AjaxAds,n.Helper.LogNames.AjaxAdsDuplicatedCopyCallCaughtByMap,"turnid",t[2],"iframeid",t[1]);return}if(r.hasChildNodes()){console.debug("AdMagazineStub indicates Ad is already copied");n.Helper.writeLog(n.Helper.ClientInst.AjaxAds,n.Helper.LogNames.AjaxAdsDuplicatedCopyCallCaughtByElement,"turnid",t[2],"iframeid",t[1]);return}e=i.cloneNode(!0);r.append(e);e.classList.remove("b_hide");o.set(f,"adcallready")}}else o.set(f,"adcallnotready")}}function h(n){n=="start"?(s!=0&&(sb_ct(s),s=0),s=sb_st(function(){sj_evt.fire(ai,"fail");s=0},gt+100)):s!=0&&(sb_ct(s),s=0);sj_evt.fire(ai,n)}function oe(){return __awaiter(this,void 0,void 0,function(){var t,i,n,r;return __generator(this,function(u){switch(u.label){case 0:t="https://".concat(k,"/copilotsearch");u.label=1;case 1:return u.trys.push([1,3,,4]),i={method:"GET",headers:{"X-MS-NewConv":"1"}},[4,fetch(t,i)];case 2:return(n=u.sent(),n.ok)?[2,n.text()]:[3,4];case 3:return r=u.sent(),[3,4];case 4:return[2,undefined]}})})}function se(n){try{var i=new DOMParser,t=i.parseFromString(n,"text/html"),r=t.querySelector("data#convId"),u=t.querySelector("data#convSig"),f=t.querySelector("data#impressionGuid");return[r,u,f]}catch(e){return[null,null,null]}}function he(){var t;f=1;i=0;v.innerHTML="";n.ErrorState.hideErrorState();e=!1;l={};(p||u)&&(vi(),ft(),u||((t=n.SuggestionChips)===null||t===void 0?void 0:t.resetChips()));ci&&(o=new Map)}function vu(i){return __awaiter(this,void 0,void 0,function(){var u,f,r,e,o,s,h,c;return __generator(this,function(l){switch(l.label){case 0:return(lt="",y="",!i)?[3,2]:(n.ThreadsShared&&n.ThreadsShared.resetConvUrl(),vt=!1,u=!1,[4,oe()]);case 1:f=l.sent();f&&(r=se(f),e=r[0],o=r[1],s=r[2],e&&o&&s&&(_G.IG=s.value,t.conversationId=e.value,w=o.value,n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.ConversationStarted,"convId",t.conversationId),h=document.querySelector("data#convId"),c=document.querySelector("data#convSig"),h&&h.setAttribute("value",t.conversationId),c&&c.setAttribute("value",w),u=!0));u||n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.ConversationCreateFailure);l.label=2;case 2:return he(),[2]}})})}function bt(n,t){var i=sj_gx();i.open("POST",n,!0);i.setRequestHeader("accept","application/json");i.setRequestHeader("Content-Type","application/json");i.send(JSON.stringify(t))}function ft(){g&&(sb_ct(g),g=0)}function vi(){d&&(sb_ct(d),d=0)}function ce(t){if(t&&t.query&&t.query!=""){b=n.Helper.InputTypes.ThreadHistory;var i=n.TWrap,r=i.genQueryEle(t.query);sj_evt.fire("cpltsrch_qry",t.query);et(t.query,n.Helper.InputTypes.ThreadHistory,null,i,r,null,null,"",null,null,t)}}function kt(o,s,h,c,l){var k,v,tt,y,d,g,nt;h===void 0&&(h=null);c===void 0&&(c="");l===void 0&&(l=!1);k=hi;a&&(n.Composer.resetComposer(),n.Composer.focus(),ou&&sj_evt.fire("csComposerTurn",o),k&&(hi=!1,lo(),eu&&(u&&_ge("progContPlaceHolder")&&(_w.sj_disableProgRender=!0),sj_evt.fire("ajax.clearCache"))));p&&s!==n.Helper.InputTypes.SuggestionChip&&s!==n.Helper.InputTypes.Zero&&n.Composer.resetComposerLayoutDirection();fu&&!vt&&(n.ThreadsShared&&n.ThreadsShared.setConvUrl(t.conversationId,w),vt=!0);ft();vi();ht=Date.now();st=o;b=s;gi=h;n.ErrorState.hideErrorState();e=!1;n.SuggestionChips.setSuggestionChipId("");n.SuggestionChips.setSuggestionChips(null);r={};n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.QueryIssued,"inputType",s,"query",o,"displayedText",h);s!=n.Helper.InputTypes.Url&&s!=n.Helper.InputTypes.History&&f==1&&pr&&history&&history.pushState&&(v= new URL(__get$(__get$Loc(location),"href")) ,tt=v.searchParams.get("Q")?"Q":"q",v.searchParams.set(tt,o),history.pushState({query:o},"",v));o&&o!=""&&(y=null,af(i+1)&&!l&&(y=n.Helper.generateIGUID(),le(o,i+1,y,s)),ke(),d=n.TWrap,g=d.genQueryEle(o),sj_evt.fire("cpltsrch_qry",o,s),li>0&&(nt=li,k&&(nt+=16),g.style.scrollMargin=nt+"px"),et(o,s,h,d,g,"",null,"",null,c,null,y),sj_evt.fire("ShellGenerateResponse",s))}function le(t,i,r,f){function v(t,r){t&&r&&r.appendTo(s);s.setAttribute("data-loaded","true");var u=(Date.now()-l).toString()+"ms";n.Helper.writeLog(n.Helper.ClientInst.AjaxAds,n.Helper.LogNames.AjaxAdsLoadTime,"t",u);o.forEach(function(t,r){var f=r.split(":"),e=f[0],u=f[1],o=parseInt(u,10);t==="adcallnotready"&&o===i&&(n.Helper.writeLog(n.Helper.ClientInst.AjaxAds,n.Helper.LogNames.AjaxAdsLoadedAfterIframe,"turnid",u),console.debug("requestCallBack firing AdsCopy for iframeid: "+e+" turnid: "+u),sj_evt.fire("AdsCopy",e,o))})}var l=Date.now(),e="/AdsFetch?q=".concat(encodeURIComponent(t),"&scenario=FullAdsMagazine&form=DEEPSH&FORM2=").concat(bf(f),"&cpltsrchif=1&turnindex=").concat(i,"&IG=").concat(r,"&IID=").concat("CopilotSearchAds","&SFX=").concat(++re),c,s,h;kf("mockadsuse")?e+=df(!0):kf("mockadssave")&&(e+=df(!1));a&&(e+="&csic=1");u&&(e+="&cw="+window.innerWidth.toString(),e+="&ch="+window.innerHeight.toString());p&&(c=window.innerWidth>1268?1220:window.innerWidth-48,e+="&cw="+c.toString(),e+="&ch="+window.innerHeight.toString());s=sj_ce("div","ca_ads_magazine_".concat(i));s.classList.add("b_hide");h=_qs("#b_ads_magazine_container");h===null||h===void 0?void 0:h.appendChild(s);sj_ajax(e,{callback:v})}function et(n,r,u,f,e,o,s,c,l,a,y,p){var b,w;if(o===void 0&&(o=""),s===void 0&&(s=null),c===void 0&&(c=""),l===void 0&&(l=!1),a===void 0&&(a=""),y===void 0&&(y=null),p===void 0&&(p=null),tt){b=s||c?null:f.genTurnContainer(i,t.conversationId,v,e);ro(n,!1,r,u,o,!!c,l,a).then(function(n){n.isSuccess?(s||c?f.compWrap(v,e,n.ajaxContainer,i,t.conversationId,s,c):b&&b.appendChild(n.ajaxContainer),sj_appHTML(n.ajaxContainer,n.ajaxContent),e&&dt(e)):(h("fail"),console.debug("Failed to create iso comp"))});return}w=null;y?(i=y.turnIndex,w=to(n,r,u,y)):w=io(n,!1,r,u,o,!!c,l,a,p);w.isSuccess?f.wrap(v,e,w.iframeCont,function(){dt(e)},i,t.conversationId,s,c):(h("fail"),console.debug("Failed to create iframe"))}function yi(r,u,f){return __awaiter(this,void 0,void 0,function(){var o;return __generator(this,function(s){switch(s.label){case 0:return e=!0,t.emitScFetchMdmEvent(n.Helper.SuggestionchipMdmFetchType.TotalAjaxSend),[4,n.SuggestionChips.updateSuggestionChips(r,f,function(){return u==nt})];case 1:return o=s.sent(),o||it||(ct&&r?n.ErrorState.errorHandler(n.ErrorState.ErrorType.SUGGESTION_KEY_RESULT_LOAD_FAILED,f):n.ErrorState.errorHandler(n.ErrorState.ErrorType.ERROR_OCCURRED,f)),o&&t.emitScFetchMdmEvent(n.Helper.SuggestionchipMdmFetchType.TotalAjaxValidResponse),c(o),o&&n.PerformanceHelper.markTurnSuggestionsChipReady(f,t.conversationId,i),typeof n.Scraper!="undefined"&&n.Scraper.updateStatus(i,n.Scraper.ContentType.Suggestion,o?n.Scraper.StatusType.Ready:n.Scraper.StatusType.Failed,o?"":"Suggestion chip api failed"),[2]}})})}function yu(t,r,u){return __awaiter(this,void 0,void 0,function(){var o,s,f,h,l;return __generator(this,function(){return e=!0,o=t.genStatus,s=t.chips,f=t.lookupKey,s&&s.length>0&&o.generationStatus==n.Helper.ChipsGenerationStatus.Success?(pu(f.lookupKey,s,u),Log===null||Log===void 0?void 0:Log.Log("SuggestionChipRendered","SCRender","ChipId: "+f,!1,"OvrIG",u),n.Helper.logCustomData(n.Helper.ClientInst.SystemEvent,n.Helper.LogNames.SuggestionChipEvent,"CSearch",{Event:"SCRender",ChipId:f+""},u)):o.generationStatus==n.Helper.ChipsGenerationStatus.Failure?(n.changeMode(n.Helper.CopilotMode.Float),it||(ct&&f?n.ErrorState.errorHandler(n.ErrorState.ErrorType.SUGGESTION_KEY_RESULT_LOAD_FAILED,u):n.ErrorState.errorHandler(n.ErrorState.ErrorType.ERROR_OCCURRED,u)),c(!1),typeof n.Scraper!="undefined"&&n.Scraper.updateStatus(i,n.Scraper.ContentType.Suggestion,n.Scraper.StatusType.Failed,"Suggestion chip generation failed"),h=o===null||o===void 0?void 0:o.generationStatusReason,l= __get$(n.Helper.GenerationStatusReason,h) !=undefined? __get$(n.Helper.GenerationStatusReason,h) :"Default",n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.SuggestionChipsApiFailure,"OvrIG",u,"GenStatusReason",l),n.Helper.logCustomData(n.Helper.ClientInst.SystemEvent,n.Helper.LogNames.SuggestionChipEvent,"CSearch",{GenStatusReason:l+"",Type:n.Helper.LogNames.SuggestionChipsApiFailure},u)):(f===null||f===void 0?void 0:f.lookupKey)&&yi(f.lookupKey,r,u),[2]})})}function pu(r,u,f){e=!0;n.SuggestionChips.renderSuggestionChips(r,u,f);c(!0);n.PerformanceHelper.markTurnSuggestionsChipReady(f,t.conversationId,i);t.emitScFetchMdmEvent(n.Helper.SuggestionchipMdmFetchType.TotalHitCache);Log===null||Log===void 0?void 0:Log.Log("SuggestionChipRendered","SCRender","HitCache",!1,"OvrIG",f);n.Helper.logCustomData(n.Helper.ClientInst.SystemEvent,n.Helper.LogNames.SuggestionChipEvent,"CSearch",{Status:"CacheHit"},f);typeof n.Scraper!="undefined"&&n.Scraper.updateStatus(i,n.Scraper.ContentType.Suggestion,n.Scraper.StatusType.Ready)}function ae(n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return pi(n.data),[2]})})}function ve(n){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){return pi(n[1]),[2]})})}function pi(f){var s,v,k;return __awaiter(this,void 0,void 0,function(){var d,ot,vt,pt,kt,ni,wt,ai,pi,ki,li,sr,ci,di,gi,yr,pr,tr,ui,wr,nu,br,bt,kr,tu,ti,ei,ii,gt,ir,hi,dr,rr,ur,gr,or;return __generator(this,function(){if(d=f===null||f===void 0?void 0:f.data,ot=f===null||f===void 0?void 0:f.type,we.indexOf(ot)>=0){if(hr&&ot==du)return d&&d.query&&so(d.query,n.Helper.InputTypes.Text),[2];if(at&&ot=="StreamProgress")return d&&d.eventName&&(d.eventName===ye?n.Composer.showStopStreamingButton():d.eventName===pe&&n.Composer.hideStopStreamingButton()),[2];if(d&&d.iframeid&&(vt=_ge(d.iframeid),pt=vt&&_qs(n.turnContainerElementName,vt),su=(pt===null||pt===void 0?void 0:pt.getAttribute("IG"))||"",vt&&pt)){if(kt=d.iframeid==y,ni=n.TWrap,wt=ni.queryEle(vt.parentElement),ot==ku)return ai=n.Citation,ai&&ai.show(d.citations,d.allSources),[2];if(ot==tf)return pi=n.Overlay,pi&&pi.show(d),[2];if(vr&&ot=="MagFollowup"&&d.query)return ki=vt.parentElement&&vt.parentElement.querySelector(".".concat(n.Helper.magFollowupClass)),ki&&(lt=ki.id),et(d.query,n.Helper.InputTypes.MagFollow,"",n.TWrap,null,"",null,d.iframeid),n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.MagazineFollowupIssued),typeof _w.Log!="undefined"&&typeof Log.LogFilterFlare!="undefined"&&Log.LogFilterFlare(["magfollowup"]),[2];if(ot==rf&&d.url)return console.debug("Received readyToFetch signal"),n.Helper.writeOverrideLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.CacheOnlyRequestIssued,n.Helper.getImpressionId(d)),vf(d,vt),[2];if(ot==nf){if(a&&h("reset"),li=n.ErrorState.handleIframeErrors(d),ar&&d&&d.url)return console.debug("Received fallback signal"),vf(d,vt,!0),at&&n.Composer.hideStopStreamingButton(),n.Helper.writeOverrideLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.ThinkStateError,n.Helper.getImpressionId(d)),typeof n.Scraper!="undefined"&&n.Scraper.updateStatus(i,n.Scraper.ContentType.Turn,n.Scraper.StatusType.Waiting,"".concat(n.Helper.LogNames.ThinkStateError,": ").concat((s=d.ErrorMsg)!==null&&s!==void 0?s:"unknown"),!0),rt&&[n.ErrorState.ErrorType.LIMIT_REACHED,n.ErrorState.ErrorType.UNAUTHORIZED].includes(li)&&sb_st(function(){var n=wi("#"+d.iframeid,li);n()},500),[2];d&&d.ErrorMsg&&(sr=wi("#"+d.iframeid,li),sr());at&&n.Composer.hideStopStreamingButton()}if(d.type==ef)return n.Helper.writeOverrideLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.ContainerNoAnswer,n.Helper.getImpressionId(d)),c(!1),n.ErrorState.errorHandler(n.ErrorState.ErrorType.SEARCH_NO_RESULTS,n.Helper.getImpressionId(d)),bi(vt),[2];if(ci=function(){var n,t,i;vt.parentElement&&(t=((n= __get$(si,d.iframeid) )===null||n===void 0?void 0:n.impressionID)||d.impressionID,kt&&fi?(i=_qs(".ca_feedback",wt),i&&wt.removeChild(i),ni.addFeedbackToTurn(vt.parentElement,t)):kt||ni.addFeedbackToTurn(vt.parentElement,t))},ot==sf){if(ut&&(oi?(di=((v= __get$(si,d.iframeid) )===null||v===void 0?void 0:v.impressionID)||d.impressionID,kt&&fi?(gi=_qs(".ca_action_menu",wt),gi&&wt.removeChild(gi),ni.addActionMenu(vt.parentElement,di,d.ansType)):kt||ni.addActionMenu(vt.parentElement,di,d.ansType)):ci()),d.ansType&&d.iframeid&&( __set$(l,d.iframeid,__get$(l,d.iframeid)||{iframeid:d.iframeid}) , __get$(l,d.iframeid) .ansType=d.ansType,typeof n.FeedbackData!="undefined"&&typeof n.FeedbackData.enrichTurnSHFeedbackData=="function"&&n.FeedbackData.enrichTurnSHFeedbackData( __get$(l,d.iframeid) )),ru&&i===1&&!kt){if(!wt||!wt.innerText||wt.innerText.trim()==="")return[2];b!==n.Helper.InputTypes.ThreadHistory&&(yr=wt.innerText,pr={query:yr,conversationId:t.conversationId,conversationSignature:w,turnIndex:i},sj_evt.fire("ShellReceiveAnswerType",d.ansType,"SaveThread",pr))}else sj_evt.fire("ShellReceiveAnswerType",d.ansType);return[2]}if(ot==hf&&oi)return sj_evt.fire("ShellCopyData",d.copyContent),[2];if(yt&&ot==cf&&(tr=d===null||d===void 0?void 0:d.selectedText,tr&&(n.AttachmentManager.addAttachment({quote:tr,type:n.AttachmentManager.AttachmentType.Quote}),n.Composer.focus())),ot==lf&&(d.type==="AdReadyToCopy"?(console.debug("handleMessage firing AdsCopy for iframeid: "+d.iframeid+" turnIndex: "+i),sj_evt.fire("AdsCopy",d.iframeid,i)):d.type==="AdRenderComplete"&&(o.set("".concat(d.iframeid,":").concat(i),"adcallcompleted"),kt&&(sj_evt.fire("frameReadyToReplace",d.iframeid),ut||ci(),y=""))),ui=nt==d.iframeid,ui&&ot==ff&&(wr=d.timestamp-performance.timeOrigin,n.PerformanceHelper.markTurnVisuallyReady(d.impressionID,t.conversationId,i,wr),typeof n.Scraper!="undefined"&&(nu=vt.getAttribute("fallback")!=null,n.Scraper.updateStatus(i,n.Scraper.ContentType.Turn,n.Scraper.StatusType.Ready)),n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.TraceIdDebug,"OvrIG",r===null||r===void 0?void 0:r.shLoadingIg1,"shLoadingIg1",r===null||r===void 0?void 0:r.shLoadingIg1,"shLoadingEventId1",r===null||r===void 0?void 0:r.shLoadingEventId1,"shLoadingIg2",r===null||r===void 0?void 0:r.shLoadingIg2,"shLoadingEventId2",r===null||r===void 0?void 0:r.shLoadingEventId2,"shTlwEventId",r===null||r===void 0?void 0:r.shTlwEventId),n.Helper.logCustomData(n.Helper.ClientInst.SystemEvent,n.Helper.LogNames.TraceIdData,"CSearch",{CSearchImpressionId:r===null||r===void 0?void 0:r.shLoadingIg1,CSearchEventId:r===null||r===void 0?void 0:r.shLoadingEventId1,CSearch2ImpressionId:r===null||r===void 0?void 0:r.shLoadingIg2,CSearch2EventId:r===null||r===void 0?void 0:r.shLoadingEventId2,ShTlwEventId:r===null||r===void 0?void 0:r.shTlwEventId,ResponseId:i+"-"+t.conversationId},r===null||r===void 0?void 0:r.shLoadingIg1),h("reset")),ot=="CopilotSearchPerformanceData"&&d.eventName&&d.timestamp&&d.turnIndex===i)switch(d.eventName){case"shFirstGenSerpToken":n.PerformanceHelper.markFirstTokenRender(d.impressionId,t.conversationId,i,d.timestamp);break;case"shFirstToken":n.PerformanceHelper.markFirstThinkingToken(d.timestamp);break;case"TimeToResultsReady":n.PerformanceHelper.markLastTokenRender(d.timestamp);break;case"StreamAjaxSend":n.PerformanceHelper.markStreamAjaxSend(d.timestamp)}if(ui&&(ht&&(br=Date.now()-ht,n.Helper.writeOverrideLog(n.Helper.ClientInst.Perf,n.Helper.LogNames.CopilotAnswerLoadTime,n.Helper.getImpressionId(d),"latency",br+""),ht=0),vi(),e||(ft(),g=sb_st(function(){e||(e=!0,g=0,n.Helper.writeOverrideLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.NoChipMsg,n.Helper.getImpressionId(d)),c(!1),it||n.ErrorState.errorHandler(n.ErrorState.ErrorType.CS_ANSWER_SUGGESTION_KEY_TIMEOUT),t.emitScFetchMdmEvent(n.Helper.SuggestionchipMdmFetchType.TotalTimeout))},nr))),ot==gu&&(d.iframeid&&( __set$(l,d.iframeid,__get$(l,d.iframeid)||{iframeid:d.iframeid}) ,bt= __get$(l,d.iframeid) ,d.shConversationId&&(bt.shConversationId=d.shConversationId),d.shQueryId&&(bt.shQueryId=d.shQueryId),d.shLoadingIg&&(bt.shLoadingIg=d.shLoadingIg),d.shLoadingEventId&&(bt.shLoadingEventId=d.shLoadingEventId),d.shResultsIg&&(bt.shResultsIg=d.shResultsIg),d.shResultsEventId&&(bt.shResultsEventId=d.shResultsEventId),d.shTlwEventId&&(bt.shTlwEventId=d.shTlwEventId),d.csConversationId&&(bt.csConversationId=d.csConversationId),d.answerSourceOptDoc&&(bt.answerSourceOptDoc=d.answerSourceOptDoc),d.answerSources&&(bt.answerSources=d.answerSources)),typeof Feedback!="undefined"&&typeof Feedback.Hooks!="undefined"?n.FeedbackData.enrichTurnSHFeedbackData(d):sj_evt.bind("feedbackInitialized",function(){n.FeedbackData.enrichTurnSHFeedbackData(d)},1),n.TurnDataHelper.populateCsTurnDataObject(d,r)),ot==uf&&typeof n.Ladybug!="undefined"&&typeof n.Ladybug.processLadybugData=="function"&&n.Ladybug.processLadybugData(d,st),ot=="StreamScrapingData"&&typeof n.Scraper!="undefined"&&n.Scraper.updateStatus(i,n.Scraper.ContentType.StreamedMetadata,n.Scraper.StatusType.Ready,JSON.stringify((k=d.metadata)!==null&&k!==void 0?k:"")),ot=="CopilotAdsStubTriggeredAds"&&"adsTriggered"in d&&typeof n.Scraper!="undefined"&&n.Scraper.updateStatus(i,n.Scraper.ContentType.Ads,d.adsTriggered===!0?n.Scraper.StatusType.Ready:n.Scraper.StatusType.Absent),ot=="FullyFormedQuery"&&(kr=d.query,tu=d.iframeid,t.fullFormedQuery=kr),ot==bu)h("chips"),ui&&ft(),!e&&ui&&(ti=d.key,ei=d.suggestionChipResponse,ii=ei===null||ei===void 0?void 0:ei.chips,gt=pt.getAttribute("IG"),Log===null||Log===void 0?void 0:Log.Log("SuggestionChipRendered","PostMReceived","ChipId: "+ti,!1,"OvrIG",gt),n.Helper.logCustomData(n.Helper.ClientInst.SystemEvent,n.Helper.LogNames.SuggestionChipEvent,"CSearch",{Event:"PostMReceived",ChipId:ti+""},gt),er&&ei?yu(ei,d.iframeid,gt):fr&&ii&&Array.isArray(ii)&&ii.length>0?(pu(ti,ii,gt),Log===null||Log===void 0?void 0:Log.Log("SuggestionChipRendered","SCRender","ChipId: "+ti,!1,"OvrIG",gt),n.Helper.logCustomData(n.Helper.ClientInst.SystemEvent,n.Helper.LogNames.SuggestionChipEvent,"CSearch",{Event:"SCRender",ChipId:ti+""},gt)):ti?yi(ti,d.iframeid,gt):(n.changeMode(n.Helper.CopilotMode.Float),it||n.ErrorState.errorHandler(n.ErrorState.ErrorType.ERROR_OCCURRED,gt),e=!0,c(!1),typeof n.Scraper!="undefined"&&n.Scraper.updateStatus(i,n.Scraper.ContentType.Suggestion,n.Scraper.StatusType.Failed,"Suggestion chips failed")),t.emitScFetchMdmEvent(n.Helper.SuggestionchipMdmFetchType.TotalPostReceived),ii&&Array.isArray(ii)&&ii.length>0?t.emitScFetchMdmEvent(n.Helper.SuggestionchipMdmFetchType.TotalPostReceivedHasChips):t.emitScFetchMdmEvent(n.Helper.SuggestionchipMdmFetchType.TotalPostReceivedOnlyKey));else if((d===null||d===void 0?void 0:d.type)&&(d.type=="TOPV2W"||d.type=="MOBILE"||d.type=="NOANS"||d.type=="TOP"||d.type=="NORESULTS")){if(d.type=="NORESULTS"&&h("reset"),d.type=="NOANS")return ui&&ft(),n.Helper.writeOverrideLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.ResultsEmpty,n.Helper.getImpressionId(d)),c(!1),n.ErrorState.errorHandler(n.ErrorState.ErrorType.SEARCH_NO_RESULTS,n.Helper.getImpressionId(d)),bi(vt),[2];d.height&&d.width&&(ir=parseInt(d.height),hi=parseInt(d.width),ir&&hi&&(pt.style.height=ir+"px",u||p?pt.style.width=hi+"px":(dr=(ct?Math.max(hi,1200):hi)+20,pt.style.width=dr+"px"),!u||d.noScroll||ri||dt(wt),u&&!tt&&cr&&Math.abs(hi-_w.innerWidth)>=5&&(rr=n.Base,rr&&rr.resize(pt,d.iframeid))),lr||u||d.noScroll||dt(wt),ot==wu&&(sb_st(function(){Lib.CssClass.remove(vt,n.Helper.loadingClassName)},0),n.Helper.writeOverrideLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.ResponseRendered,n.Helper.getImpressionId(d)),ut||ci(),tt||(ur=pt.contentWindow.document.querySelector("ol li"),ur&&(ur.style.borderRadius="0px")),d.impressionID&&(pt.setAttribute("IG",d.impressionID), __set$(si,d.iframeid,{impressionID:d.impressionID}) ,kt?be(d.iframeid)&&(n.Ladybug&&typeof n.Ladybug.addFallbackImpressionData=="function"&&n.Ladybug.addFallbackImpressionData(d.impressionID,d.eventID,d.query,d.url),or={iframeid:d.iframeid,shLoadingIg:d.impressionID,shLoadingEventId:d.eventID},n.FeedbackData&&typeof n.FeedbackData.enrichTurnSHFeedbackData=="function"&&n.FeedbackData.enrichTurnSHFeedbackData(or),n.TurnDataHelper&&typeof n.TurnDataHelper.populateCsTurnDataObject=="function"&&n.TurnDataHelper.populateCsTurnDataObject(or,r)):(gr=pt.parentElement.previousElementSibling,ni.inst(gr,d.impressionID))),d.forceShowAllButton&&ni.showAll(vt.parentElement),!kt||af(i)&&o.get("".concat(d.iframeid,":").concat(i))!=="adcallcompleted"||(sj_evt.fire("frameReadyToReplace",d.iframeid),ut||ci(),y="")))}}}return[2]})})}function af(n){return ci&&(hu||n===1)}function be(n){var t;return((t=_ge(n))===null||t===void 0?void 0:t.getAttribute("fallback"))==="1"}function vf(t,i,r){var u,f;r===void 0&&(r=!1);u=new URL(t.url);u.origin!= __get$(window,"location") .origin&&(f= __get$(u,"href") .slice( __get$(u,"href") .indexOf(u.origin)+u.origin.length),u= new URL(__get$(window,"location").origin+f) );lt!=t.iframeid&&(lt=t.iframeid,i.setAttribute("replacing","1"),et(u.searchParams.get("q"),null,"",n.TWrap,null, __get$(u,"href") ,i,"",r))}function ke(){var t;(t=_qs(".suggestion_wrapper"))===null||t===void 0?void 0:t.classList.add(n.Helper.hiddenClassName)}function c(t){var i;t&&((i=_qs(".suggestion_wrapper"))===null||i===void 0?void 0:i.classList.remove(n.Helper.hiddenClassName))}function dt(t){i===1&&nu||(sj_evt.fire("ShellTurnScroll"),sb_st(function(){var c=!u&&n.Threads&&ot,f=t,e,o,s,h,r;cu&&a&&i===1&&(e=de(),e&&(lu&&(f=e),wt&&typeof Log!="undefined"&&Log.LogFilterFlare&&Log.LogFilterFlare(["ScrollToSerpLast"])));ir?(o=f.getBoundingClientRect(),c?(s=ot.getBoundingClientRect(),ot.scrollTo({top:ot.scrollTop+o.top-s.top,left:0,behavior:"smooth"})):window.scrollTo({top:window.scrollY+o.top,left:0,behavior:"smooth"})):wr?(h="scrollBehavior"in _d.documentElement.style,r=_d.body,h?r.scrollTo({top:r.scrollHeight-_w.innerHeight,left:0,behavior:"smooth"}):r.scrollTo({top:r.scrollHeight-_w.innerHeight,left:0})):f.scrollIntoView({behavior:"smooth",block:"start",inline:"start"})},100))}function de(){var t=_d.querySelector("#b_results .b_rs"),r;if(t)return wt&&typeof Log!="undefined"&&Log.LogFilterFlare&&Log.LogFilterFlare(["scrlllasts_boprs"]),t;var i=[{selector:"#b_results .b_adBottom .b_adLastChild:last-of-type",type:"ad"},{selector:"#b_results > li:nth-last-child(1 of li.b_algo)",type:"algo"},{selector:"#b_results > li:nth-last-child(1 of li.b_ans)",type:"answer"}].map(function(n){var u=n.selector,f=n.type,t=_d.querySelector(u),i,r;return t?(i=t.getBoundingClientRect(),r=i.top+window.scrollY,{element:t,position:r,type:f}):null}).filter(function(n){return n!==null}),n=i.reduce(function(n,t){return t.position>n.position?t:n},i[0]);return n?(wt&&typeof Log!="undefined"&&Log.LogFilterFlare&&(r={ad:"scrolllastsans_ad",algo:"scrolllastsans_algo",answer:"scrlllasts_answer"},Log.LogFilterFlare([ __get$(r,n.type) ])),n.element):null}function wi(t,r){return function(){var u;n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.ResponseFailed,"turnIndex",i.toString());c(!1);!rt||((u=_ge(t))===null||u===void 0?void 0:u.getAttribute("fallback"))||n.ErrorState.errorHandler(r);pf(t);console.debug("Iframe error: "+r)}}function bi(t){var f,e,r,s,o,u;if(h("fail"),t)if(ri&&(e=t.closest(".ca_turn"),e&&(e.style.minHeight="initial")),rt||t.getAttribute("fallback"))for(s=t.parentElement,yf(t),o=s.querySelectorAll("[replacing]"),u=0;u<o.length;u++)yf( __get$(o,u) );else r=(f=t.closest(".ca_turn"))===null||f===void 0?void 0:f.querySelector(".ca_userquery_text"),r&&r.innerText&&(n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.TriggerFailureFallback,"turnIndex",i.toString()),et(r.innerText,null,"",n.TWrap,null,null,t,null,!0),typeof n.Scraper!="undefined"&&n.Scraper.updateStatus(i,n.Scraper.ContentType.Turn,n.Scraper.StatusType.Waiting,"Shell failure go to fallback",!0))}function yf(t){di?t.parentElement.removeChild(t):Lib.CssClass.add(t,n.Helper.hiddenClassName)}function pf(n){var t=_qs(n);bi(t)}function ge(t){return function(){var r;n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.ResponseTimeout,"turnIndex",i.toString());c(!1);rt&&(((r=_ge(t))===null||r===void 0?void 0:r.getAttribute("fallback"))?iu?n.ErrorState.errorHandler(n.ErrorState.ErrorType.SEARCH_TIMEOUT_FALLBACK):n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.Error,"ErrorType",n.ErrorState.ErrorType.SEARCH_TIMEOUT_FALLBACK):n.ErrorState.errorHandler(n.ErrorState.ErrorType.SEARCH_TIMEOUT));d=0;pf(t)}}function wf(t){var i=_d.createElement("iframe"),r=n.ErrorState.ErrorType.SEARCH_FAILED;return b!==n.Helper.InputTypes.ThreadHistory&&(i.onerror=wi(t,r),d=sb_st(ge(t),gt)),i}function ki(i,r,f,e,o,s,h,c,l,v,b){var nt,tt,it,g,rt,ut,ft,et,vt,ot,wt,st,bt,ht,kt;o===void 0&&(o="");s===void 0&&(s="");h===void 0&&(h=!1);c===void 0&&(c=!1);l===void 0&&(l="");v===void 0&&(v=null);b===void 0&&(b=null);var ct=n.Helper.getValueFromUrl("iffeatures"),lt=bf(f),d,dt=(nt=v===null||v===void 0?void 0:v.conversationId)!==null&&nt!==void 0?nt:t.conversationId,gt=(tt=v===null||v===void 0?void 0:v.conversationSignature)!==null&&tt!==void 0?tt:w,ti=(it=v===null||v===void 0?void 0:v.turnIndex)!==null&&it!==void 0?it:r,at=v!=null;return s?(d=new URL(s),d.searchParams.set("iframeid",e.id),y=e.id):(g="https://".concat(k,"/search?q=").concat(encodeURIComponent(i),"&cpltsrchif=").concat(h?"2":"1","&convid=").concat(encodeURIComponent(dt),"&convsig=").concat(encodeURIComponent(gt),"&showselans=1&showonly=").concat(ni,"&iframeid=").concat(e.id,"&turnindex=").concat(ti,"&dissrchswrit=1&input=").concat(f,"&suggText=").concat(o),br&&(g+="&csm="+n.ComposerModelSwitching.getCurrentModel()),b&&(g+="&IG=".concat(b)),kr&&r===1&&(!dr||f!==n.Helper.InputTypes.Scope)&&(rt=n.Helper.getValueFromUrl(pt?"q":"pq"),rt&&(g+="&pq=".concat(rt))),gr&&(ut=n.Helper.getValueFromUrl("testhooks"),ut&&(g+="&testhooks=".concat(ut)),ft=n.Helper.getValueFromUrl("uncrunched"),ft&&(g+="&uncrunched=".concat(ft)),et=n.Helper.getValueFromUrl("dbgtrace"),et&&(g+="&dbgtrace=".concat(et))),d=new URL(encodeURI(g)),ur?d.searchParams.set("clientip","183.204.169.10"):rr&& new URL(__get$(__get$(_w,"location"),"href")) .searchParams.forEach(function(n,t){["clientip"].includes(t)&&d.searchParams.set(t,n)}),h&&(y=e.id,ui&&n.Helper.setParamIfNotExist(d,"filters",'arbmgzonly:"1"')),c||h&&!ui||(yr&&f===n.Helper.InputTypes.Zero?(n.Helper.setParamIfNotExist(d,"cszicache","1"),l&&(d.search+="&filters="+l)):at&&f===n.Helper.InputTypes.ThreadHistory?n.Helper.setParamIfNotExist(d,"csrepturn","1"):n.Helper.setParamIfNotExist(d,"shm","cr"),n.Helper.setParamIfNotExist(d,"FORM","DEEPSH")),no(d)),u&&(n.Helper.setParamIfNotExist(d,"cw",window.innerWidth.toString()),n.Helper.setParamIfNotExist(d,"ch",window.innerHeight.toString())),p&&(vt=window.innerWidth>1268?1220:window.innerWidth-48,n.Helper.setParamIfNotExist(d,"cw",vt.toString()),n.Helper.setParamIfNotExist(d,"ch",window.innerHeight.toString())),ct&&n.Helper.setParamIfNotExist(d,"features",ct),lt&&n.Helper.setParamIfNotExist(d,"FORM2",lt),ot=n.Helper.getValueFromUrl("safesearch"),ot&&n.Helper.setParamIfNotExist(d,"safesearch",ot),!at&&or&&crypto&&crypto.randomUUID&&(sr?d.searchParams.set("shmgid",crypto.randomUUID()):n.Helper.setParamIfNotExist(d,"shmgid",crypto.randomUUID())),yt&&d.searchParams.has("quote")&&(wt=d.searchParams.get("quote")||"",d.searchParams.set("q",encodeURIComponent(i+" ")+wt)),c&&(n.Helper.setParamIfNotExist(d,"traffictype","searchharderretrybfpr"),n.Helper.setParamIfNotExist(d,"sherr","1"),e.setAttribute("fallback","1"),y=e.id),st=n.Helper.getValueFromUrl("client"),st&&n.Helper.setParamIfNotExist(d,"client",st),bt=n.Helper.originalUrl?new URL(n.Helper.originalUrl): new URL(__get$(__get$(_w,"location"),"href")) ,bt.searchParams.forEach(function(t,i){var f,r;i.indexOf("csif")==0&&(f=encodeURIComponent(i.substring(4)),r=encodeURIComponent(t),n.Helper.setParamIfNotExist(d,f,r));u&&i=="darkschemeovr"&&(r=encodeURIComponent(t),n.Helper.setParamIfNotExist(d,i,r))}),tr&&n.Helper.setParamIfNotExist(d,"p1","[AppHost%20WriteAllPluginLogs=%22true%22%20Verbose=%22true%22]"),ht=n.Debug,ht&&ht.refine(d),a&&n.Helper.setParamIfNotExist(d,"csic","1"),au&&(kt=n.Helper.isDarkMode?"1":"0",n.Helper.setParamIfNotExist(d,"forcethemeonce",kt)),d}function no(t){var r,i;if(n.AttachmentManager&&(r=n.AttachmentManager.getAttachmentList(),r&&r.length!==0))if(i=r[0],i.type==n.AttachmentManager.AttachmentType.Image){if(i.bcid){n.Helper.setParamIfNotExist(t,"bcid",i.bcid);return}i.url&&n.Helper.setParamIfNotExist(t,"imgUrl",i.url)}else yt&&i.type==n.AttachmentManager.AttachmentType.Quote&&n.Helper.setParamIfNotExist(t,"quote",encodeURIComponent(i.quote))}function to(t,i,r,e){var s,c,l;r===void 0&&(r="");var a=!1,o=sj_ce("div",undefined,"frame_cont"),h="cplt_frame_"+e.turnIndex;return f=Math.max(f,e.turnIndex+1),nt=h,o.id=h,s=wf("#"+h),s.setAttribute("aria-label",t+" "+ti.iframeResultContainerAriaLabel),ii&&s.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-forms allow-top-navigation"),Lib.CssClass.remove(o,n.Helper.loadingClassName),o.appendChild(s),k&&t&&(u&&(ni="top"),c=ki(t,e.turnIndex,i,o,r,"",!1,!1,"",e),l=n.Debug,l&&l.mockThreadLoad(c),s.src=decodeURI( __get$(c,"href") ),a=!0),{iframeCont:o,isSuccess:a}}function io(t,r,u,e,o,s,c,l,a){var v,b,p,y,w,d;return e===void 0&&(e=""),o===void 0&&(o=""),s===void 0&&(s=!1),c===void 0&&(c=!1),l===void 0&&(l=""),a===void 0&&(a=null),h("start"),v=sj_ce("div",undefined,"frame_cont"),i=co(),o||c||s||i++,b=ei?i:f,p="cplt_frame_"+f++,nt=p,v.id=p,s&&Lib.CssClass.add(v,n.Helper.magFollowupClass),y=wf("#"+p),y.setAttribute("aria-label",t+" "+ti.iframeResultContainerAriaLabel),ii&&y.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-forms allow-top-navigation"),Lib.CssClass.add(v,n.Helper.loadingClassName),v.appendChild(y),w=!1,k&&t&&(d=ki(t,b,u,v,e,o,s,c,l,null,a),y.src=decodeURI( __get$(d,"href") ),w=!0),{iframeCont:v,isSuccess:w}}function ro(t,r,u,e,o,s,c,l){return e===void 0&&(e=null),o===void 0&&(o=""),s===void 0&&(s=!1),c===void 0&&(c=!1),l===void 0&&(l=""),__awaiter(this,void 0,void 0,function(){var r,w,y,a,p,b,v,d;return __generator(this,function(g){switch(g.label){case 0:if(h("start"),r=sj_ce("div",undefined,"frame_cont"),o||c||s||i++,w=ei?i:f,y="cplt_frame_"+f++,nt=y,r.id=y,s&&Lib.CssClass.add(r,n.Helper.magFollowupClass),a="",p=!1,!(k&&t))return[3,6];b=ki(t,w,u,r,e,o,s,c,l);v=void 0;g.label=1;case 1:return g.trys.push([1,3,,4]),[4,fetch(decodeURI( __get$(b,"href") ))];case 2:return(v=g.sent(),!v.ok)?[2,{ajaxContainer:r,ajaxContent:a,isSuccess:!1}]:[3,4];case 3:return d=g.sent(),[2,{ajaxContainer:r,ajaxContent:a,isSuccess:!1}];case 4:return[4,v.text()];case 5:a=g.sent();p=!0;g.label=6;case 6:return[2,{ajaxContainer:r,ajaxContent:a,isSuccess:p}]}})})}function bf(t){t=t||b;switch(t){case n.Helper.InputTypes.Url:return n.Helper.getValueFromUrl("form", __get$(__get$(window,"location"),"href") .toLowerCase());case n.Helper.InputTypes.SuggestionChip:return a?"ICSUGG":"CSSUGG";default:return a?"ICSBOX":"CSSBOX"}}function kf(t){var i=n.Helper.getValueFromUrlNormalized(t, __get$(__get$(window,"location"),"href") .toLowerCase());return i=="1"}function df(t){var i=n.Helper.getValueFromUrlNormalized("mockadstitle", __get$(__get$(window,"location"),"href") ),r=n.Helper.getValueFromUrlNormalized("longsave", __get$(__get$(window,"location"),"href") .toLowerCase());return i?t?'&features=pdsmockadsre&p1=[UseMockAds%20Enabled="1"%20Title=%22'.concat(i,"%22]"):'&features=&p1=[MockAdsSave%20Enabled="1"%20Title=%22'.concat(i,"%22").concat(r?'%20TTL="1999999998"%20LockTitleValues="1"':"","]"):""}function uo(){if(st){n.Composer.onUpdate(n.Helper.CopilotSearchState.Retry);fo();kt(st,b,gi,"",!0);n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,n.Helper.LogNames.RetryButtonClicked)}}function fo(){var t=_qs(".ca_container");(t===null||t===void 0?void 0:t.lastElementChild)&&(f=f-1,eo(),t.removeChild(t.lastElementChild),n.changeMode(n.Helper.CopilotMode.Turn))}function eo(){o.forEach(function(t,r){var u=r.split(":"),s=u[0],f=u[1],e=parseInt(f,10);e===i&&(n.Helper.writeLog(n.Helper.ClientInst.AjaxAds,n.Helper.LogNames.AjaxAdsErrorStateDroppedAds,"turnid",f),o.set(r,"adcallcompleted"))})}function oo(n,t){var i;return function(){for(var f=this,u=[],r=0;r<arguments.length;r++) __set$(u,r,__get$(arguments,r)) ;i&&sb_ct(i);i=sb_st(function(){return n.apply(f,u)},t)}}function so(n,t){gf(n,t)}function ho(){var n=_d.querySelector(".ca_turn:last-of-type");n&&(n.style.minHeight="unset")}function co(){var t=_d.querySelector(".ca_turn:last-of-type"),n;return t?(n=parseInt(t.getAttribute("turnid")||"0",10),isNaN(n)?0:n):0}function lo(){var f=_qs(".b_pag"),i,n,t,r;f&&(f.style.display="none");i=_ge("b_footer");i&&(i.style.display="none");n=_qs(".b_wrapper");n&&(n.classList.remove("hide"),n.classList.add("show"));t=_ge("b_bop_pin_placehold");t&&(u||(t.style.display="none"),Lib.CssClass.add(t,"b_bop_nofooter"));r=_qs(".b_bop_cs_sb");r&&Lib.CssClass.add(r,"dynamic");sj_evt.fire("csInlineSearchTrig")}var k= __get$(window,"location") .hostname,ot=_qs(".b_contentScroller"),v,u=!1,p=!1,di=!0,w="",f=1,i=0,st="",b,gi="",d=0,g=0,nr=0,e=!1,nt="",gt=0,ht=0,ct=!1,ni="topv2w",tr=!1,ir=!1,tt=!1,rr=!1,ur=!1,fr=!1,er=!1,ti,ne=!1,or=!1,sr=!1,hr=!1,cr=!1,ii=!1,it=!1,lr=!1,ar=!1,ri=!1,lt="",y="",vr=!1,ui=!1,yr=!1,pr=!1,wr=!1,fi=!1,ei=!1,r={},br=!1,rt=!1,at=!1,kr=!1,dr=!1,gr=!1,te=!1,oi=!1,ut=!1,nu=!1,tu=!1,iu=!1,ru=!1,si={},uu="",vt=!1,fu=!1,yt=!1,l={},ie=!1,pt=!1,a=!1,eu=!1,ou=!1,su="",hi=!0,ci=!1,hu=!1,o=new Map,re=0,li=-1,cu=!1,wt=!1,lu=!1,au=!1,s,ai,gf;t.conversationId="";t.getFrameIG=ue;t.initConversation=fe;s=0;ai="csTurnState";t.resetConversation=vu;t.fullFormedQuery=null;t.emitScFetchMdmEvent=function(t){return bt(n.Helper.suggestionchipSendMonitorEndpoint,{fetchType:t})};t.emitcopilotSearchSCFetchRetry=function(t){return bt(n.Helper.copilotSearchSCFetchRetryMonitorEndpoint,{time:t})};t.emitcopilotSearchSCLatency_TTVR=function(t){return bt(n.Helper.copilotSearchSC_TTVR_MonitorEndpoint,{time:t})};t.emitcopilotSearchSCFetchStatus=function(t,i){return bt(n.Helper.copilotSearchSCFetchStatusMonitorEndpoint,{genStatusType:t,genStatusReason:i})};t.generateHistoricalTurn=ce;t.generateCopilotResponse=kt;t.loadSuggestionChipsByApi=yi;t.loadSuggestionChipsV2=yu;var wu="AnswerCardDimensionUpdate",bu="CopilotAnswerSGID",ku="CitationPopup",du="CopilotAnswerRequeryClick",gu="CopilotSearchDebugData",nf="ThinkStateError",tf="CopilotOverlay",rf="CopilotSearchReadyToFetch",uf="CopilotSearchLadybugData",ff="IframeTTVR",ye="StreamStarted",pe="StreamCompleted",ef="ContainerNoAnswer",sf="CopilotAnswerType",hf="GenAnsCopyData",cf="GenAnsQuoteToFollow",lf="CopilotCopyAds",we=[wu,"AnswerCardResize",bu,ku,du,gu,nf,tf,rf,ff,uf,ef,sf,hf,"MagFollowup","CopilotSearchPerformanceData","CaptchaStatusUpdate","StreamScrapingData","StreamProgress","FullyFormedQuery","CopilotAdsStubTriggeredAds",cf,lf];t.retryLastTurn=uo;gf=oo(function(t,i){n.getMode()!==n.Helper.CopilotMode.Turn&&n.changeMode(n.Helper.CopilotMode.Turn);kt(t,i)},300);t.cleanUpTurnSpacing=ho})(t=n.Conversation||(n.Conversation={}))}(CopilotSearch||(CopilotSearch={})),function(n){var t;(function(t){function ti(t){var w,nt,rt,ut,ht,yt,pt,wt,bt,kt,ti,ii;(ni=t.enableComposerForContinuation,ft=t.locStrings.zeroInputSearchBoxAskMeAnything,et=t.locStrings.copilotSearchBoxFollowUp,l=(w=t.enableAttachment)!==null&&w!==void 0?w:!1,ot=t.enableFeedbackShowAfterStreaming,st=t.enableCopyButtonShow,i=_qs(".composer_wrapper textarea"),i)&&(y=_qs(".composer_wrapper"),c=_qs(".composer_wrapper .b_copilot_icon"),r=_qs(".composer_wrapper .b_copilot_send"),s=_d.querySelector("#b_copilot_search .b_copilot_stop_streaming"),h=_d.querySelector("#b_copilot_search .composer_container"),e=(nt=t.isSERPVertical)!==null&&nt!==void 0?nt:!1,b=(rt=t.goToSERP)!==null&&rt!==void 0?rt:!1,o=(ut=t.enableSERPComposerNewTab)!==null&&ut!==void 0?ut:!1,k=(ht=t.serpComposerFormCode)!==null&&ht!==void 0?ht:"",at=t.enableRewardsReportActivity,ct=(yt=t.enableSERPComposerInst)!==null&&yt!==void 0?yt:!1,f=(pt=t.isMiniSERP)!==null&&pt!==void 0?pt:!1,lt=t.query||"",d=(wt=t.enableSideAlignedComposer)!==null&&wt!==void 0?wt:!1,g=(bt=t.enableSERPChat)!==null&&bt!==void 0?bt:!1,vt=(kt=t.fromSerpComposer)!==null&&kt!==void 0?kt:!1,sj_be(i,"keypress",oi),sj_be(i,"change",v),sj_be(i,"cut",v),sj_be(i,"paste",fi),sj_be(i,"focus",dt),sj_be(i,"blur",gt),sj_be(i,"input",v),sj_be(i,"keydown",it),sj_be(i,"textInput",v),sj_be(i,"click",dt),sj_be(r,"click",si),s&&sj_be(s,"click",function(){var t=n.Helper.getLastTurnId(),f={type:"CopilotSearchStreamingStop",data:{turnId:t}},i=n.Helper.getResponseId();CopilotSearchMessager.postMessageToTurn(t,i,f);n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,n.Helper.LogNames.StopStreamingClick,"responseId",i);tt();ot&&n.TWrap.addFeedbackToTurn();r.disabled=!1;u=!1;n.Conversation.cleanUpTurnSpacing();n.ErrorState.errorHandler(n.ErrorState.ErrorType.STREAMSTOPPED);st&&sj_evt.fire("ShellStopStreaming")}),n.ComposerMenu.init(e,o,k),t.enableModelSwitching&&n.ComposerModelSwitching.init(),sj_evt.bind("csTurnState",function(n){if(n&&n.length>1){var t=n[1];t=="start"?(r.disabled=!0,u=!0):(r.disabled=i.value===""?!0:!1,u=!1)}}),sj_evt.bind("ShellMoreMenu",function(){p=!0}),l&&(sj_evt.bind(n.AttachmentManager.Events.AttachmentAdded,a),sj_evt.bind(n.AttachmentManager.Events.AttachmentRemoved,a)),t.kbZip&&t.showZeroInputPage&&(ti= new URLSearchParams(__get$(window,"location").search) ,ii=ti.get("form")||ti.get("FORM"),ii=="CSSAP5"&&sb_st(function(){a();var t=n.Bridge;t&&t.custom({scenario:"Keyboard",action:"launch"})},100)))}function ii(){return u}function nt(){if(i&&(i.value="",i.setAttribute("rows","1"),gt(),!e&&!f)){s&&tt();var t=n.getMode()===n.Helper.CopilotMode.Zero;t?i.setAttribute("placeholder",ft):i.setAttribute("placeholder",et)}}function a(){setTimeout(function(){i&&i.focus()},0)}function ri(){}function ui(){Lib.CssClass.remove(s,n.Helper.hiddenClassName)}function tt(){Lib.CssClass.add(s,n.Helper.hiddenClassName)}function v(){e&&!ht&&(n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,"ComposerInput"),ht=!0);i.value?u||(r.disabled=!1):u||(r.disabled=!0);it()}function it(){sb_st(yt,0)}function fi(){sb_st(function(){i.value= __call$(i.value,"replace",[/[\r\n]+/g," "]) ;u||(r.disabled=!1);yt()},0)}function yt(){var n;if(i){n=1;i.setAttribute("rows",n.toString());var t=parseInt(window.getComputedStyle(i,null).getPropertyValue("padding-top").split("px")[0])||12,r=parseInt(window.getComputedStyle(i,null).getPropertyValue("padding-bottom").split("px")[0])||12,u=parseInt(window.getComputedStyle(i,null).getPropertyValue("line-height").split("px")[0])||22;n=Math.max(1,Math.ceil((i.scrollHeight-t-r)/u));i.setAttribute("rows",n.toString())}}function pt(){if(!!i.value&&!w.test(i.value)){var t=n.getMode();t==n.Helper.CopilotMode.Zero&&n.ZeroPage.hide();vt&&n.Helper.getLastTurnId()==null&&(n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.ConversationStarted,"convId",n.Helper.getConversationId()),n.PerformanceHelper.markEvent(n.PerformanceHelper.PerformanceMarkers.ConversationStart));n.PerformanceHelper.markEvent(n.PerformanceHelper.PerformanceMarkers.TurnStart);n.changeMode(n.Helper.CopilotMode.Turn);n.Conversation.generateCopilotResponse(i.value,n.Helper.InputTypes.Text);t==n.Helper.CopilotMode.Zero&&typeof sj_rra!="undefined"&&at&&ei();l&&n.AttachmentManager.clearAttachmentsData();nt()}}function ei(){var n=new URL(_d.URL);n.searchParams.set("turnindex","1");sj_rra(n.toString())}function oi(t){if(!t.shiftKey&&t.key==="Enter"){if(t.preventDefault(),u)return;if(!g&&(e||f)){if(!!i.value&&!w.test(i.value)){var r=i.value.trim();n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,"ComposerSubmit","query",r);b?wt(r):bt(r)}return}pt()}}function si(t){if(t.preventDefault(),!u){if(!g&&(e||f)){if(!!i.value&&!w.test(i.value)){var r=i.value.trim();n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,"ComposerSubmit","query",r);b?wt(r):bt(r)}return}pt()}}function wt(n){var i=_ge("sb_form_q"),r=_ge("sb_form"),t,u;!o&&i&&r?(i.value=n,t=_ge("sb_form_go"),t?t.click():r.submit()):(u= __get$(window,"location") .origin+"/search?q="+n+"&FORM=QBRE",window.open(u,o?"_blank":"_self"))}function bt(n){var i= __get$(window,"location") .origin+"/copilotsearch?q="+n+"&pq="+hi()+"&FORM="+k,t;f&&(i+="&webcoms=1");nt();ct?(t=_ge("b_bop_cs_inst"),t&&typeof si_ct=="function"?( __set$(t,"href",i) ,t.target=o?"_blank":"_self",window.si_ct(t),t.click()):kt(i)):kt(i)}function kt(n){o||f?window.open(n,"_blank"): __set$(__get$(window,"location"),"href",n) }function hi(){if(f)return lt;var t= new URLSearchParams(__get$(window,"location").search) ,n=t.get("q");return n?n.trim():""}function dt(){Lib.CssClass.add(y,rt);c&&c.classList.add("hidden");r.classList.remove("hidden");u||(r.disabled=i.value===""?!0:!1);it()}function gt(){i.value===""&&sb_st(function(){if(p){p=!1;return}r.classList.add("hidden");l&&n.AttachmentManager.hasAttachment()||(Lib.CssClass.remove(y,rt),c&&c.classList.remove("hidden"));i.blur()},100)}function ci(){h&&d&&Lib.CssClass.add(h,ut)}function li(){h&&d&&Lib.CssClass.remove(h,ut)}var y,i,ni=!1,u=!1,p=!1,w=/^\s*$/,rt="focusmode",ut="composer_side_aligned",ft,et,l=!1,ot=!1,st=!1,e=!1,b=!1,o=!1,k="",ht=!1,ct=!1,f=!1,lt="",h,c,r,s,at=!1,d=!1,g=!1,vt=!1;t.initComposer=ti;t.getShouldDisableSubmit=ii;t.resetComposer=nt;t.focus=a;t.onUpdate=ri;t.showStopStreamingButton=ui;t.hideStopStreamingButton=tt;t.showSideAlignComposer=ci;t.hideSideAlignComposer=li})(t=n.Composer||(n.Composer={}))}(CopilotSearch||(CopilotSearch={})),function(n){var t;(function(t){function f(){for(var n=0;n<i.length;n++)sj_ue( __get$(i,n) ,u, __get$(r,n) );i=[];r=[]}function e(t,e,o,s){var c,h,a;f();t.innerHTML="";var w=t,v=n.Helper.maxSuggestCount>0?Math.min(n.Helper.maxSuggestCount,e.length):e.length,y=[],l=_d.querySelector(".ca_turn:last-of-type .frame_cont iframe"),p=l===null||l===void 0?void 0:l.getAttribute("IG"),b=(c=s.scPosition)!==null&&c!==void 0?c:"Suggestion {0} of {1}",k=function(t){var s= __get$(e,t) ,f=sj_ce("button",undefined,"suggestion_chip"),a=sj_ce("span",undefined,undefined),h,k,c,l;a.textContent=s.suggestionText;h=t+1;k=s.suggestionText+" "+ __call$(__call$(b,"replace",["{0}",""+(t+1)]),"replace",["{1}",""+v]) ;f.setAttribute("aria-label",k);f.appendChild(a);f.setAttribute("data-index",h.toString());n.Helper.GlobalInstTracker&&n.Helper.instTracker&&(c=n.Helper.instTracker.itemFactory.createInstrumentedItem({Name:"SuggestionChip",Text:s.suggestionText}),y.push(c),f.dataset.cspi=n.Helper.GlobalInstTracker.composeHValue(c),f.dataset.ig=p,f.dataset.clicks="true");i.push(f);l=function(){return o(s,h)};r.push(l);sj_be(f,u,l);w.appendChild(f)};for(h=0;h<v;h++)k(h);a=_qs(".suggestion_wrapper");n.Helper.GlobalInstTracker&&n.Helper.instTracker&&a&&(n.Helper.instTracker.dataSourceSerializer.serializeItemsToJson(y),n.Helper.instTracker.writeLayoutFromElement(a),n.Helper.instTracker.flushInstrumentation(p));sb_st(function(){t.scrollLeft=0},50)}var i=[],r=[],u="click";t.layout=e})(t=n.ChipsLayout||(n.ChipsLayout={}))}(CopilotSearch||(CopilotSearch={}));__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})};__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(o){if(e)throw new TypeError("Generator is already executing.");while(f&&(f=0,o[0]&&(r=0)),r)try{if(e=1,u&&(i=o[0]&2?u["return"]:o[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,o[1])).done)return i;(u=0,i)&&(o=[o[0]&2,i.value]);switch(o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++;u=o[1];o=[0];continue;case 7:o=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&& __get$(i,i.length-1) )&&(o[0]===6||o[0]===2)){r=0;continue}if(o[0]===3&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(o[0]===6&&r.label<i[1]){r.label=i[1];i=o;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(o);break}i[2]&&r.ops.pop();r.trys.pop();continue}o=t.call(n,r)}catch(s){o=[6,s];u=0}finally{e=i=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},e,u,i,f;return f={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&( __set$(f,Symbol.iterator,function(){return this;}) ),f},function(n){var t;(function(t){function ft(){return o}function et(){return s}function b(n){o=n}function k(n){s=n}function ot(n){a=n.retryIntervalMs;u=n.maxRetries;v=n.enableSCGenStatus;y=n.enableAppendClientipToFrame;it=n.enableForceAppendClientipToFrame;f=n.enableNewMultiTurnOverlayMode;e=n.interceptSerpSuggestionChipClicks;p=n.fromSerpComposer;rt=n.interceptScopeClicks;ut=n.mobileUI;o="";s=null;e&&sj_evt.bind("bopCompLoaded",at,!0);f&&typeof sj_evt!="undefined"&&sj_evt.bind("multiturn.resetchips",st,!0)}function st(){d()}function d(){r&&(r.classList.add(n.Helper.hiddenClassName),r.innerHTML="")}function g(t,r,f){var e,o;return r===void 0&&(r=""),f===void 0&&(f=0),__awaiter(this,void 0,void 0,function(){var k,l,p,s,c,w,b,h,d;return __generator(this,function(nt){switch(nt.label){case 0:if(f>=u)return console.error("Fetching suggestion chips data failed after max retries"),n.Conversation.emitScFetchMdmEvent(n.Helper.SuggestionchipMdmFetchType.TotalAjaxReachMaxRetry),n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.SuggestionChipsApiReachMaxRetry,"SHMode",i,"OvrIG",r),n.Helper.logCustomData(n.Helper.ClientInst.SystemEvent,n.Helper.LogNames.SuggestionChipEvent,"CSearch",{SHMode:i+"",Type:n.Helper.LogNames.SuggestionChipsApiReachMaxRetry},r),[2,Promise.resolve(undefined)];console.log("Fetching suggestion chips data, attempt: ",f+1);nt.label=1;case 1:return nt.trys.push([1,4,,6]),k={method:"POST",headers:{"Content-Type":"application/json"}},n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.SuggestionChipsApiSent,"OvrIG",r),n.Helper.logCustomData(n.Helper.ClientInst.SystemEvent,n.Helper.LogNames.SuggestionChipEvent,"CSearch",{retry:f+"",Type:n.Helper.LogNames.SuggestionChipsApiSent},r),l="".concat(n.Helper.suggestionChipsFetchApi,"?key=").concat(t),y&& new URL(__get$(__get$(_w,"location"),"href")) .searchParams.forEach(function(n,t){["clientip"].includes(t)&&(l+="&".concat(t,"=").concat(n))}),[4,fetch(l,k)];case 2:if(p=nt.sent(),!p.ok)throw new Error("Network response was not ok");return[4,p.json()];case 3:if(s=nt.sent(),c=s===null||s===void 0?void 0:s.chips,w=(e=s===null||s===void 0?void 0:s.genStatus)===null||e===void 0?void 0:e.generationStatus,b=(o=s===null||s===void 0?void 0:s.genStatus)===null||o===void 0?void 0:o.generationStatusReason,h= __get$(n.Helper.GenerationStatusReason,b) !=undefined? __get$(n.Helper.GenerationStatusReason,b) :"Default",v&&w==n.Helper.ChipsGenerationStatus.Failure)return console.error("Generation Status is failure"),n.Conversation.emitcopilotSearchSCFetchStatus("Failure",h),n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.SuggestionChipsApiFailure,"OvrIG",r,"GenStatusReason",h),n.Helper.logCustomData(n.Helper.ClientInst.SystemEvent,n.Helper.LogNames.SuggestionChipEvent,"CSearch",{GenStatusReason:h+"",retry:f+"",SHMode:i+"",Type:n.Helper.LogNames.SuggestionChipsApiFailure},r),[2,Promise.resolve(undefined)];if(f==u-1&&w==n.Helper.ChipsGenerationStatus.Failure&&(n.Conversation.emitcopilotSearchSCFetchStatus("Failure",h),n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.SuggestionChipsApiFailure,"OvrIG",r,"GenStatusReason",h),n.Helper.logCustomData(n.Helper.ClientInst.SystemEvent,n.Helper.LogNames.SuggestionChipEvent,"CSearch",{GenStatusReason:h+"",retry:f+"",SHMode:i+"",Type:n.Helper.LogNames.SuggestionChipsApiFailure},r)),!Array.isArray(c)||c.length===0){n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.SuggestionChipsApiEmptyResponse,"OvrIG",r);n.Helper.logCustomData(n.Helper.ClientInst.SystemEvent,n.Helper.LogNames.SuggestionChipEvent,"CSearch",{retry:f+"",Type:n.Helper.LogNames.SuggestionChipsApiEmptyResponse},r);throw new Error("No chips received");}return n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.SuggestionChipsApiSuccess,"OvrIG",r),n.Conversation.emitcopilotSearchSCFetchRetry(f),n.Helper.writeLog(n.Helper.ClientInst.Perf,n.Helper.LogNames.SuggestionChipsRetryNum,"retry",f+"","OvrIG",r),n.Helper.logCustomData(n.Helper.ClientInst.SystemEvent,n.Helper.LogNames.SuggestionChipEvent,"CSearch",{retry:f+"",SHMode:i+"",Type:n.Helper.LogNames.SuggestionChipsApiSuccess},r),[2,c];case 4:return d=nt.sent(),[4,new Promise(function(n){return setTimeout(n,a)})];case 5:return nt.sent(),console.log("Try fetching suggestion chips data again: ",+new Date),n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.SuggestionChipsApiError,"OvrIG",r),n.Helper.logCustomData(n.Helper.ClientInst.SystemEvent,n.Helper.LogNames.SuggestionChipEvent,"CSearch",{retry:f+"",Type:n.Helper.LogNames.SuggestionChipsApiError},r),[2,g(t,r,f+1)];case 6:return[2]}})})}function ht(t,r){return r===void 0&&(r=""),__awaiter(this,void 0,void 0,function(){var u,f;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),n.Conversation.emitScFetchMdmEvent(n.Helper.SuggestionchipMdmFetchType.TotalAjaxSentImpression),n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.TotalSuggestionChipsApiReq,"SHMode",i,"OvrIG",r),n.Helper.logCustomData(n.Helper.ClientInst.SystemEvent,n.Helper.LogNames.SuggestionChipEvent,"CSearch",{SHMode:i+"",Type:n.Helper.LogNames.TotalSuggestionChipsApiReq},r),[4,g(t,r,0)];case 1:return(u=e.sent(),u)?[2,u]:[2,l?c:undefined];case 2:return(f=e.sent(),console.log("Error fetching suggestion chips data: ",f),l)?[2,c]:[2];case 3:return[2]}})})}function nt(t,i,u){k(i);b(t);var f=i.map(function(n){return n.fullFormedQuery}),e=f.join(" | "),o=n.Helper.getResponseId();n.Helper.logCustomData(n.Helper.ClientInst.CopilotInteraction,n.Helper.LogNames.SuggestionChipRender,"CSearch",{NumChips:i.length.toString(),Titles:e,ResponseId:o},u);typeof Log!="undefined"&&typeof Log.LogFilterFlare!="undefined"&&Log.LogFilterFlare(["00csscux00"]);n.ChipsLayout.layout(r,i,tt,n.Helper.locStrings);n.Conversation.emitScFetchMdmEvent(n.Helper.SuggestionchipMdmFetchType.TotalSCRendered)}function ct(t,i,r){return __awaiter(this,void 0,void 0,function(){var u;return __generator(this,function(f){switch(f.label){case 0:return console.log("suggestionChipsId: ",t),[4,ht(t,i)];case 1:return(u=f.sent(),!u)?(console.log("No suggestion chips data received, use the last turn chips"),n.changeMode(n.Helper.CopilotMode.Float),[2,!1]):(r()&&(nt(t,u,i),Log===null||Log===void 0?void 0:Log.Log("SuggestionChipRendered","SCRender","ChipId: "+t,!1,"OvrIG",i),n.Helper.logCustomData(n.Helper.ClientInst.SystemEvent,n.Helper.LogNames.SuggestionChipEvent,"CSearch",{Event:"SCRender",ChipId:t+""},i)),[2,!0])}})})}function lt(){var i=sj_ce("span",undefined,"icon"),n=_d.createElementNS(h,"svg"),t;return n.setAttribute("width","18"),n.setAttribute("height","16"),n.setAttribute("viewBox","0 0 18 16"),n.setAttribute("fill","none"),t=_d.createElementNS(h,"path"),t.setAttribute("d","M4.92704 0.5H11.1392C12.1927 0.5 13.1203 1.19397 13.4176 2.2046L13.8868 3.79901C14.0476 4.34546 14.5266 4.732 15.086 4.78068H15.3751C16.2627 4.78068 16.9479 5.03232 17.4023 5.54832C17.8449 6.05084 17.9913 6.71838 18.0009 7.38707C18.02 8.70801 17.5033 10.349 17.0916 11.6554C16.7333 12.7924 16.273 13.9729 15.6552 14.8777C15.0399 15.7788 14.1999 16.5006 13.073 16.5006H6.87484L6.86695 16.5005H6.86063C5.80716 16.5005 4.87959 15.8066 4.58222 14.796L4.11309 13.2015C3.95237 12.6553 3.47368 12.2689 2.91456 12.2199H2.62488C1.73727 12.2199 1.05209 11.9683 0.59766 11.4523C0.155088 10.9498 0.00871752 10.2822 -0.000950593 9.61354C-0.0200489 8.2926 0.49665 6.65165 0.908378 5.34517C1.26667 4.20826 1.72694 3.02772 2.34477 2.12288C2.96005 1.22178 3.80007 0.5 4.92704 0.5ZM1.86214 5.64574C1.43465 7.00224 0.982671 8.47352 0.998945 9.59908C1.00696 10.1536 1.12929 10.5429 1.34812 10.7914C1.55509 11.0264 1.924 11.2199 2.62488 11.2199H5.25213C5.8614 11.2199 6.39814 10.8195 6.57212 10.2352C7.04172 8.65798 7.83794 5.9963 8.46637 3.95934L8.49937 3.85233C8.64852 3.36841 8.79284 2.90016 8.94826 2.48475C9.08066 2.13087 9.22885 1.79335 9.40955 1.5H4.92704C4.28311 1.5 3.70642 1.90208 3.17062 2.68678C2.63737 3.46774 2.2122 4.53493 1.86214 5.64574ZM4.73445 12.2199C4.88192 12.4288 4.99729 12.6639 5.07243 12.9193L5.54156 14.5137C5.71371 15.0988 6.25073 15.5005 6.86063 15.5005H6.88678C7.24574 15.4969 7.48955 15.3275 7.64066 15.1226C7.80779 14.8959 7.96035 14.5792 8.11514 14.1654C8.25974 13.7789 8.39567 13.3381 8.5478 12.8446L8.57806 12.7465C8.64307 12.5357 8.70989 12.3183 8.77797 12.096C8.543 12.1733 8.29325 12.2147 8.03611 12.2147H5.41074C5.35823 12.2182 5.30534 12.2199 5.25213 12.2199H4.73445ZM7.1935 11.2147H8.03611C8.58916 11.2147 9.08319 10.8842 9.29856 10.3846C9.7359 8.93867 10.1692 7.48844 10.4694 6.48005C10.5449 6.22668 10.6599 5.9933 10.8065 5.78588H9.96376C9.41111 5.78588 8.91739 6.11592 8.70178 6.61487C8.26432 8.06118 7.83086 9.5119 7.53054 10.5206C7.45511 10.7739 7.34011 11.0073 7.1935 11.2147ZM9.22206 4.90449C9.45698 4.82723 9.70667 4.78588 9.96376 4.78588H12.5902C12.6424 4.78243 12.695 4.78068 12.7479 4.78068H13.2655C13.118 4.57183 13.0026 4.33666 12.9274 4.08128L12.4583 2.48687C12.2862 1.90177 11.7491 1.5 11.1392 1.5H11.1244C10.7593 1.50023 10.512 1.67099 10.3593 1.87803C10.1922 2.10467 10.0396 2.42146 9.88485 2.83517C9.74025 3.22167 9.60432 3.66256 9.45219 4.15601L9.42193 4.25415C9.35693 4.46483 9.29012 4.68225 9.22206 4.90449ZM16.1379 11.3549C16.5653 9.99837 17.0173 8.52709 17.001 7.40153C16.993 6.84698 16.8707 6.45771 16.6519 6.20923C16.4449 5.97423 16.076 5.78068 15.3751 5.78068H12.7479C12.1386 5.78068 11.6018 6.18108 11.4279 6.76541C10.9583 8.34263 10.1621 11.0043 9.53362 13.0413L9.50062 13.1483C9.35147 13.6322 9.20715 14.1005 9.05173 14.5159C8.91933 14.8697 8.77114 15.2073 8.59044 15.5006H13.073C13.7169 15.5006 14.2936 15.0985 14.8294 14.3138C15.3626 13.5329 15.7878 12.4657 16.1379 11.3549Z"),n.appendChild(t),i.appendChild(n),i}function tt(t,i,r){if(r===void 0&&(r=!0),console.log("Chip clicked: ".concat(t.suggestionText)),p&&e&&n.Helper.getLastTurnId()==null&&(n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.ConversationStarted,"convId",n.Helper.getConversationId()),n.PerformanceHelper.markEvent(n.PerformanceHelper.PerformanceMarkers.ConversationStart)),n.PerformanceHelper.markEvent(n.PerformanceHelper.PerformanceMarkers.TurnStart),n.Helper.writeLog(n.Helper.ClientInst.Click,n.Helper.LogNames.QueryIssued,"inputType",n.Helper.InputTypes.SuggestionChip,"query",t.fullFormedQuery,"displayedQuery",t.suggestionText),r&&n.Helper.logCustomData(n.Helper.ClientInst.CopilotInteraction,n.Helper.LogNames.SuggestionChipClick,"CSearch",{Position:i.toString(),Title:t.fullFormedQuery,ResponseId:n.Helper.getResponseId()},""),f&&typeof sj_evt!="undefined"&&typeof _w._bingMultiTurnEmitter!="undefined"){n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,"MultiTurnOverlayTriggered","query",t.fullFormedQuery,"inputType","SuggestionChip");sj_evt.fire("multiturnQuery",{query:t.fullFormedQuery});return}n.Conversation.generateCopilotResponse(t.fullFormedQuery,n.Helper.InputTypes.SuggestionChip,t.suggestionText)}function at(){var n=_d.querySelectorAll(".suggestion_chip, .sc_item");n&&n.forEach(function(n){sj_be(n,"click",vt)})}function vt(t){var i,r,u,f,e,o;return(t=sj_ev(t),i=t.target,!i)?!0:(r=i.closest("a"),!r)?!0:(u=r.getAttribute("data-query"),f=i.innerText||i.textContent,!u)?!0:(e={suggestionText:f,fullFormedQuery:u},o=Number(r.dataset.index),sj_sp(t),sj_pd(t),tt(e,o,!1),n.Composer.resetComposer(),!1)}var c=[{suggestionText:"Tom Hanks",fullFormedQuery:"Tom Hanks"},{suggestionText:"Clam digging safety tips in Florida",fullFormedQuery:"Clam digging safety tips in Florida"},{suggestionText:"which universal park is best",fullFormedQuery:"which universal park is best"}],l=n.Helper.getValueFromUrl("useMockChips")==="1"?!0:!1,r=_qs(".suggestion_wrapper"),a=200,u=5,v=!1,y=!1,it=!1,f=!1,p=!1,rt=!1,ut=!1,e=!1,w=n.Helper.getValueFromUrl("shm"),i=w==="cr"?"CacheReuse":w==="co"?"CacheOnly":"Unknown",o="",s=null,h;t.getSuggestionChipId=ft;t.getSuggestionChips=et;t.setSuggestionChipId=b;t.setSuggestionChips=k;t.init=ot;t.resetChips=d;t.renderSuggestionChips=nt;t.updateSuggestionChips=ct;h="http://www.w3.org/2000/svg";t.newSpan=lt})(t=n.SuggestionChips||(n.SuggestionChips={}))}(CopilotSearch||(CopilotSearch={}));__awaiter=this&&this.__awaiter||function(n,t,i,r){function u(n){return n instanceof i?n:new i(function(t){t(n)})}return new(i||(i=Promise))(function(i,f){function o(n){try{e(r.next(n))}catch(t){f(t)}}function s(n){try{e(r["throw"](n))}catch(t){f(t)}}function e(n){n.done?i(n.value):u(n.value).then(o,s)}e((r=r.apply(n,t||[])).next())})};__generator=this&&this.__generator||function(n,t){function o(n){return function(t){return s([n,t])}}function s(o){if(e)throw new TypeError("Generator is already executing.");while(f&&(f=0,o[0]&&(r=0)),r)try{if(e=1,u&&(i=o[0]&2?u["return"]:o[0]?u["throw"]||((i=u["return"])&&i.call(u),0):u.next)&&!(i=i.call(u,o[1])).done)return i;(u=0,i)&&(o=[o[0]&2,i.value]);switch(o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++;u=o[1];o=[0];continue;case 7:o=r.ops.pop();r.trys.pop();continue;default:if(!(i=r.trys,i=i.length>0&& __get$(i,i.length-1) )&&(o[0]===6||o[0]===2)){r=0;continue}if(o[0]===3&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(o[0]===6&&r.label<i[1]){r.label=i[1];i=o;break}if(i&&r.label<i[2]){r.label=i[2];r.ops.push(o);break}i[2]&&r.ops.pop();r.trys.pop();continue}o=t.call(n,r)}catch(s){o=[6,s];u=0}finally{e=i=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},e,u,i,f;return f={next:o(0),"throw":o(1),"return":o(2)},typeof Symbol=="function"&&( __set$(f,Symbol.iterator,function(){return this;}) ),f},function(n){var t;(function(t){function k(){var n=_d.querySelectorAll(".cs_zip_element");n.forEach(function(n){var t=_qs(".cs_zip_answer_caption_text",n),r="",i="",u,f,e;t&&(r=t.textContent,u=t.getAttribute("data-optdoc"),f=t.getAttribute("data-optdocv"),u&&(i+='OptDocId:"'+encodeURIComponent(u)+'"',f&&(i+='+OptDocVersion:"'+encodeURIComponent(f)+'"')));e=_qs("img",n);e&&b.push(e);sj_be(n,"click",function(){w(r,i)});sj_be(n,"keypress",function(n){n.shiftKey||n.key!=="Enter"||(n.preventDefault(),w(r,i))})})}function d(t){var p;(u=t||{},r=_qs(".b_copilot_search"),f=_qs(".copilot_zero_input"),h=u.enableZeroPageHistory,s=u.mobCompH,c=(p=u.enableSideAlignedComposer)!==null&&p!==void 0?p:!1,r&&f)&&(sj_evt.bind("csScopeClk",function(){y()}),sj_evt.bind("cszipfetch",function(){a=!0}),u.showZeroInputPage?(Lib.CssClass.add(r,o),r.style.paddingBottom="0px",n.changeMode(n.Helper.CopilotMode.Zero),e=!0,h&&history&&history.replaceState&&history.replaceState({zeropage:!0},""),i===null||i===void 0?void 0:i.navigate("zip")):(Lib.CssClass.add(f,n.Helper.hiddenClassName),r.style.paddingBottom="".concat(s,"px"),i===null||i===void 0?void 0:i.navigate("turn")),sj_evt.bind("cszipclk",k),u.showZeroInputPage?sj_evt.fire("cszipfetch",u):sj_evt.bind(l,v))}function v(n){if(n&&n.length>1){var t=n[1];(t=="chips"||t=="fail")&&(sj_evt.fire("cszipfetch",u),sj_evt.unbind(l,v))}}function y(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return e?[2]:(a||sj_evt.fire("cszipfetch",u),e=!0,[4,n.Conversation.resetConversation(!0)]);case 1:return t.sent(),sj_evt.fire("ShellNavigationEvent","zip"),i===null||i===void 0?void 0:i.navigate("zip",!0),n.changeMode(n.Helper.CopilotMode.Zero),n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.ZeroInputPageLoaded),Log.LogFilterFlare(["cszeroinputpage"]),h&&history&&history.replaceState&&history.replaceState({zeropage:!0},""),sb_st(function(){var t,u=n.Helper.hiddenClassName,i=Lib.CssClass,e=_qs(".suggestion_wrapper");e&&i.add(e,u);i.remove(f,u);_d.body.scrollTo({left:0,top:0});i.add(r,o);r.style.paddingBottom="0px";n.Composer.resetComposer();c&&((t=n.Composer)===null||t===void 0?void 0:t.hideSideAlignComposer())},100),[2]}})})}function p(){var t,u;e&&(sj_evt.fire("ShellNavigationEvent","turn"),i===null||i===void 0?void 0:i.navigate("turn",!0),e=!1,u=Lib.CssClass,u.add(f,n.Helper.hiddenClassName),u.remove(r,o),r.style.paddingBottom="".concat(s,"px"),c&&((t=n.Composer)===null||t===void 0?void 0:t.showSideAlignComposer()))}function w(t,i){p();n.changeMode(n.Helper.CopilotMode.Turn);n.Conversation.generateCopilotResponse(t,n.Helper.InputTypes.Zero,"",i);n.Composer.resetComposer();n.PerformanceHelper.markEvent(n.PerformanceHelper.PerformanceMarkers.TurnStart);n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,n.Helper.LogNames.ZeroInputCardClicked);n.Helper.logCustomData(n.Helper.ClientInst.CopilotInteraction,n.Helper.LogNames.DiscoverCardClicked,"CSearch",{Query:t},"")}var o="zip",f,r,e=!1,s=0,b=[],l="csTurnState",h=!1,a=!1,u,i=n.Bridge,c=!1;t.init=d;t.show=y;t.hide=p})(t=n.ZeroPage||(n.ZeroPage={}))}(CopilotSearch||(CopilotSearch={})),function(n){function o(n){e=n.enableSERPChat?".err_cont":"#b_copilot_search .err_cont"}function s(n,e,o){u?(i&&(sj_ue(t,f,i),i=undefined),sj_be(t,f,o),i=o,r.textContent=e.msg,t.childNodes[1].textContent=e.action):h(n,o,e);var s=Lib.CssClass,c="hidden";e.action?s.remove(t,c):s.add(t,c)}function h(n,o,s,h){var y,c,p,w;i=o;u=h!==null&&h!==void 0?h:_qs(e);var v=sj_ce("div",undefined,"err_msg"),a="http://www.w3.org/2000/svg",b=sj_ce("span",undefined,"icon"),l=_d.createElementNS(a,"svg");l.setAttribute("width","16");l.setAttribute("height","16");l.setAttribute("viewBox","0 0 16 16");l.setAttribute("fill","none");y=_d.createElementNS(a,"path");y.setAttribute("d","M9.09184 2.76331C8.61488 1.90972 7.38669 1.9096 6.90956 2.76309L2.15682 11.2648C1.69103 12.098 2.29333 13.1247 3.2479 13.1247H12.7512C13.7056 13.1247 14.3079 12.0982 13.8424 11.265L9.09184 2.76331ZM8.75 10.375C8.75 10.7892 8.41421 11.125 8 11.125C7.58579 11.125 7.25 10.7892 7.25 10.375C7.25 9.96079 7.58579 9.625 8 9.625C8.41421 9.625 8.75 9.96079 8.75 10.375ZM7.5 8.125V5.625C7.5 5.34886 7.72386 5.125 8 5.125C8.27614 5.125 8.5 5.34886 8.5 5.625V8.125C8.5 8.40114 8.27614 8.625 8 8.625C7.72386 8.625 7.5 8.40114 7.5 8.125Z");l.appendChild(y);b.appendChild(l);v.appendChild(b);r=_d.createElement("div");r.textContent=s.msg;r.classList.add("err_text");v.appendChild(r);u.appendChild(v);c=_d.createElementNS(a,"svg");c.setAttribute("width","16");c.setAttribute("height","16");c.setAttribute("viewBox","0 0 16 16");c.setAttribute("fill","none");p=_d.createElementNS(a,"path");p.setAttribute("d","M3 8C3 5.23858 5.23858 3 8 3C9.63527 3 11.0878 3.78495 12.0005 5H10C9.72386 5 9.5 5.22386 9.5 5.5C9.5 5.77614 9.72386 6 10 6H12.8904C12.8973 6.00014 12.9041 6.00014 12.911 6H13C13.2761 6 13.5 5.77614 13.5 5.5V2.5C13.5 2.22386 13.2761 2 13 2C12.7239 2 12.5 2.22386 12.5 2.5V4.03138C11.4009 2.78613 9.79253 2 8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14C11.1301 14 13.6999 11.6035 13.9756 8.54488C14.0003 8.26985 13.7975 8.0268 13.5225 8.00202C13.2474 7.97723 13.0044 8.1801 12.9796 8.45512C12.75 11.003 10.6079 13 8 13C5.23858 13 3 10.7614 3 8Z");c.appendChild(p);w=sj_ce("span",undefined,"icon");w.appendChild(c);t=sj_ce("button",undefined,"retry_btn");t.appendChild(w);t.appendChild(_d.createTextNode(s.action));u.appendChild(t);sj_be(t,f,i)}var u,t,r,e="",i,f="click";n.ErrorUI={updateView:s,init:o}}(CopilotSearch||(CopilotSearch={})),function(n){var t;(function(t){function w(t){h=t.enableNoResultRetryBtn;l=t.disableAutoHorizontalScrollAnswer;a=t.enableStopStreamMsgInTurn;o=t.enableSERPChat?".err_cont":"#b_copilot_search .err_cont";y=t.enableSERPChat?"SERP":"CopilotSearchHeader";h&&(c.search_no_results=s.retry);nt(t.locStrings);n.ErrorUI.init(t)}function b(){var n= __get$(c,e) || __get$(c,i.UNKNOWN) ;n();p()}function k(t,r){var o,s,h;e=t||i.UNKNOWN;v=r||"";a&&t==i.STREAMSTOPPED?(o=_qs(".ca_turn[turnid='"+n.Helper.getLastTurnId()+"']"),s=_qs(".err_turn_cont",o),s||(h=n.ErrorUI.generateInTurnView(e,{msg: __get$(u,e) ,action: __get$(f,e) }),o.appendChild(h))):(n.ErrorUI.updateView(e,{msg: __get$(u,e) ,action: __get$(f,e) },b),g())}function d(t,i){k(t,i);n.Composer.onUpdate(n.Helper.CopilotSearchState.Error)}function p(){var t=_qs(o);t&&!Lib.CssClass.contains(t,n.Helper.hiddenClassName)&&t.classList.add(n.Helper.hiddenClassName)}function g(){var t=_qs(o),i;t&&Lib.CssClass.contains(t,n.Helper.hiddenClassName)&&(Lib.CssClass.remove(t,n.Helper.hiddenClassName),it(),i=n.Helper.getResponseId(),n.Helper.writeOverrideLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.Error,v,"ErrorType",e,"ResponseId",i,"Shell",y.toString()))}function nt(n){Object.values(i).forEach(function(t){switch(t){case i.ERROR_OCCURRED: __set$(u,t,n.errorOccurred) ; __set$(f,t,"") ;break;case i.LIMIT_REACHED: __set$(u,t,n.searchLimitReached) ; __set$(f,t,"") ;break;case i.SEARCH_FAILED: __set$(u,t,n.searchFailed) ; __set$(f,t,n.retryButtonText) ;break;case i.SEARCH_NO_RESULTS: __set$(u,t,n.searchNoResult) ; __set$(f,t,h?n.retryButtonText:"") ;break;case i.SEARCH_TIMEOUT_FALLBACK:case i.SEARCH_TIMEOUT: __set$(u,t,n.searchCanceled) ; __set$(f,t,n.retryButtonText) ;break;case i.SUGGESTION_KEY_RESULT_LOAD_FAILED: __set$(u,t,n.suggestionKeyResultLoadFailedText) ; __set$(f,t,"") ;break;case i.CS_ANSWER_SUGGESTION_KEY_TIMEOUT: __set$(u,t,n.errorOccurred) ; __set$(f,t,"") ;break;case i.OFFENSIVE: __set$(u,t,n.offensiveSearchText) ; __set$(f,t,"") ;break;case i.UNAUTHORIZED: __set$(u,t,n.unauthorizedSearchText) ; __set$(f,t,"") ;break;case i.STREAMSTOPPED: __set$(u,t,n.streamStoppedText) ; __set$(f,t,"") ;break;case i.UNKNOWN:default: __set$(u,t,"") ; __set$(f,t,"") }})}function tt(n){switch(n.ErrorMsg){case"Throttled":return i.LIMIT_REACHED;case"Unauthorized":return i.UNAUTHORIZED;case"Offensive":return i.OFFENSIVE;case"Default":default:return i.SEARCH_FAILED}}function it(){var n=_qs(o),t;n&&(l?(t=n.getBoundingClientRect(),window.scrollTo({top:window.scrollY+t.top,behavior:"smooth"})):n.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}))}var r,i;(function(n){n.ERROR_OCCURRED="error_occurred";n.LIMIT_REACHED="limit_reached";n.SEARCH_FAILED="search_failed";n.SEARCH_TIMEOUT="search_timeout";n.SEARCH_TIMEOUT_FALLBACK="search_timeout_fallback";n.SEARCH_NO_RESULTS="search_no_results";n.SUGGESTION_KEY_RESULT_LOAD_FAILED="suggestion_key_result_load_failed";n.CS_ANSWER_SUGGESTION_KEY_TIMEOUT="cs_answer_suggestion_key_timeout";n.UNKNOWN="unknown";n.OFFENSIVE="offensive";n.UNAUTHORIZED="unauthorized";n.STREAMSTOPPED="stream_stopped"})(i=t.ErrorType||(t.ErrorType={}));var e=i.UNKNOWN,h=!1,l=!1,a=!1,v="",o="",y="",u={},f={},s={retry:n.Conversation.retryLastTurn,restart:n.Conversation.retryLastTurn,refresh:function(){}},c=(r={}, __set$(r,i.CS_ANSWER_SUGGESTION_KEY_TIMEOUT,function(){}) , __set$(r,i.ERROR_OCCURRED,function(){}) , __set$(r,i.LIMIT_REACHED,function(){}) , __set$(r,i.SEARCH_FAILED,s.retry) , __set$(r,i.SEARCH_TIMEOUT,s.retry) , __set$(r,i.SEARCH_TIMEOUT_FALLBACK,s.retry) , __set$(r,i.SEARCH_NO_RESULTS,function(){}) , __set$(r,i.SUGGESTION_KEY_RESULT_LOAD_FAILED,function(){}) , __set$(r,i.UNKNOWN,function(){}) , __set$(r,i.OFFENSIVE,function(){}) , __set$(r,i.UNAUTHORIZED,function(){}) , __set$(r,i.STREAMSTOPPED,function(){}) ,r);t.init=w;t.errorHandler=d;t.hideErrorState=p;t.handleIframeErrors=tt})(t=n.ErrorState||(n.ErrorState={}))}(CopilotSearch||(CopilotSearch={})),function(n){function ft(){var n=Lib.CssClass,o;r>=0&&n.remove( __get$(e,r) ,b);for(o in e)n.add( __get$(e,o) ,f);p=null;d=null;r=-1;u=!1;w=!1;a=!1;v=!1;tt=!1;it=!1;ot=!1;l=null;n.add(t,f);sj_ue(i,"scroll",k);i.innerHTML="";h={}}function kt(n,t){lt=n.ovlLinks;at=n.ovlSources;vt=n.ovrCloseButtonText;ct=t}function pt(n){return n=="Sources"?g:nt}function dt(t){var u,o,s;if(!w&&(u=t&&t.iframeid&&t.frags&&t.frags.length>0,u)&&(t.frags.forEach(function(n){n.content&&n.content.length>0||(u=!1)}),u)){if(p==null)if(t.initType)p=t.iframeid,d=t.initType;else return;else{if(t.iframeid!=p)return;if(t.initType)return}(l=t&&n.Helper.getImpressionId(t),o=Lib.CssClass,ii(),s=!1,t.frags.forEach(function(n){var r=n.type,t=pt(r),i; __get$(h,t) ||(s=!0,i=ui(n), __set$(h,t,i) ,o.remove( __get$(e,t) ,f))}),s)&&(sj_be(i,"scroll",k),r<0&&(r=pt(d),o.add( __get$(e,r) ,b)),it=!0,tt?et(h,function(n){var t=ht();n<t?(c=n,i.style.height=n+"px"):(c=t,i.style.height=t+"px")}):sb_st(function(){ni()},100))}}function gt(n){var i=n.cloneNode(!0),t=sj_ce("div"),r;return t.style.cssText="position: absolute;visibility: hidden;left: -9999px;",t.appendChild(i),document.body.appendChild(t),r=i.offsetHeight,t.remove(),r}function et(n,t){var i=0,u,r;for(u in n)r=gt( __get$(n,u) ),r>i&&(i=r);t(i)}function ni(){var i,e;u||(tt=!0,i=n.Helper,i.writeOverrideLog(i.ClientInst.CopilotInteraction,i.LogNames.OverlayPopup,l),a=!0,u=!0,e=Lib.CssClass,e.remove(t,f),e.add(t,rt),t.setAttribute("aria-hidden","false"),t.focus(),et(h,function(n){var i=ht();c=n<i?n:i;st(r);sb_st(function(){e.remove(s,f);t.style.animationName="none";t.style.transform="translateY(0)";u=!1},bt)}))}function y(){var r,i;u||(w=!0,u=!0,r=n.Helper,r.writeOverrideLog(r.ClientInst.CopilotInteraction,r.LogNames.OverlayDimiss,l),i=Lib.CssClass,i.remove(t,rt),i.add(s,f),ot?(t.style.animationName="none",t.style.transform="translateY(100%)",setTimeout(function(){i.add(t,f);t.setAttribute("aria-hidden","true");ft()},ut)):(i.add(t,yt),t.style.animationName="coll",setTimeout(function(){i.add(t,f);i.remove(t,yt);t.setAttribute("aria-hidden","true");t.style.animationName="none";t.style.transform="translateY(100%)";ft()},ut)))}function ti(i,r,e){function a(){var n=(new Date).getTime();c||(c=n);var o=n-c,u=Math.min(o/ut,1),s=r+(e-r)*u;i.style.transform="translateY(".concat(s,"px)");u<1?requestAnimationFrame(a):(h.add(t,f),t.setAttribute("aria-hidden","true"),ft())}var o,h,c;u||(w=!0,u=!0,o=n.Helper,o.writeOverrideLog(o.ClientInst.CopilotInteraction,o.LogNames.OverlayDimiss,l),h=Lib.CssClass,h.remove(t,rt),h.add(s,f),c=0,a())}function wt(n){return function(){var t=Lib.CssClass;n!=r&&(r>=0&&t.remove( __get$(e,r) ,b),t.add( __get$(e,n) ,b),r=n,st(n))}}function k(){u||(i.scrollTop<=0?a=!0:i.scrollTop+i.clientHeight>=i.scrollHeight?v=!0:(v=!1,a=!1))}function st(n){var r= __get$(h,n) ;r&&(sj_ue(i,"scroll",k),t.replaceChild(r,i),r.style.overscrollBehaviorY="contain",i=r,i.style.height=c+"px",sj_be(i,"scroll",k),a=!0,sb_st(function(){v=i.scrollHeight<=i.clientHeight},50))}function ht(){return Math.floor(_w.innerHeight*92/100)-68}function ii(){var tt,a,f,d,l,w;if(!t){s=sj_ce("div",undefined,"cs_mask hidden");sj_be(s,"click",y);t=sj_ce("div",undefined,"ovlpan");t.setAttribute("role","dialog");t.setAttribute("aria-modal","true");t.setAttribute("tabindex","-1");sj_be(t,"keydown",fi);tt=sj_ce("div",undefined,"ovnot");t.appendChild(tt);var b=sj_ce("div",undefined,"ovltabclo"),k=sj_ce("div",undefined,"ovltabs"),p=sj_ce("button",undefined,"ovltab hidden");p.textContent=at;sj_be(p,"click",wt(g));a=sj_ce("button",undefined,"ovltab hidden");a.textContent=lt;sj_be(a,"click",wt(nt)); __set$(e,g,p) ; __set$(e,nt,a) ;k.appendChild(p);k.appendChild(a);f=sj_ce("div",undefined,"ovlclo");f.appendChild(n.Base.closvg());f.setAttribute("tabindex","0");f.setAttribute("role","button");f.setAttribute("aria-label",vt);sj_be(f,"click",y);b.appendChild(k);b.appendChild(f);t.appendChild(b);i=sj_ce("div",undefined,"ovlcont");t.appendChild(i);d=_qs("#b_copilot_search");d.appendChild(s);d.appendChild(t);l=0;w=null;function rt(n){if(n.stopPropagation(),o>=100){var i=t.clientHeight;o*2<=i?ti(t,o,i):(ot=!0,y())}else t.style.transform="translateY(0)"}sj_be(s,"touchmove",function(n){n.cancelable&&n.preventDefault();n.stopPropagation()});sj_be(t,"touchstart",function(n){if(u){n.cancelable&&n.preventDefault();return}o=0;l=0;var t=n.touches[0];i.scrollTop<=0&&(l=t.clientY)});sj_be(t,"touchmove",function(n){var r,f;if(u){n.cancelable&&n.preventDefault();return}r=n.touches[0];i.scrollTop<=0&&(l<=0?(l=r.clientY,o=0):(f=r.clientY,o=f-l,o>=0&&n.cancelable&&n.preventDefault(),w||(w=requestAnimationFrame(function(){t.style.transform="translateY(".concat(Math.max(o,0),"px)");w=null}))));v&&r.pageY<l&&n.cancelable&&n.preventDefault()});sj_be(t,"touchcanel",rt);sj_be(t,"touchend",rt);sj_evt.bind("ShellResize",function(){it&&et(h,function(n){var t=ht();c=n<t?n:t;st(r)})})}}function ri(t,i){var r=sj_ce("a",undefined,"ovlitc"),f,u,e;r.setAttribute("href", __get$(t,"href") );r.setAttribute("target","_blank");sj_be(r,"click",function(){var r=n.Helper;r.writeOverrideLog(r.ClientInst.CopilotInteraction,i=="Sources"?r.LogNames.OverlayCitationClick:r.LogNames.OverlayLinkClick,l);n.Helper.logCustomData(n.Helper.ClientInst.CopilotInteraction,i=="Sources"?r.LogNames.OverlayCitationClick:r.LogNames.OverlayLinkClick,"CSearch",{Title:t.title,Url: __get$(t,"href") ,ResponseId:n.Helper.getResponseId()},l)});var o=sj_ce("div",undefined,"top-row"),h=sj_ce("div",undefined,"title"),c=sj_ce("div",undefined,"snip");h.textContent=t.title;c.textContent=t.snip;var s=sj_ce("div",undefined,"botc"),a=sj_ce("div",undefined,"sitec"),v=sj_ce("span",undefined,"link"),y=sj_ce("img",undefined,"img");return y.src=t.favIcon+"&w=16&h=16",t.displayURL= __call$(t.displayURL,"replace",[/^https?:\/\//,""]) .split(/[ /]/)[0],f=sj_ce("div",undefined,"bottom-row-text"),a.appendChild(y),o.appendChild(a),v.textContent=t.displayURL,o.appendChild(v),f.appendChild(h),f.appendChild(c),s.appendChild(f),t.image&&(u=sj_ce("a",undefined,"site-image"), __set$(u,"href",__get$(t,"href")) ,u.target="_blank",e=sj_ce("img",undefined,"item-image"),e.src=t.image,e.setAttribute("role","presentation"),u.appendChild(e),s.appendChild(u)),r.appendChild(o),r.appendChild(s),r}function ui(n){for(var r,u,i=sj_ce("div",undefined,"ovlcont"),f=Math.min(ct,n.content.length),t=0;t<f;t++)r= __get$(n.content,t) ,u=ri(r,n.type),i.appendChild(u);return i}function fi(n){if(n.key=="Escape")y();else if(n.key==="Enter"||n.key===" ")document.activeElement instanceof HTMLElement&&document.activeElement.classList.contains("ovlclo")&&y();else if(n.key==="Tab"){var u='a[href], button:not([disabled]), [tabindex]:not([disabled]):not([tabindex="-1"])',i=AccessibilityHelpers.getFocusableElementWithin(t,!1,u),r=AccessibilityHelpers.getFocusableElementWithin(t,!0,u);if(!i||!r)return;n.shiftKey?document.activeElement===i&&(n.preventDefault(),r.focus()):document.activeElement===r&&(n.preventDefault(),i.focus())}}var ct=20,lt,at,vt,t,s,e={},i,h={},p=null,d=null,r=-1,g=0,nt=1,u=!1,a=!1,v=!1,tt=!1,w=!1,c=0,l=null,it=!1,o=0,f="hidden",rt="exp",yt="col",b="sel",bt=200,ut=100,ot=!1;n.Overlay={init:kt,show:dt}}(CopilotSearch||(CopilotSearch={})),function(n){function c(){return i}function h(t){var f=_d.body,e;if(f&&t&&t!==i){i&&Lib.CssClass.remove(f, __get$(u,i) );Lib.CssClass.add(f, __get$(u,t) );i=t;switch(t){case n.Helper.CopilotMode.Zero:r&&n.Scopebar.updateScopeLink();o&&(e=_ge("b_copilot_search"),e&&Lib.CssClass.remove(e,"b_zero_mode"));break;case n.Helper.CopilotMode.Float:n.Composer.onUpdate(n.Helper.CopilotSearchState.FloatCompose);break;case n.Helper.CopilotMode.FloatZero:n.Composer.onUpdate(n.Helper.CopilotSearchState.FloatingZeroPage)}}}function l(t){var r,i;h(t);r=e&&!f;r||(i=_qs(".composer_container"),i&&Lib.CssClass.remove(i,n.Helper.hiddenClassName))}function a(t){var i,u,h,c,a,v,y;r=t.enableScopeLinkUpdate;e=t.enableNewLayout;o=t.enableZeroPageLoadFix;s=t.enableAutoFocusOnComposer;n.PerformanceHelper.markEvent(n.PerformanceHelper.PerformanceMarkers.TurnStart);u=n.Base;u&&u.init(t);f=t.mobileUI;h=n.Helper.CopilotMode.Zero;t.showZeroInputPage||(h=n.Helper.CopilotMode.Turn);n.turnContainerElementName=t.enableAjaxRequestFlow?"iso-comp":"iframe";n.Helper.initConfig(t);n.ErrorState.init(t);n.Composer.initComposer(t);n.SuggestionChips.init(t);c=n.Bridge;c&&c.init(t);n.ZeroPage.init(t);l(h);n.TWrap.init(t);n.Conversation.initConversation(t);n.TopMenu.init(t);n.FeedbackData.init(t);n.History.init(t);a=n.Overlay;a&&a.init(t.locStrings,t.ovlMaxCnt,t.enableOverlaySnippet);r&&n.Scopebar.init(t);t.enableAttachment&&t.attachmentConfig&&(n.ImageAttachmentConfig.init(t.attachmentConfig),n.AttachmentManager.init(t.attachmentManagerConfig));n.Threads&&n.Threads.init(t);s&&((i=n.Composer)===null||i===void 0?void 0:i.focus());v=function(){var i=n.SecondBundle;i&&i.init(t);sj_evt.unbind("ShellSecondBundleLoaded",v)};sj_evt.bind("ShellSecondBundleLoaded",v);y=n.DebugBundle;y&&y.init(t)}var t,u=(t={}, __set$(t,n.Helper.CopilotMode.Turn,"b_turn_mode") , __set$(t,n.Helper.CopilotMode.Zero,"b_zero_mode") , __set$(t,n.Helper.CopilotMode.Rest,"b_rest_mode") , __set$(t,n.Helper.CopilotMode.Float,"b_float_mode") , __set$(t,n.Helper.CopilotMode.FloatZero,"b_floatzero_mode") ,t);n.turnContainerElementName="iframe";var f=!1,i,r=!1,e=!1,o=!1,s=!1;n.getMode=c;n.changeMode=h;n.init=a}(CopilotSearch||(CopilotSearch={})),function(n){function c(c,l,a){t=_qs("#b_copilot_search .b_copilot_menu_more");i=_qs(f);e=c;o=l;s=a;sj_be(t,"click",function(){t.setAttribute("aria-expanded",i.classList.contains("hidden")?"true":"false");i.classList.toggle("hidden");sj_evt.fire("ShellMoreMenu");n.Helper.writeLog(n.Helper.ClientInst.CopilotInteraction,n.Helper.LogNames.MenuToggle);sj_evt.fire(h)});sj_be(t,"click",function(n){n.stopPropagation()});sj_be(_d.body,"click",function(){sj_evt.fire(u)});sj_evt.bind(u,r);v();n.ComposerFileUploadMenu&&n.ComposerFileUploadMenu.initializeImageUpload();sj_be(i,"keydown",function(n){if(n.key==="Escape")r(),t.setAttribute("aria-expanded","false"),t.focus();else if(n.key==="Tab"){var e='a[href], button:not([disabled]), [tabindex]:not([disabled]):not([tabindex="-1"])',u=AccessibilityHelpers.getFocusableElementWithin(i,!1,e),f=AccessibilityHelpers.getFocusableElementWithin(i,!0,e);if(!u||!f)return;u===f?(n.preventDefault(),r(),t.setAttribute("aria-expanded","false"),t.focus()):n.shiftKey?document.activeElement===u&&(n.preventDefault(),f.focus()):document.activeElement===f&&(n.preventDefault(),u.focus())}})}function l(){Lib.CssClass.add(t,n.Helper.hiddenClassName)}function a(){Lib.CssClass.remove(t,n.Helper.hiddenClassName)}function r(){_d.querySelectorAll(f).forEach(function(t){Lib.CssClass.add(t,n.Helper.hiddenClassName)})}function v(){var t=_qs(".b_copilot_menu_new_search");sj_be(t,"click",function(){if(e){y();return}var t=n.Helper.getLastTurnId(),i=n.Helper.getConversationId(),r=n.Helper.getResponseId();n.Helper.logCustomData(n.Helper.ClientInst.CopilotInteraction,n.Helper.LogNames.NewSearchClicked,"CSearch",{ConversationId:i,TurnIndex:t,ResponseId:r},"");n.Composer.resetComposer();n.AttachmentManager&&n.AttachmentManager.clearAttachmentsData();n.ZeroPage.show();sj_evt.fire("csTurnState","reset")})}function y(){var n= __get$(window,"location") .origin+"/copilotsearch?q=&FORM="+s;o?window.open(n,"_blank"): __set$(__get$(window,"location"),"href",n) }var u="cpltsrch_outClickCloseMenu",h="cpltsrch_outClickCloseModelSwitching",f="#b_copilot_search .b_copilot_menu_cont",t,i,e=!1,o=!1,s="",p={init:c,hideMenu:l,showMenu:a};n.ComposerMenu=p}(CopilotSearch||(CopilotSearch={})),function(n){var t;(function(t){function r(n){var r,t,i,u,e;if(n===void 0&&(n=""),t=_d.querySelectorAll(".b_scopebar li[data-menuurl] a"),t===null||t===void 0?void 0:t.length)for(i=0;i<t.length;i++)u= __get$(t,i) ,e=((r=u.getAttribute("href"))===null||r===void 0?void 0: __call$(r,"replace",[f,"q=".concat(encodeURIComponent(n))]) )||"",e&&u.setAttribute("href",e)}function u(){i?sj_evt.fire("csScopeClk"):n.getMode()!==n.Helper.CopilotMode.Zero&&(n.changeMode(n.Helper.CopilotMode.Zero),n.ZeroPage.show())}function e(n){if(!((n===null||n===void 0?void 0:n.length)<2)){var t=n[1];r(t)}}function o(n){i=n.mobileUI;var t=_qs(".b_scopebar #b-scopeListItem-copilotsearch");t&&(t.setAttribute("role","link"),t.setAttribute("aria-selected","true"),t.setAttribute("aria-current","page"),t.addEventListener("click",u),t.addEventListener("keydown",function(n){n.keyCode===13&&u()}));sj_evt.bind("cpltsrch_qry",e,!0)}function s(n){n.interceptScopeClicks&&sj_evt.bind("bopCompLoaded",h,!0)}function h(){var n=_ge("b-scopeListItem-copilotsearch");n&&(n.setAttribute("inlinechat","true"),sj_be(n,"click",c))}function c(t){var f,e,r,u,o;return(i&&_ge("progContPlaceHolder")&&(_w.sj_disableProgRender=!0),r=_d.querySelectorAll(".ca_userquery"),(r===null||r===void 0?void 0:r.length)>0)?( __get$(r,r.length-1) .scrollIntoView({behavior:"smooth",block:"start",inline:"start"}),sj_sp(t),sj_pd(t),n.Composer.focus(),!1):(u=l( __get$(__get$(_w,"location"),"href") ),!u)?!0:(o=(e=(f=u.searchParams.get("q"))!==null&&f!==void 0?f:u.searchParams.get("Q"))!==null&&e!==void 0?e:"",!o)?!0:(sj_sp(t),sj_pd(t),a(o),!1)}function l(n,t){try{return new URL(n,t)}catch(i){return null}}function a(t){n.Helper.getLastTurnId()==null&&(n.Helper.writeLog(n.Helper.ClientInst.CopilotSystem,n.Helper.LogNames.ConversationStarted,"convId",n.Helper.getConversationId()),n.PerformanceHelper.markEvent(n.PerformanceHelper.PerformanceMarkers.ConversationStart));n.PerformanceHelper.markEvent(n.PerformanceHelper.PerformanceMarkers.TurnStart);n.Helper.writeLog(n.Helper.ClientInst.Click,n.Helper.LogNames.QueryIssued,"inputType",n.Helper.InputTypes.Scope,"query",t);n.Helper.logCustomData(n.Helper.ClientInst.CopilotInteraction,n.Helper.LogNames.ScopeClick,"CSearch",{},"");n.Conversation.generateCopilotResponse(t,n.Helper.InputTypes.Scope)}var i=!1,f=new RegExp(/q=[^&]*/);t.updateScopeLink=r;t.init=o;t.initInlineChat=s})(t=n.Scopebar||(n.Scopebar={}))}(CopilotSearch||(CopilotSearch={})),function(n){function t(n){var t;(t=_w.parent)===null||t===void 0?void 0: __call$(t,"postMessage",[n,"*"]) }function i(n){sj_be(_w,"message",function(t){n(t.data)})}function r(n,t){var i,e='li[turnid="'.concat(n,'"].ca_turn'),f=_d.querySelector(e),r,u;return f?(r=f.querySelector(".frame_cont"),!r)?!1:(u=r.querySelector("iframe"),!u)?!1:((i=u.contentWindow)===null||i===void 0?void 0: __call$(i,"postMessage",[t,"*"]) ,!0):!1}n.postMessage=t;n.bindMessageEvent=i;n.postMessageToIframe=r}(CopilotSearchMessagerIframe||(CopilotSearchMessagerIframe={})),function(n){function t(n){typeof CopilotSearchMessagerAjax!="undefined"&& __get$PostMessage(CopilotSearchMessagerAjax) ? __call$(CopilotSearchMessagerAjax,"postMessage",[n]) :typeof CopilotSearchMessagerIframe!="undefined"&& __get$PostMessage(CopilotSearchMessagerIframe) && __call$(CopilotSearchMessagerIframe,"postMessage",[n]) }function i(n){typeof CopilotSearchMessagerAjax!="undefined"&&CopilotSearchMessagerAjax.bindMessageEvent?CopilotSearchMessagerAjax.bindMessageEvent(n):typeof CopilotSearchMessagerIframe!="undefined"&&CopilotSearchMessagerIframe.bindMessageEvent&&CopilotSearchMessagerIframe.bindMessageEvent(n)}function r(n,t,i){var r=!1;typeof CopilotSearchMessagerAjax!="undefined"&&CopilotSearchMessagerAjax.postMessageToTurn?(CopilotSearchMessagerAjax.postMessageToTurn(i),r=!0):typeof CopilotSearchMessagerIframe!="undefined"&&CopilotSearchMessagerIframe.postMessageToIframe&&(r=CopilotSearchMessagerIframe.postMessageToIframe(n,i),console.debug("IsMessagePostedToIframe: "+r));CopilotSearch.Helper.writeLog(CopilotSearch.Helper.ClientInst.CopilotSystem,CopilotSearch.Helper.LogNames.PostMessageToTurn,"responseId",t,"isMessageFired",r.toString())}function u(n,i){t({type:"MagFollowup",data:{query:n,iframeid:i}})}n.CopilotSearchMessageEvent="csisomsg";n.postMessage=t;n.bindMessageEvent=i;n.postMessageToTurn=r;n.issueMagazineFollowup=u}(CopilotSearchMessager||(CopilotSearchMessager={})),function(n){var t;(function(t){function i(){return document.querySelectorAll(".ca_turn").length}function r(t,i,r,u){r===void 0&&(r=null);u===void 0&&(u="");console.log("AS clicked: ".concat(r));i==null&&(i=n.Helper.InputTypes.AutoSuggest);n.PerformanceHelper.markEvent(n.PerformanceHelper.PerformanceMarkers.TurnStart);n.getMode()!==n.Helper.CopilotMode.Turn&&(n.changeMode(n.Helper.CopilotMode.Turn),n.ZeroPage.hide());n.Helper.writeLog(n.Helper.ClientInst.Click,n.Helper.LogNames.QueryIssued,"inputType",n.Helper.InputTypes.AutoSuggest,"query",t,"displayedQuery",r);n.Conversation.generateCopilotResponse(t,i);n.Composer.resetComposer()}function u(){n.Composer.resize()}function f(){return n.SuggestionChips.getSuggestionChipId()}function e(){return n.SuggestionChips.getSuggestionChips()}function o(){return n.Conversation.fullFormedQuery}function s(){return n.Conversation.conversationId}function h(){var n=document.querySelector(".suggestion_container");n===null||n===void 0?void 0:n.classList.add("hidden")}function c(){var n=document.querySelector(".suggestion_container");n===null||n===void 0?void 0:n.classList.remove("hidden")}function l(){return n.Conversation.getFrameIG()}t.getTurnCount=i;t.handleAutoSuggestClick=r;t.handleResize=u;t.getSuggestionChipId=f;t.getSuggestionChips=e;t.getFullFormedquery=o;t.getConversationId=s;t.hideSuggestionChips=h;t.showSuggestionChips=c;t.getFrameIG=l})(t=n.AutoSuggest||(n.AutoSuggest={}))}(CopilotSearch||(CopilotSearch={})),function(n){var t;(function(t){var i;(function(t){function i(t,i){if(i){var r=t;return n.Composer.enterSearch(r)}return n.Composer.onComposerSubmit(t)}t.handleBOPASSubmit=i})(i=t.AS||(t.AS={}))})(t=n.Composer||(n.Composer={}))}(CopilotSearch||(CopilotSearch={})),function(n){var t;(function(t){function r(t){var l,r,u,f,e,o,s,h,a,v,c;t.enableSERPChat&&(l=i(n.PerformanceHelper,"CopilotSearch.PerformanceHelper"),l&&t.fromSerpComposer&&l.setIsInlineChat(),r=i(n.Helper,"CopilotSearch.Helper"),r===null||r===void 0?void 0:r.initConfig(t),u=i(n.ErrorState,"CopilotSearch.ErrorState"),u===null||u===void 0?void 0:u.init(t),f=i(n.SuggestionChips,"CopilotSearch.SuggestionChips"),f===null||f===void 0?void 0:f.init(t),e=i(n.TWrap,"CopilotSearch.TWrap"),e===null||e===void 0?void 0:e.init(t),o=i(n.Conversation,"CopilotSearch.Conversation"),o===null||o===void 0?void 0:o.initConversation(t),s=i(n.TopMenu,"CopilotSearch.TopMenu"),s===null||s===void 0?void 0:s.init(t),h=i(n.FeedbackData,"CopilotSearch.FeedbackData"),h===null||h===void 0?void 0:h.init(t),a=i(n.History,"CopilotSearch.History"),a&&t.enableHistoryUpdate&&a.init(t),v=i(n.Scopebar,"CopilotSearch.Scopebar"),v&&v.initInlineChat(t),c=i(n.Overlay,"CopilotSearch.Overlay"),c===null||c===void 0?void 0:c.init(t.locStrings,t.ovlMaxCnt,t.enableOverlaySnippet))}function i(n,t){return typeof n=="undefined"?(_w.Log&&Log.Log("ReferenceJSError","SERPBOPCopilotSearchComposorContainer","",!0,"Message","".concat(t," not loaded.")),undefined):n}t.init=r;sj_evt.fire("bopChatReady")})(t=n.SERP||(n.SERP={}))}(CopilotSearch||(CopilotSearch={}))
/*hammerhead|script|end*/